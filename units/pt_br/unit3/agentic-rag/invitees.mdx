# Criando uma ferramenta RAG para o livro de convidados

Alfred, nosso agente de confianÃ§a, estÃ¡ preparando a gala mais sofisticada do sÃ©culo. Para garantir seu sucesso, ele precisa acessar rapidamente informaÃ§Ãµes atualizadas sobre cada convidado. Vamos ajudÃ¡-lo montando uma ferramenta de Retrieval-Augmented Generation (RAG) com base em nosso dataset personalizado.

## Por que usar RAG em uma festa?

Imagine Alfred circulando entre os convidados, lembrando detalhes especÃ­ficos instantaneamente. Um LLM puro pode nÃ£o conseguir, porque:

1. A lista de convidados Ã© especÃ­fica e nÃ£o faz parte do treinamento do modelo.  
2. InformaÃ§Ãµes podem mudar com frequÃªncia.  
3. Alfred precisa de detalhes precisos, como e-mails.

Ao combinar um sistema de busca com um LLM, RAG permite respostas atualizadas sob demanda.

> [!TIP]
> VocÃª pode usar qualquer framework estudado no curso. Escolha a aba de cÃ³digo correspondente.

## Estrutura do projeto

Usaremos uma Space do Hugging Face organizada em mÃ³dulos:

- `tools.py` â€“ ferramentas auxiliares.  
- `retriever.py` â€“ funÃ§Ãµes de busca sobre a base de conhecimento.  
- `app.py` â€“ integraÃ§Ã£o final (construÃ­da na Ãºltima parte da unidade).  

HÃ¡ uma Space pronta em [agents-course/Unit_3_Agentic_RAG](https://huggingface.co/spaces/agents-course/Unit_3_Agentic_RAG). Sinta-se livre para clonar.

VocÃª tambÃ©m pode testar o agente aqui:

<iframe src="https://agents-course-unit-3-agentic-rag.hf.space" frameborder="0" width="850" height="450"></iframe>

## Dataset

O conjunto [`agents-course/unit3-invitees`](https://huggingface.co/datasets/agents-course/unit3-invitees/) contÃ©m:

- `name`: nome completo.  
- `relation`: relaÃ§Ã£o com o anfitriÃ£o.  
- `description`: biografia/detalhes interessantes.  
- `email`: contato para convites ou follow-up.

<iframe src="https://huggingface.co/datasets/agents-course/unit3-invitees/embed/viewer/default/train" frameborder="0" width="100%" height="560"></iframe>

> [!TIP]
> Em um cenÃ¡rio real vocÃª pode incluir preferÃªncias alimentares, tÃ³picos sensÃ­veis, interesses etc.

## Construindo a ferramenta

Vamos criar uma ferramenta que Alfred possa usar para consultar os convidados durante o evento.

### Passo 1 â€“ carregar e preparar os dados

```python
import datasets
from langchain_core.documents import Document

guest_dataset = datasets.load_dataset("agents-course/unit3-invitees", split="train")

docs = [
    Document(
        page_content="\n".join([
            f"Name: {guest['name']}",
            f"Relation: {guest['relation']}",
            f"Description: {guest['description']}",
            f"Email: {guest['email']}"
        ]),
        metadata={"name": guest["name"]}
    )
    for guest in guest_dataset
]
```

### Passo 2 â€“ criar o retriever

```python
from smolagents import Tool
from langchain_community.retrievers import BM25Retriever

class GuestInfoRetrieverTool(Tool):
    name = "guest_info_retriever"
    description = "Recupera informaÃ§Ãµes detalhadas sobre os convidados da gala."
    inputs = {"query": {"type": "string", "description": "Nome ou relaÃ§Ã£o do convidado."}}
    output_type = "string"

    def __init__(self, docs):
        self.retriever = BM25Retriever.from_documents(docs)

    def forward(self, query: str):
        results = self.retriever.get_relevant_documents(query)
        if results:
            return "\n\n".join(doc.page_content for doc in results[:3])
        return "Nenhuma informaÃ§Ã£o correspondente encontrada."

guest_info_tool = GuestInfoRetrieverTool(docs)
```

### Passo 3 â€“ integrar com Alfred

```python
from smolagents import CodeAgent, InferenceClientModel

model = InferenceClientModel()
alfred = CodeAgent(tools=[guest_info_tool], model=model)

response = alfred.run("Tell me about 'Lady Ada Lovelace'.")
print("ğŸ© Resposta do Alfred:")
print(response)
```

SaÃ­da esperada:

```
ğŸ© Resposta do Alfred:
Lady Ada Lovelace Ã© uma matemÃ¡tica renomada...
```

## InteraÃ§Ã£o tÃ­pica

**VocÃª:** â€œAlfred, quem estÃ¡ conversando com o embaixador?â€  
**Alfred:** â€œDr. Nikola Tesla, antigo amigo da universidade. Recentemente patenteou um sistema de transmissÃ£o de energia sem fio. Ele adora pombos â€” Ã³timo assunto para quebrar o gelo.â€

```json
{
  "name": "Dr. Nikola Tesla",
  "relation": "old friend from university days",
  "description": "...",
  "email": "nikola.tesla@gmail.com"
}
```

## PrÃ³ximos passos

Agora que Alfred consegue recuperar dados, vocÃª pode:

1. Usar retrievers baseados em embeddings (ex.: [sentence-transformers](https://www.sbert.net/)).  
2. Implementar memÃ³ria de conversaÃ§Ã£o.  
3. Combinar com busca na web para informaÃ§Ãµes recentes.  
4. Integrar mÃºltiplos Ã­ndices.

> [!TIP]
> Experimente estender a ferramenta para sugerir tÃ³picos de conversa. Quando terminar, implemente-a em `retriever.py`.
