# Cr√©ons notre premier agent avec smolagents

Dans la section pr√©c√©dente, nous avons appris comment cr√©er des agents √† partir de z√©ro en utilisant du code Python, et nous avons **vu √† quel point ce processus peut √™tre fastidieux**. Heureusement, de nombreuses biblioth√®ques d'agents simplifient ce travail en **se chargeant de la majeure partie du travail lourd pour vous**.

Dans ce tutoriel, **vous allez cr√©er votre tout premier agent** capable d'ex√©cuter des actions telles que la g√©n√©ration d'images, la recherche sur le web, la v√©rification de fuseaux horaires et bien plus encore !

Vous publierez √©galement votre agent **sur un *Space* Hugging Face afin de le partager avec vos amis et coll√®gues**.

C'est parti !

## Qu'est-ce que smolagents ?

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/smolagents.png" alt="smolagents"/>

Pour cr√©er cet agent, nous allons utiliser `smolagents`, une biblioth√®que qui **fournit un cadre facilitant le d√©veloppement d'agents**.

Cette biblioth√®que l√©g√®re est con√ßue pour √™tre simple, tout en masquant une grande partie de la complexit√© li√©e √† la construction d'un agent, permettant ainsi de vous concentrer sur la conception du comportement de l'agent.

Nous approfondirons smolagents dans la prochaine unit√©. En attendant, vous pouvez √©galement consulter cet <a href="https://huggingface.co/blog/smolagents" target="_blank">article de blog</a> ou le <a href="https://github.com/huggingface/smolagents" target="_blank">d√©p√¥t GitHub</a> de la biblioth√®que.

Bri√®vement, `smolagents` est une biblioth√®que se concentrant sur les **agents g√©n√©rant du code** (via la classe `CodeAgent`), un type d'agent qui ex√©cute des **"actions"** via des blocs de code, puis **"observe"** les r√©sultats en ex√©cutant le code.

Voici un exemple de ce que nous allons construire !

Nous avons √©quip√© notre agent d'un **outil de g√©n√©ration d'images** et lui avons demand√© de g√©n√©rer une image d'un chat.

L'agent dans `smolagents` aura les **m√™mes comportements que celui personnalis√© que nous avons construit pr√©c√©demment** : il va **r√©fl√©chir, agir et observer cycliquement** jusqu'√† parvenir √† une r√©ponse finale :

<iframe width="560" height="315" src="https://www.youtube.com/embed/PQDKcWiuln4?si=ysSTDZoi8y55FVvA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

Excitant, n'est-ce pas ?

## Construisons notre agent !

Pour commencer, dupliquez ce *Space* : <a href="https://huggingface.co/spaces/agents-course/First_agent_template" target="_blank">https://huggingface.co/spaces/agents-course/First_agent_template</a>  
> Merci √† <a href="https://huggingface.co/m-ric" target="_blank">Aymeric</a> pour ce patron ! üôå

Dupliquer signifie **cr√©er une copie locale sur votre propre profil** :  
<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/duplicate-space.gif" alt="Duplicate"/>

Apr√®s la duplication, vous devrez ajouter votre *token* d'API Hugging Face pour que votre agent puisse acc√©der √† l'API du mod√®le :

1. Tout d'abord, obtenez votre *token* Hugging Face sur [https://hf.co/settings/tokens](https://hf.co/settings/tokens) avec la permission d'inf√©rer, si vous n'en avez pas d√©j√† un.
2. Allez dans votre *Space* dupliqu√© et cliquez sur l'onglet **Settings**.
3. Descendez jusqu'√† la section **Variables and Secrets** et cliquez sur **New Secret**.
4. Cr√©ez un secret avec le nom `HF_TOKEN` et collez votre token comme valeur.
5. Cliquez sur **Save** pour stocker votre *token* en toute s√©curit√©.


Tout au long de cette le√ßon, le seul fichier (actuellement incomplet) que vous aurez √† modifier est le **"app.py"**. Vous pouvez consulter l'[original ici](https://huggingface.co/spaces/agents-course/First_agent_template/blob/main/app.py). Pour trouver le v√¥tre, allez dans votre copie du *Space*, cliquez sur l'onglet `Files` puis sur `app.py` dans la liste des r√©pertoires.

Analysons le code ensemble :

- Le fichier commence par quelques importations de biblioth√®ques simples mais n√©cessaires

```python
from smolagents import CodeAgent, DuckDuckGoSearchTool, FinalAnswerTool, InferenceClientModel, load_tool, tool
import datetime
import requests
import pytz
import yaml
```

Comme indiqu√© pr√©c√©demment, nous utiliserons directement la classe **CodeAgent** de **smolagents**.

### Les outils

Entrons maintenant dans le vif du sujet avec les outils ! Si vous souhaitez un rappel sur les outils, n'h√©sitez pas √† consulter la section [Outils](tools) du cours.

```python
@tool
def my_custom_tool(arg1: str, arg2: int) -> str:  # il est important de sp√©cifier le type de retour
    # Conservez ce format pour la description de l'outil et des arguments, mais n'h√©sitez pas √† modifier l'outil
    """Un outil qui ne fait encore rien
    Arguments:
        arg1: le premier argument
        arg2: le deuxi√®me argument
    """
    return "Quelle magie allez-vous cr√©er ?"

@tool
def get_current_time_in_timezone(timezone: str) -> str:
    """Un outil qui r√©cup√®re l'heure locale actuelle dans un fuseau horaire sp√©cifi√©.
    Arguments:
        timezone: Une cha√Æne repr√©sentant un fuseau horaire valide (par exemple, 'America/New_York').
    """
    try:
        # Cr√©er l'objet fuseau horaire
        tz = pytz.timezone(timezone)
        # Obtenir l'heure actuelle dans ce fuseau horaire
        local_time = datetime.datetime.now(tz).strftime("%Y-%m-%d %H:%M:%S")
        return f"L'heure locale actuelle dans {timezone} est : {local_time}"
    except Exception as e:
        return f"Erreur lors de la r√©cup√©ration de l'heure pour le fuseau horaire '{timezone}' : {str(e)}"
```

Les outils sont ce que nous vous encourageons √† construire dans cette section ! Nous vous donnons deux exemples :

1. Un **outil factice non fonctionnel** que vous pouvez modifier pour cr√©er quelque chose d'utile.
2. Un **outil r√©ellement fonctionnel** qui r√©cup√®re l'heure actuelle quelque part dans le monde.

Pour d√©finir votre outil, il est important de :

1. Fournir des types d'entr√©e et de sortie pour votre fonction, comme dans `get_current_time_in_timezone(timezone: str) -> str:`
2. Fournir une **docstring bien format√©e**. `smolagents` s'attend √† ce que tous les arguments aient une **description textuelle dans la docstring**.

### L'agent

Il utilise [`Qwen/Qwen2.5-Coder-32B-Instruct`](https://huggingface.co/Qwen/Qwen2.5-Coder-32B-Instruct) comme moteur LLM. C'est un mod√®le tr√®s performant auquel nous acc√©derons via l'API *serverless*.

```python
final_answer = FinalAnswerTool()
model = InferenceClientModel(
    max_tokens=2096,
    temperature=0.5,
    model_id='Qwen/Qwen2.5-Coder-32B-Instruct',
    custom_role_conversions=None,
)

with open("prompts.yaml", 'r') as stream:
    prompt_templates = yaml.safe_load(stream)
    
# Nous cr√©ons notre CodeAgent
agent = CodeAgent(
    model=model,
    tools=[final_answer],  # ajoutez vos outils ici (ne supprimez pas final_answer)
    max_steps=6,
    verbosity_level=1,
    grammar=None,
    planning_interval=None,
    name=None,
    description=None,
    prompt_templates=prompt_templates
)

GradioUI(agent).launch()
```

Cet agent utilise toujours l'`InferenceClient` que nous avons vu dans une section pr√©c√©dente derri√®re la classe **InferenceClientModel** !

Nous fournirons des exemples plus d√©taill√©s lors de la pr√©sentation du *framework* dans l'Unit√© 2. Pour l'instant, vous devez vous concentrer sur **l'ajout de nouveaux outils √† la liste des outils** en utilisant le param√®tre `tools` de votre agent.

Par exemple, vous pourriez utiliser `DuckDuckGoSearchTool` qui a √©t√© import√© dans la premi√®re ligne du code, ou vous pouvez examiner `image_generation_tool` qui est charg√© depuis le Hub plus tard dans le code.

**Ajouter des outils donnera de nouvelles capacit√©s √† votre agent**, alors soyez cr√©atif !

### Le *prompt syst√®me*

Le *prompt* syst√®me de l'agent est stock√© dans un fichier `prompts.yaml` s√©par√©. Ce fichier contient des instructions pr√©d√©finies qui guident le comportement de l'agent.

Le stockage des *prompts* dans un fichier YAML permet une personnalisation et une r√©utilisation ais√©es pour diff√©rents agents ou cas d'utilisation.

Vous pouvez consulter la [structure des fichiers du *Space*](https://huggingface.co/spaces/agents-course/First_agent_template/tree/main) pour voir o√π se trouve le fichier `prompts.yaml` et comment il est organis√© dans le projet.

Le fichier complet **"app.py"** :

```python
from smolagents import CodeAgent, DuckDuckGoSearchTool, InferenceClientModel, load_tool, tool
import datetime
import requests
import pytz
import yaml
from tools.final_answer import FinalAnswerTool

from Gradio_UI import GradioUI

# Voici un exemple d'un outil qui ne fait encore rien. √âpatez-nous avec votre cr√©ativit√© !
@tool
def my_custom_tool(arg1: str, arg2: int) -> str:  # il est important de sp√©cifier le type de retour
    # Conservez ce format pour la description de l'outil et des arguments, mais n'h√©sitez pas √† modifier l'outil
    """Un outil qui ne fait encore rien
    Arguments:
        arg1: le premier argument
        arg2: le deuxi√®me argument
    """
    return "Quelle magie allez-vous cr√©er ?"

@tool
def get_current_time_in_timezone(timezone: str) -> str:
    """Un outil qui r√©cup√®re l'heure locale actuelle dans un fuseau horaire sp√©cifi√©.
    Arguments:
        timezone: Une cha√Æne repr√©sentant un fuseau horaire valide (par exemple, 'America/New_York').
    """
    try:
        # Cr√©er l'objet fuseau horaire
        tz = pytz.timezone(timezone)
        # Obtenir l'heure actuelle dans ce fuseau horaire
        local_time = datetime.datetime.now(tz).strftime("%Y-%m-%d %H:%M:%S")
        return f"L'heure locale actuelle dans {timezone} est : {local_time}"
    except Exception as e:
        return f"Erreur lors de la r√©cup√©ration de l'heure pour le fuseau horaire '{timezone}' : {str(e)}"


final_answer = FinalAnswerTool()
model = InferenceClientModel(
    max_tokens=2096,
    temperature=0.5,
    model_id='Qwen/Qwen2.5-Coder-32B-Instruct',
    custom_role_conversions=None,
)

# Importer l'outil depuis le Hub
image_generation_tool = load_tool("agents-course/text-to-image", trust_remote_code=True)

with open("prompts.yaml", 'r') as stream:
    prompt_templates = yaml.safe_load(stream)
    
agent = CodeAgent(
    model=model,
    tools=[final_answer],  # ajoutez vos outils ici (ne supprimez pas final_answer)
    max_steps=6,
    verbosity_level=1,
    grammar=None,
    planning_interval=None,
    name=None,
    description=None,
    prompt_templates=prompt_templates # Transmettre le prompt du syst√®me √† CodeAgent
)

GradioUI(agent).launch()
```

Votre **objectif** est de vous familiariser avec le *Space* et l'agent.

Actuellement, l'agent dans le patron **n'utilise aucun outil, alors essayez de lui fournir certains des outils pr√©fabriqu√©s ou m√™me de cr√©er de nouveaux outils vous-m√™me !**

Nous attendons avec impatience vos incroyables agents dans le canal Discord **#agents-course-showcase**!

---

F√©licitations, vous avez construit votre premier Agent ! N'h√©sitez pas √† le partager avec vos amis et coll√®gues.

Comme c'est votre premi√®re tentative, il est tout √† fait normal qu'il soit un peu bogu√© ou lent. Dans les unit√©s futures, nous apprendrons √† construire de meilleurs agents.

La meilleure fa√ßon d'apprendre est d'essayer, alors n'h√©sitez pas √† le mettre √† jour, √† ajouter plus d'outils, √† essayer avec un autre mod√®le, etc.

Dans la prochaine section, vous allez remplir le quiz final et obtenir votre certificat !
