<CourseFloatingBanner chapter={2}
  classNames="absolute z-10 right-0 top-0"
  notebooks={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/agents-course/blob/main/notebooks/unit2/smolagents/multiagent_notebook.ipynb"},
]} />

# Há»‡ thá»‘ng Äa Agent

Há»‡ thá»‘ng Ä‘a Agent cho phÃ©p **cÃ¡c Agent chuyÃªn biá»‡t há»£p tÃ¡c xá»­ lÃ½ tÃ¡c vá»¥ phá»©c táº¡p**, nÃ¢ng cao tÃ­nh mÃ´-Ä‘un, kháº£ nÄƒng má»Ÿ rá»™ng vÃ  Ä‘á»™ á»•n Ä‘á»‹nh. Thay vÃ¬ phá»¥ thuá»™c vÃ o má»™t Agent duy nháº¥t, cÃ¡c tÃ¡c vá»¥ Ä‘Æ°á»£c phÃ¢n phá»‘i cho nhiá»u Agent vá»›i kháº£ nÄƒng khÃ¡c nhau.

Trong **smolagents**, cÃ¡c Agent khÃ¡c nhau cÃ³ thá»ƒ káº¿t há»£p Ä‘á»ƒ táº¡o mÃ£ Python, gá»i cÃ´ng cá»¥ bÃªn ngoÃ i, thá»±c hiá»‡n tÃ¬m kiáº¿m web vÃ  hÆ¡n tháº¿. Báº±ng cÃ¡ch Ä‘iá»u phá»‘i cÃ¡c Agent nÃ y, ta cÃ³ thá»ƒ táº¡o ra cÃ¡c quy trÃ¬nh lÃ m viá»‡c máº¡nh máº½.

Má»™t thiáº¿t láº­p Ä‘iá»ƒn hÃ¬nh cÃ³ thá»ƒ bao gá»“m:
- **Manager Agent** (Agent quáº£n lÃ½) Ä‘á»ƒ phÃ¢n cÃ´ng tÃ¡c vá»¥  
- **Code Interpreter Agent** (Agent thÃ´ng dá»‹ch mÃ£) Ä‘á»ƒ thá»±c thi code  
- **Web Search Agent** (Agent tÃ¬m kiáº¿m web) Ä‘á»ƒ thu tháº­p thÃ´ng tin  

Biá»ƒu Ä‘á»“ dÆ°á»›i minh há»a kiáº¿n trÃºc Ä‘a Agent Ä‘Æ¡n giáº£n, nÆ¡i **Manager Agent** phá»‘i há»£p vá»›i **Code Interpreter Tool** vÃ  **Web Search Agent** - Agent nÃ y láº¡i sá»­ dá»¥ng cÃ¡c cÃ´ng cá»¥ nhÆ° `DuckDuckGoSearchTool` vÃ  `VisitWebpageTool` Ä‘á»ƒ thu tháº­p thÃ´ng tin liÃªn quan.

<img src="https://mermaid.ink/img/pako:eNp1kc1qhTAQRl9FUiQb8wIpdNO76eKubrmFks1oRg3VSYgjpYjv3lFL_2hnMWQOJwn5sqgmelRWleUSKLAtFs09jqhtoWuYUFfFAa6QA9QDTnpzamheuhxn8pt40-6l13UtS0ddhtQXj6dbR4XUGQg6zEYasTF393KjeSDGnDJKNxzj8I_7hLW5IOSmP9CH9hv_NL-d94d4DVNg84p1EnK4qlIj5hGClySWbadT-6OdsrL02MI8sFOOVkciw8zx8kaNspxnrJQE0fXKtjBMMs3JA-MpgOQwftIE9Bzj14w-cMznI_39E9Z3p0uFoA?type=png" style='background: white;'>

## Há»‡ thá»‘ng Äa Agent trong thá»±c táº¿

Má»™t há»‡ thá»‘ng Ä‘a Agent bao gá»“m nhiá»u Agent chuyÃªn biá»‡t lÃ m viá»‡c cÃ¹ng nhau dÆ°á»›i sá»± Ä‘iá»u phá»‘i cá»§a **Orchestrator Agent** (Agent Ä‘iá»u phá»‘i). CÃ¡ch tiáº¿p cáº­n nÃ y cho phÃ©p xá»­ lÃ½ cÃ¡c quy trÃ¬nh phá»©c táº¡p báº±ng cÃ¡ch phÃ¢n phá»‘i tÃ¡c vá»¥ cho cÃ¡c Agent vá»›i vai trÃ² khÃ¡c nhau.

VÃ­ dá»¥, **Há»‡ thá»‘ng RAG (TÃ¬m kiáº¿m vÃ  táº¡o ra cÃ¢u tráº£ lá»i) Äa Agent** cÃ³ thá»ƒ tÃ­ch há»£p:
- **Web Agent** Ä‘á»ƒ duyá»‡t internet  
- **Retriever Agent** Ä‘á»ƒ truy xuáº¥t thÃ´ng tin tá»« cÆ¡ sá»Ÿ tri thá»©c  
- **Image Generation Agent** Ä‘á»ƒ táº¡o hÃ¬nh áº£nh  

Táº¥t cáº£ Agent nÃ y hoáº¡t Ä‘á»™ng dÆ°á»›i sá»± Ä‘iá»u phá»‘i cá»§a má»™t Orchestrator quáº£n lÃ½ viá»‡c phÃ¢n cÃ´ng vÃ  tÆ°Æ¡ng tÃ¡c.

## Giáº£i quyáº¿t tÃ¡c vá»¥ phá»©c táº¡p vá»›i há»‡ thá»‘ng phÃ¢n cáº¥p Ä‘a Agent

<Tip>
Báº¡n cÃ³ thá»ƒ theo dÃµi code trong <a href="https://huggingface.co/agents-course/notebooks/blob/main/unit2/smolagents/multiagent_notebook.ipynb" target="_blank">notebook nÃ y</a> vÃ  cháº¡y báº±ng Google Colab.
</Tip>

Buá»•i tiáº¿p tÃ¢n sáº¯p Ä‘áº¿n! Vá»›i sá»± giÃºp Ä‘á»¡ cá»§a báº¡n, Alfred gáº§n nhÆ° Ä‘Ã£ hoÃ n thÃ nh má»i chuáº©n bá»‹.

NhÆ°ng giá» phÃ¡t sinh váº¥n Ä‘á»: Batmobile Ä‘Ã£ biáº¿n máº¥t. Alfred cáº§n tÃ¬m phÆ°Æ¡ng tiá»‡n thay tháº¿ vÃ  pháº£i tÃ¬m tháº­t nhanh.

May máº¯n thay, má»™t sá»‘ phim tiá»ƒu sá»­ vá» cuá»™c Ä‘á»i Bruce Wayne Ä‘Ã£ Ä‘Æ°á»£c thá»±c hiá»‡n, cÃ³ láº½ Alfred cÃ³ thá»ƒ tÃ¬m tháº¥y xe bá» láº¡i á»Ÿ trÆ°á»ng quay nÃ o Ä‘Ã³ vÃ  nÃ¢ng cáº¥p lÃªn tiÃªu chuáº©n hiá»‡n Ä‘áº¡i, cháº¯c cháº¯n bao gá»“m cáº£ tÃ­nh nÄƒng tá»± lÃ¡i hoÃ n toÃ n.

NhÆ°ng Ä‘iá»u nÃ y cÃ³ thá»ƒ á»Ÿ báº¥t ká»³ Ä‘Ã¢u trong cÃ¡c Ä‘á»‹a Ä‘iá»ƒm quay phim trÃªn tháº¿ giá»›i - vÃ  sá»‘ lÆ°á»£ng cÃ³ thá»ƒ ráº¥t nhiá»u.

VÃ¬ váº­y Alfred cáº§n báº¡n giÃºp Ä‘á»¡. Báº¡n cÃ³ thá»ƒ xÃ¢y dá»±ng má»™t Agent giáº£i quyáº¿t tÃ¡c vá»¥ nÃ y khÃ´ng?

> ğŸ‘‰ TÃ¬m táº¥t cáº£ Ä‘á»‹a Ä‘iá»ƒm quay phim Batman trÃªn tháº¿ giá»›i, tÃ­nh toÃ¡n thá»i gian váº­n chuyá»ƒn báº±ng tÃ u Ä‘áº¿n Ä‘Ã³ vÃ  thá»ƒ hiá»‡n chÃºng trÃªn báº£n Ä‘á»“ vá»›i mÃ u sáº¯c biáº¿n Ä‘á»•i theo thá»i gian váº­n chuyá»ƒn. Äá»“ng thá»i thá»ƒ hiá»‡n cÃ¡c nhÃ  mÃ¡y siÃªu xe cÃ³ cÃ¹ng thá»i gian váº­n chuyá»ƒn.

HÃ£y cÃ¹ng xÃ¢y dá»±ng nÃ o!

VÃ­ dá»¥ nÃ y cáº§n má»™t sá»‘ package bá»• sung, hÃ£y cÃ i Ä‘áº·t chÃºng trÆ°á»›c:

```bash
pip install 'smolagents[litellm]' plotly geopandas shapely kaleido -q
```

### Äáº§u tiÃªn táº¡o cÃ´ng cá»¥ tÃ­nh thá»i gian váº­n chuyá»ƒn báº±ng mÃ¡y bay chá»Ÿ hÃ ng

```python
import math
from typing import Optional, Tuple

from smolagents import tool


@tool
def calculate_cargo_travel_time(
    origin_coords: Tuple[float, float],
    destination_coords: Tuple[float, float],
    cruising_speed_kmh: Optional[float] = 750.0,  # Tá»‘c Ä‘á»™ trung bÃ¬nh cá»§a mÃ¡y bay chá»Ÿ hÃ ng
) -> float:
    """
    TÃ­nh thá»i gian di chuyá»ƒn báº±ng mÃ¡y bay chá»Ÿ hÃ ng giá»¯a hai Ä‘iá»ƒm trÃªn TrÃ¡i Äáº¥t sá»­ dá»¥ng khoáº£ng cÃ¡ch vÃ²ng cung lá»›n.

    Args:
        origin_coords: Tuple (vÄ© Ä‘á»™, kinh Ä‘á»™) cá»§a Ä‘iá»ƒm xuáº¥t phÃ¡t
        destination_coords: Tuple (vÄ© Ä‘á»™, kinh Ä‘á»™) cá»§a Ä‘iá»ƒm Ä‘áº¿n
        cruising_speed_kmh: Tá»‘c Ä‘á»™ bay tÃ¹y chá»n theo km/h (máº·c Ä‘á»‹nh 750 km/h cho mÃ¡y bay chá»Ÿ hÃ ng thÃ´ng thÆ°á»ng)

    Returns:
        float: Thá»i gian di chuyá»ƒn Æ°á»›c tÃ­nh tÃ­nh báº±ng giá»

    VÃ­ dá»¥:
        >>> # Tá»« Chicago (41.8781Â° N, 87.6298Â° W) Ä‘áº¿n Sydney (33.8688Â° S, 151.2093Â° E)
        >>> result = calculate_cargo_travel_time((41.8781, -87.6298), (-33.8688, 151.2093))
    """

    def to_radians(degrees: float) -> float:
        return degrees * (math.pi / 180)

    # TrÃ­ch xuáº¥t tá»a Ä‘á»™
    lat1, lon1 = map(to_radians, origin_coords)
    lat2, lon2 = map(to_radians, destination_coords)

    # BÃ¡n kÃ­nh TrÃ¡i Äáº¥t tÃ­nh báº±ng km
    EARTH_RADIUS_KM = 6371.0

    # TÃ­nh khoáº£ng cÃ¡ch vÃ²ng cung lá»›n báº±ng cÃ´ng thá»©c haversine
    dlon = lon2 - lon1
    dlat = lat2 - lat1

    a = (
        math.sin(dlat / 2) ** 2
        + math.cos(lat1) * math.cos(lat2) * math.sin(dlon / 2) ** 2
    )
    c = 2 * math.asin(math.sqrt(a))
    distance = EARTH_RADIUS_KM * c

    # ThÃªm 10% Ä‘á»ƒ tÃ­nh cÃ¡c tuyáº¿n Ä‘Æ°á»ng khÃ´ng trá»±c tiáº¿p vÃ  kiá»ƒm soÃ¡t khÃ´ng lÆ°u
    actual_distance = distance * 1.1

    # TÃ­nh thá»i gian bay
    # ThÃªm 1 giá» cho quy trÃ¬nh cáº¥t/háº¡ cÃ¡nh
    flight_time = (actual_distance / cruising_speed_kmh) + 1.0

    # Äá»‹nh dáº¡ng káº¿t quáº£
    return round(flight_time, 2)


print(calculate_cargo_travel_time((41.8781, -87.6298), (-33.8688, 151.2093)))
```

### Thiáº¿t láº­p Agent

Äá»‘i vá»›i nhÃ  cung cáº¥p model, ta sá»­ dá»¥ng Together AI - má»™t trong nhá»¯ng [nhÃ  cung cáº¥p inference má»›i trÃªn Hub](https://huggingface.co/blog/inference-providers)!

GoogleSearchTool sá»­ dá»¥ng [Serper API](https://serper.dev) Ä‘á»ƒ tÃ¬m kiáº¿m web, vÃ¬ váº­y cáº§n thiáº¿t láº­p biáº¿n mÃ´i trÆ°á»ng `SERPAPI_API_KEY` vÃ  truyá»n `provider="serpapi"` hoáº·c cÃ³ `SERPER_API_KEY` vÃ  truyá»n `provider=serper`.

Náº¿u khÃ´ng cÃ³ Serper API, báº¡n cÃ³ thá»ƒ dÃ¹ng `DuckDuckGoSearchTool` nhÆ°ng lÆ°u Ã½ nÃ³ cÃ³ giá»›i háº¡n tá»‘c Ä‘á»™.

```python
import os
from PIL import Image
from smolagents import CodeAgent, GoogleSearchTool, HfApiModel, VisitWebpageTool

model = HfApiModel(model_id="Qwen/Qwen2.5-Coder-32B-Instruct", provider="together")
```

Ta cÃ³ thá»ƒ báº¯t Ä‘áº§u báº±ng cÃ¡ch táº¡o má»™t Agent Ä‘Æ¡n giáº£n lÃ m baseline Ä‘á»ƒ táº¡o bÃ¡o cÃ¡o cÆ¡ báº£n.

```python
task = """TÃ¬m táº¥t cáº£ Ä‘á»‹a Ä‘iá»ƒm quay phim Batman trÃªn tháº¿ giá»›i, tÃ­nh thá»i gian váº­n chuyá»ƒn báº±ng mÃ¡y bay chá»Ÿ hÃ ng Ä‘áº¿n Ä‘Ã¢y (ta Ä‘ang á»Ÿ Gotham, 40.7128Â° N, 74.0060Â° W) vÃ  tráº£ vá» dÆ°á»›i dáº¡ng dataframe pandas.
Äá»“ng thá»i cung cáº¥p má»™t sá»‘ nhÃ  mÃ¡y siÃªu xe cÃ³ cÃ¹ng thá»i gian váº­n chuyá»ƒn."""
```

```python
agent = CodeAgent(
    model=model,
    tools=[GoogleSearchTool("serper"), VisitWebpageTool(), calculate_cargo_travel_time],
    additional_authorized_imports=["pandas"],
    max_steps=20,
)
```

```python
result = agent.run(task)
```

```python
result
```

Trong trÆ°á»ng há»£p cá»§a chÃºng ta, nÃ³ táº¡o ra káº¿t quáº£:

<details>
<summary>Báº¥m Ä‘á»ƒ xem báº£n dá»‹ch tiáº¿ng Viá»‡t</summary>
```python
|  | Äá»‹a Ä‘iá»ƒm                                             | Thá»i gian Ä‘áº¿n Gotham (giá») |
|--|------------------------------------------------------|------------------------------|
| 0  | NghÄ©a trang Necropolis, Glasgow, Scotland, UK         | 8.60                         |
| 1  | St. George's Hall, Liverpool, Anh, UK         | 8.81                         |
| 2  | Two Temple Place, London, Anh, UK             | 9.17                         |
| 3  | Wollaton Hall, Nottingham, Anh, UK           | 9.00                         |
| 4  | Knebworth House, Knebworth, Hertfordshire, UK    | 9.15                         |
| 5  | NhÃ  mÃ¡y Ä‘iá»‡n Acton Lane, Acton Lane, Acton, UK  | 9.16                         |
| 6  | Cáº§u Queensboro, New York, Má»¹            | 1.01                         |
| 7  | Phá»‘ Wall, New York, Má»¹                  | 1.00                         |
| 8  | PhÃ¡o Ä‘Ã i Mehrangarh, Jodhpur, áº¤n Äá»™       | 18.34                        |
| 9  | Háº»m nÃºi Turda, Romania                      | 11.89                        |
| 10 | Chicago, Má»¹                                     | 2.68                         |
| 11 | Hong Kong, Trung Quá»‘c                                 | 19.99                        |
| 12 | XÆ°á»Ÿng phim Cardington, Northamptonshire, UK        | 9.10                         |
| 13 | Warner Bros. Leavesden Studios, Hertfordshire, UK | 9.13                         |
| 14 | Westwood, Los Angeles, Má»¹                  | 6.79                         |
| 15 | Woking, UK (McLaren)                             | 9.13                         |
```
</details>
```python
|  | Location                                             | Travel Time to Gotham (hours) |
|--|------------------------------------------------------|------------------------------|
| 0  | Necropolis Cemetery, Glasgow, Scotland, UK         | 8.60                         |
| 1  | St. George's Hall, Liverpool, England, UK         | 8.81                         |
| 2  | Two Temple Place, London, England, UK             | 9.17                         |
| 3  | Wollaton Hall, Nottingham, England, UK           | 9.00                         |
| 4  | Knebworth House, Knebworth, Hertfordshire, UK    | 9.15                         |
| 5  | Acton Lane Power Station, Acton Lane, Acton, UK  | 9.16                         |
| 6  | Queensboro Bridge, New York City, USA            | 1.01                         |
| 7  | Wall Street, New York City, USA                  | 1.00                         |
| 8  | Mehrangarh Fort, Jodhpur, Rajasthan, India       | 18.34                        |
| 9  | Turda Gorge, Turda, Romania                      | 11.89                        |
| 10 | Chicago, USA                                     | 2.68                         |
| 11 | Hong Kong, China                                 | 19.99                        |
| 12 | Cardington Studios, Northamptonshire, UK        | 9.10                         |
| 13 | Warner Bros. Leavesden Studios, Hertfordshire, UK | 9.13                         |
| 14 | Westwood, Los Angeles, CA, USA                  | 6.79                         |
| 15 | Woking, UK (McLaren)                             | 9.13                         |
```

Ta cÃ³ thá»ƒ cáº£i thiá»‡n báº±ng cÃ¡ch thÃªm cÃ¡c bÆ°á»›c láº­p káº¿ hoáº¡ch vÃ  prompt chi tiáº¿t hÆ¡n.

CÃ¡c bÆ°á»›c láº­p káº¿ hoáº¡ch cho phÃ©p Agent suy nghÄ© trÆ°á»›c vÃ  lÃªn káº¿ hoáº¡ch, há»¯u Ã­ch cho cÃ¡c tÃ¡c vá»¥ phá»©c táº¡p.

```python
agent.planning_interval = 4

detailed_report = agent.run(f"""
Báº¡n lÃ  chuyÃªn gia phÃ¢n tÃ­ch. HÃ£y táº¡o bÃ¡o cÃ¡o toÃ n diá»‡n sau khi truy cáº­p nhiá»u website.
Äá»«ng ngáº§n ngáº¡i tÃ¬m kiáº¿m nhiá»u truy váº¥n cÃ¹ng lÃºc trong vÃ²ng láº·p.
Vá»›i má»—i dá»¯ liá»‡u tÃ¬m tháº¥y, hÃ£y truy cáº­p URL nguá»“n Ä‘á»ƒ xÃ¡c nháº­n sá»‘ liá»‡u.

{task}
""")

print(detailed_report)
```

```python
detailed_report
```

Trong trÆ°á»ng há»£p cá»§a chÃºng ta, nÃ³ táº¡o ra:

<details>
<summary>Báº¥m Ä‘á»ƒ xem báº£n dá»‹ch tiáº¿ng Viá»‡t</summary>
```python
|  | Äá»‹a Ä‘iá»ƒm                                         | Thá»i gian di chuyá»ƒn (giá») |
|--|--------------------------------------------------|---------------------|
| 0  | Cáº§u Than thá»Ÿ, NghÄ©a trang Glasgow, UK | 8.6                 |
| 1  | Phá»‘ Wishart, Glasgow, Scotland, UK         | 8.6                 |
```
</details>
```python
|  | Location                                         | Travel Time (hours) |
|--|--------------------------------------------------|---------------------|
| 0  | Bridge of Sighs, Glasgow Necropolis, Glasgow, UK | 8.6                 |
| 1  | Wishart Street, Glasgow, Scotland, UK         | 8.6                 |


Nhá» nhá»¯ng thay Ä‘á»•i nhanh chÃ³ng nÃ y, ta Ä‘Ã£ cÃ³ bÃ¡o cÃ¡o cÃ´ Ä‘á»ng hÆ¡n chá»‰ báº±ng cÃ¡ch cung cáº¥p prompt chi tiáº¿t vÃ  thÃªm kháº£ nÄƒng láº­p káº¿ hoáº¡ch cho Agent!

Cá»­a sá»• ngá»¯ cáº£nh cá»§a model Ä‘ang nhanh chÃ³ng bá»‹ láº¥p Ä‘áº§y. **Náº¿u yÃªu cáº§u Agent káº¿t há»£p káº¿t quáº£ tá»« nhiá»u tÃ¬m kiáº¿m, nÃ³ sáº½ cháº­m dáº§n vÃ  lÃ m tÄƒng token cÃ¹ng chi phÃ­**.

â¡ï¸ ChÃºng ta cáº§n cáº£i thiá»‡n cáº¥u trÃºc há»‡ thá»‘ng.

### âœŒï¸ Chia tÃ¡c vá»¥ giá»¯a hai Agent

Cáº¥u trÃºc Ä‘a Agent cho phÃ©p tÃ¡ch biá»‡t bá»™ nhá»› giá»¯a cÃ¡c tÃ¡c vá»¥ con, mang láº¡i hai lá»£i Ã­ch lá»›n:
- Má»—i Agent táº­p trung hÆ¡n vÃ o tÃ¡c vá»¥ chÃ­nh, tá»« Ä‘Ã³ hiá»‡u suáº¥t cao hÆ¡n
- TÃ¡ch biá»‡t bá»™ nhá»› lÃ m giáº£m sá»‘ lÆ°á»£ng token Ä‘áº§u vÃ o á»Ÿ má»—i bÆ°á»›c, giáº£m Ä‘á»™ trá»… vÃ  chi phÃ­.

HÃ£y táº¡o má»™t nhÃ³m vá»›i Agent tÃ¬m kiáº¿m web chuyÃªn dá»¥ng, Ä‘Æ°á»£c quáº£n lÃ½ bá»Ÿi má»™t Agent khÃ¡c.

Agent quáº£n lÃ½ cáº§n kháº£ nÄƒng váº½ biá»ƒu Ä‘á»“ Ä‘á»ƒ táº¡o bÃ¡o cÃ¡o cuá»‘i: hÃ£y cáº¥p quyá»n truy cáº­p cÃ¡c thÆ° viá»‡n nhÆ° `plotly`, `geopandas` + `shapely` cho viá»‡c váº½ báº£n Ä‘á»“.

```python
model = HfApiModel(
    "Qwen/Qwen2.5-Coder-32B-Instruct", provider="together", max_tokens=8096
)

web_agent = CodeAgent(
    model=model,
    tools=[
        GoogleSearchTool(provider="serper"),
        VisitWebpageTool(),
        calculate_cargo_travel_time,
    ],
    name="web_agent",
    description="Duyá»‡t web Ä‘á»ƒ tÃ¬m thÃ´ng tin",
    verbosity_level=0,
    max_steps=10,
)
```

Agent quáº£n lÃ½ cáº§n xá»­ lÃ½ cÃ¡c tÃ¡c vá»¥ náº·ng vá» tÆ° duy.

VÃ¬ váº­y ta sá»­ dá»¥ng model máº¡nh hÆ¡n [DeepSeek-R1](https://huggingface.co/deepseek-ai/DeepSeek-R1), vÃ  thÃªm `planning_interval`.

```python
from smolagents.utils import encode_image_base64, make_image_url
from smolagents import OpenAIServerModel


def check_reasoning_and_plot(final_answer, agent_memory):
    multimodal_model = OpenAIServerModel("gpt-4o", max_tokens=8096)
    filepath = "saved_map.png"
    assert os.path.exists(filepath), "HÃ£y Ä‘áº£m báº£o lÆ°u biá»ƒu Ä‘á»“ dÆ°á»›i tÃªn saved_map.png!"
    image = Image.open(filepath)
    prompt = (
        f"ÄÃ¢y lÃ  tÃ¡c vá»¥ ngÆ°á»i dÃ¹ng vÃ  cÃ¡c bÆ°á»›c Agent Ä‘Ã£ thá»±c hiá»‡n: {agent_memory.get_succinct_steps()}. ÄÃ¢y lÃ  biá»ƒu Ä‘á»“ Ä‘Æ°á»£c táº¡o."
        "HÃ£y kiá»ƒm tra xem quÃ¡ trÃ¬nh láº­p luáº­n vÃ  biá»ƒu Ä‘á»“ cÃ³ chÃ­nh xÃ¡c khÃ´ng: chÃºng cÃ³ tráº£ lá»i Ä‘Ãºng tÃ¡c vá»¥ Ä‘Æ°á»£c giao khÃ´ng?"
        "Äáº§u tiÃªn liá»‡t kÃª lÃ½ do táº¡i sao Ä‘Ãºng/sai, sau Ä‘Ã³ Ä‘Æ°a ra quyáº¿t Ä‘á»‹nh cuá»‘i: VIáº¾T HOA PASS náº¿u Ä‘áº¡t yÃªu cáº§u, FAIL náº¿u khÃ´ng."
        "Äá»«ng quÃ¡ kháº¯t khe: náº¿u biá»ƒu Ä‘á»“ giáº£i quyáº¿t Ä‘Æ°á»£c pháº§n lá»›n tÃ¡c vá»¥, nÃªn pass."
        "Äá»ƒ pass, biá»ƒu Ä‘á»“ pháº£i Ä‘Æ°á»£c táº¡o báº±ng px.scatter_map chá»© khÃ´ng pháº£i phÆ°Æ¡ng phÃ¡p khÃ¡c (scatter_map trÃ´ng Ä‘áº¹p hÆ¡n)."
    )
    messages = [
        {
            "role": "user",
            "content": [
                {
                    "type": "text",
                    "text": prompt,
                },
                {
                    "type": "image_url",
                    "image_url": {"url": make_image_url(encode_image_base64(image))},
                },
            ],
        }
    ]
    output = multimodal_model(messages).content
    print("Pháº£n há»“i: ", output)
    if "FAIL" in output:
        raise Exception(output)
    return True


manager_agent = CodeAgent(
    model=HfApiModel("deepseek-ai/DeepSeek-R1", provider="together", max_tokens=8096),
    tools=[calculate_cargo_travel_time],
    managed_agents=[web_agent],
    additional_authorized_imports=[
        "geopandas",
        "plotly",
        "shapely",
        "json",
        "pandas",
        "numpy",
    ],
    planning_interval=5,
    verbosity_level=2,
    final_answer_checks=[check_reasoning_and_plot],
    max_steps=15,
)
```

HÃ£y xem cáº¥u trÃºc nhÃ³m Agent:

```python
manager_agent.visualize()
```

Káº¿t quáº£ sáº½ tÆ°Æ¡ng tá»± tháº¿ nÃ y, giÃºp ta hiá»ƒu má»‘i quan há»‡ giá»¯a cÃ¡c Agent vÃ  cÃ´ng cá»¥ sá»­ dá»¥ng:

<details>
<summary>Báº¥m Ä‘á»ƒ xem báº£n dá»‹ch tiáº¿ng Viá»‡t</summary>
```python
CodeAgent | deepseek-ai/DeepSeek-R1
â”œâ”€â”€ âœ… CÃ¡c import Ä‘Æ°á»£c phÃ©p: ['geopandas', 'plotly', 'shapely', 'json', 'pandas', 'numpy']
â”œâ”€â”€ ğŸ› ï¸ CÃ´ng cá»¥:
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”‚   â”ƒ TÃªn                        â”ƒ MÃ´ táº£                           â”ƒ Tham sá»‘                             â”ƒ
â”‚   â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚   â”‚ calculate_cargo_travel_time â”‚ TÃ­nh thá»i gian di chuyá»ƒn mÃ¡y bay chá»Ÿ hÃ ng giá»¯a hai Ä‘iá»ƒm trÃªn TrÃ¡i Äáº¥t     â”‚ origin_coords (`array`): Tuple (vÄ© Ä‘á»™, kinh Ä‘á»™) Ä‘iá»ƒm xuáº¥t phÃ¡t                        â”‚
â”‚   â”‚                             â”‚                                       â”‚ destination_coords (`array`): Tuple (vÄ© Ä‘á»™, kinh Ä‘á»™) Ä‘iá»ƒm Ä‘áº¿n                           â”‚
â”‚   â”‚                             â”‚                                       â”‚ cruising_speed_kmh (`number`): Tá»‘c Ä‘á»™ bay tÃ¹y chá»n (máº·c Ä‘á»‹nh 750 km/h)                         â”‚
â”‚   â”‚ final_answer                â”‚ Cung cáº¥p cÃ¢u tráº£ lá»i cuá»‘i cÃ¹ng       â”‚ answer (`any`): CÃ¢u tráº£ lá»i cuá»‘i cÃ¹ng                           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€ ğŸ¤– CÃ¡c Agent quáº£n lÃ½:
    â””â”€â”€ web_agent | CodeAgent | Qwen/Qwen2.5-Coder-32B-Instruct
        â”œâ”€â”€ âœ… CÃ¡c import Ä‘Æ°á»£c phÃ©p: []
        â”œâ”€â”€ ğŸ“ MÃ´ táº£: Duyá»‡t web Ä‘á»ƒ tÃ¬m thÃ´ng tin
        â””â”€â”€ ğŸ› ï¸ CÃ´ng cá»¥:
            â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
            â”ƒ TÃªn                        â”ƒ MÃ´ táº£                       â”ƒ Tham sá»‘                         â”ƒ
            â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
            â”‚ web_search                  â”‚ Thá»±c hiá»‡n tÃ¬m kiáº¿m Google       â”‚ query (`string`): Truy váº¥n tÃ¬m kiáº¿m                 â”‚
            â”‚ visit_webpage               â”‚ Truy cáº­p webpage               â”‚ url (`string`): URL cáº§n truy cáº­p                 â”‚
            â”‚ calculate_cargo_travel_time â”‚ TÃ­nh thá»i gian di chuyá»ƒn mÃ¡y bay chá»Ÿ hÃ ng â”‚ origin_coords (`array`): Tuple (vÄ© Ä‘á»™, kinh Ä‘á»™) Ä‘iá»ƒm xuáº¥t phÃ¡t                    â”‚
            â”‚ final_answer                â”‚ Cung cáº¥p cÃ¢u tráº£ lá»i cuá»‘i cÃ¹ng  â”‚ answer (`any`): CÃ¢u tráº£ lá»i cuá»‘i cÃ¹ng                    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
</details>
```python
CodeAgent | deepseek-ai/DeepSeek-R1
â”œâ”€â”€ âœ… Authorized imports: ['geopandas', 'plotly', 'shapely', 'json', 'pandas', 'numpy']
â”œâ”€â”€ ğŸ› ï¸ Tools:
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”‚   â”ƒ Name                        â”ƒ Description                           â”ƒ Arguments                             â”ƒ
â”‚   â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚   â”‚ calculate_cargo_travel_time â”‚ Calculate the travel time for a cargo â”‚ origin_coords (`array`): Tuple of     â”‚
â”‚   â”‚                             â”‚ plane between two points on Earth     â”‚ (latitude, longitude) for the         â”‚
â”‚   â”‚                             â”‚ using great-circle distance.          â”‚ starting point                        â”‚
â”‚   â”‚                             â”‚                                       â”‚ destination_coords (`array`): Tuple   â”‚
â”‚   â”‚                             â”‚                                       â”‚ of (latitude, longitude) for the      â”‚
â”‚   â”‚                             â”‚                                       â”‚ destination                           â”‚
â”‚   â”‚                             â”‚                                       â”‚ cruising_speed_kmh (`number`):        â”‚
â”‚   â”‚                             â”‚                                       â”‚ Optional cruising speed in km/h       â”‚
â”‚   â”‚                             â”‚                                       â”‚ (defaults to 750 km/h for typical     â”‚
â”‚   â”‚                             â”‚                                       â”‚ cargo planes)                         â”‚
â”‚   â”‚ final_answer                â”‚ Provides a final answer to the given  â”‚ answer (`any`): The final answer to   â”‚
â”‚   â”‚                             â”‚ problem.                              â”‚ the problem                           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€ ğŸ¤– Managed agents:
    â””â”€â”€ web_agent | CodeAgent | Qwen/Qwen2.5-Coder-32B-Instruct
        â”œâ”€â”€ âœ… Authorized imports: []
        â”œâ”€â”€ ğŸ“ Description: Browses the web to find information
        â””â”€â”€ ğŸ› ï¸ Tools:
            â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
            â”ƒ Name                        â”ƒ Description                       â”ƒ Arguments                         â”ƒ
            â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
            â”‚ web_search                  â”‚ Performs a google web search for  â”‚ query (`string`): The search      â”‚
            â”‚                             â”‚ your query then returns a string  â”‚ query to perform.                 â”‚
            â”‚                             â”‚ of the top search results.        â”‚ filter_year (`integer`):          â”‚
            â”‚                             â”‚                                   â”‚ Optionally restrict results to a  â”‚
            â”‚                             â”‚                                   â”‚ certain year                      â”‚
            â”‚ visit_webpage               â”‚ Visits a webpage at the given url â”‚ url (`string`): The url of the    â”‚
            â”‚                             â”‚ and reads its content as a        â”‚ webpage to visit.                 â”‚
            â”‚                             â”‚ markdown string. Use this to      â”‚                                   â”‚
            â”‚                             â”‚ browse webpages.                  â”‚                                   â”‚
            â”‚ calculate_cargo_travel_time â”‚ Calculate the travel time for a   â”‚ origin_coords (`array`): Tuple of â”‚
            â”‚                             â”‚ cargo plane between two points on â”‚ (latitude, longitude) for the     â”‚
            â”‚                             â”‚ Earth using great-circle          â”‚ starting point                    â”‚
            â”‚                             â”‚ distance.                         â”‚ destination_coords (`array`):     â”‚
            â”‚                             â”‚                                   â”‚ Tuple of (latitude, longitude)    â”‚
            â”‚                             â”‚                                   â”‚ for the destination               â”‚
            â”‚                             â”‚                                   â”‚ cruising_speed_kmh (`number`):    â”‚
            â”‚                             â”‚                                   â”‚ Optional cruising speed in km/h   â”‚
            â”‚                             â”‚                                   â”‚ (defaults to 750 km/h for typical â”‚
            â”‚                             â”‚                                   â”‚ cargo planes)                     â”‚
            â”‚ final_answer                â”‚ Provides a final answer to the    â”‚ answer (`any`): The final answer  â”‚
            â”‚                             â”‚ given problem.                    â”‚ to the problem                    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```python
manager_agent.run("""
TÃ¬m táº¥t cáº£ Ä‘á»‹a Ä‘iá»ƒm quay phim Batman trÃªn tháº¿ giá»›i, tÃ­nh thá»i gian váº­n chuyá»ƒn báº±ng mÃ¡y bay chá»Ÿ hÃ ng Ä‘áº¿n Ä‘Ã¢y (ta Ä‘ang á»Ÿ Gotham, 40.7128Â° N, 74.0060Â° W).
Äá»“ng thá»i cung cáº¥p má»™t sá»‘ nhÃ  mÃ¡y siÃªu xe cÃ³ cÃ¹ng thá»i gian váº­n chuyá»ƒn. Cáº§n Ã­t nháº¥t 6 Ä‘iá»ƒm tá»•ng cá»™ng.
Biá»ƒu diá»…n dá»¯ liá»‡u dÆ°á»›i dáº¡ng báº£n Ä‘á»“ tháº¿ giá»›i, cÃ¡c Ä‘á»‹a Ä‘iá»ƒm hiá»ƒn thá»‹ báº±ng Ä‘iá»ƒm phÃ¢n tÃ¡n vá»›i mÃ u phá»¥ thuá»™c vÃ o thá»i gian váº­n chuyá»ƒn, vÃ  lÆ°u vÃ o saved_map.png!

ÄÃ¢y lÃ  vÃ­ dá»¥ cÃ¡ch váº½ vÃ  tráº£ vá» báº£n Ä‘á»“:
import plotly.express as px
df = px.data.carshare()
fig = px.scatter_map(df, lat="centroid_lat", lon="centroid_lon", text="name", color="peak_hour", size=100,
     color_continuous_scale=px.colors.sequential.Magma, size_max=15, zoom=1)
fig.show()
fig.write_image("saved_image.png")
final_answer(fig)

KhÃ´ng bao giá» xá»­ lÃ½ chuá»—i báº±ng code: khi cÃ³ chuá»—i cáº§n Ä‘á»c, chá»‰ cáº§n in ra vÃ  báº¡n sáº½ tháº¥y nÃ³.
""")
```

TÃ´i khÃ´ng biáº¿t káº¿t quáº£ cháº¡y cá»§a báº¡n tháº¿ nÃ o, nhÆ°ng trong trÆ°á»ng há»£p cá»§a tÃ´i, Agent quáº£n lÃ½ Ä‘Ã£ khÃ©o lÃ©o phÃ¢n chia tÃ¡c vá»¥ cho web_agent trong `1. TÃ¬m Ä‘á»‹a Ä‘iá»ƒm quay Batman`, sau Ä‘Ã³ `2. TÃ¬m nhÃ  mÃ¡y siÃªu xe`, trÆ°á»›c khi tá»•ng há»£p danh sÃ¡ch vÃ  váº½ báº£n Ä‘á»“.

HÃ£y xem báº£n Ä‘á»“ trÃ´ng tháº¿ nÃ o báº±ng cÃ¡ch kiá»ƒm tra trá»±c tiáº¿p tá»« tráº¡ng thÃ¡i Agent:

```python
manager_agent.python_executor.state["fig"]
```

Káº¿t quáº£ sáº½ hiá»ƒn thá»‹ báº£n Ä‘á»“:

![Báº£n Ä‘á»“ vÃ­ dá»¥ há»‡ thá»‘ng Ä‘a Agent](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit2/smolagents/output_map.png)

## TÃ i nguyÃªn

- [Há»‡ thá»‘ng Äa Agent](https://huggingface.co/docs/smolagents/main/en/examples/multiagents) â€“