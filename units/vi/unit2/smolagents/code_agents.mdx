<CourseFloatingBanner chapter={2}
  classNames="absolute z-10 right-0 top-0"
  notebooks={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/agents-course/blob/main/notebooks/unit2/smolagents/code_agents.ipynb"},
]} />

# XÃ¢y dá»±ng Agent sá»­ dá»¥ng code

Code Agent lÃ  loáº¡i Agent máº·c Ä‘á»‹nh trong `smolagents`. ChÃºng táº¡o ra cÃ¡c lá»‡nh gá»i cÃ´ng cá»¥ Python Ä‘á»ƒ thá»±c hiá»‡n hÃ nh Ä‘á»™ng, Ä‘áº¡t Ä‘Æ°á»£c biá»ƒu diá»…n hÃ nh Ä‘á»™ng hiá»‡u quáº£, biá»ƒu cáº£m vÃ  chÃ­nh xÃ¡c.

CÃ¡ch tiáº¿p cáº­n tá»‘i giáº£n nÃ y giÃºp giáº£m sá»‘ lÆ°á»£ng hÃ nh Ä‘á»™ng cáº§n thiáº¿t, Ä‘Æ¡n giáº£n hÃ³a cÃ¡c thao tÃ¡c phá»©c táº¡p vÃ  cho phÃ©p tÃ¡i sá»­ dá»¥ng cÃ¡c hÃ m code cÃ³ sáºµn. `smolagents` cung cáº¥p má»™t framework nháº¹ Ä‘á»ƒ xÃ¢y dá»±ng code agent, Ä‘Æ°á»£c triá»ƒn khai trong khoáº£ng 1,000 dÃ²ng code.

![HÃ nh Ä‘á»™ng dáº¡ng code so vá»›i JSON](https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/transformers/code_vs_json_actions.png)
Äá»“ há»a tá»« bÃ i bÃ¡o [Executable Code Actions Elicit Better LLM Agents](https://huggingface.co/papers/2402.01030)

<Tip>
Náº¿u muá»‘n tÃ¬m hiá»ƒu thÃªm vá» lÃ½ do code agent hiá»‡u quáº£, hÃ£y xem <a href="https://huggingface.co/docs/smolagents/en/conceptual_guides/intro_agents#code-agents" target="_blank">hÆ°á»›ng dáº«n nÃ y</a> tá»« tÃ i liá»‡u smolagents.
</Tip>

## Táº¡i sao nÃªn dÃ¹ng Code Agent?

Trong quy trÃ¬nh Ä‘a bÆ°á»›c cá»§a Agent, LLM viáº¿t vÃ  thá»±c thi cÃ¡c hÃ nh Ä‘á»™ng, thÆ°á»ng liÃªn quan Ä‘áº¿n lá»‡nh gá»i cÃ´ng cá»¥ bÃªn ngoÃ i. CÃ¡ch tiáº¿p cáº­n truyá»n thá»‘ng sá»­ dá»¥ng Ä‘á»‹nh dáº¡ng JSON Ä‘á»ƒ chá»‰ Ä‘á»‹nh tÃªn cÃ´ng cá»¥ vÃ  Ä‘á»‘i sá»‘ dÆ°á»›i dáº¡ng chuá»—i, **mÃ  há»‡ thá»‘ng pháº£i phÃ¢n tÃ­ch Ä‘á»ƒ xÃ¡c Ä‘á»‹nh cÃ´ng cá»¥ cáº§n thá»±c thi**.

Tuy nhiÃªn, nghiÃªn cá»©u cho tháº¥y **LLM thá»±c thi cÃ´ng cá»¥ hoáº¡t Ä‘á»™ng hiá»‡u quáº£ hÆ¡n khi lÃ m viá»‡c trá»±c tiáº¿p vá»›i code**. ÄÃ¢y lÃ  nguyÃªn lÃ½ cá»‘t lÃµi cá»§a `smolagents`, nhÆ° minh há»a trong biá»ƒu Ä‘á»“ trÃªn tá»« [Executable Code Actions Elicit Better LLM Agents](https://huggingface.co/papers/2402.01030).

Viáº¿t hÃ nh Ä‘á»™ng báº±ng code thay vÃ¬ JSON mang láº¡i nhiá»u lá»£i tháº¿ chÃ­nh:

* **Kháº£ nÄƒng káº¿t há»£p**: Dá»… dÃ ng káº¿t há»£p vÃ  tÃ¡i sá»­ dá»¥ng hÃ nh Ä‘á»™ng
* **Quáº£n lÃ½ Ä‘á»‘i tÆ°á»£ng**: LÃ m viá»‡c trá»±c tiáº¿p vá»›i cÃ¡c cáº¥u trÃºc phá»©c táº¡p nhÆ° hÃ¬nh áº£nh
* **TÃ­nh tá»•ng quÃ¡t**: Biá»ƒu diá»…n má»i tÃ¡c vá»¥ cÃ³ thá»ƒ tÃ­nh toÃ¡n Ä‘Æ°á»£c
* **Tá»± nhiÃªn vá»›i LLM**: Dá»¯ liá»‡u training cá»§a LLM Ä‘Ã£ chá»©a code cháº¥t lÆ°á»£ng cao

## Code Agent hoáº¡t Ä‘á»™ng tháº¿ nÃ o?

![Tá»« https://huggingface.co/docs/smolagents/conceptual_guides/react](https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/smolagents/codeagent_docs.png)

Biá»ƒu Ä‘á»“ trÃªn minh há»a cÃ¡ch `CodeAgent.run()` hoáº¡t Ä‘á»™ng, theo framework ReAct mÃ  ta Ä‘Ã£ Ä‘á» cáº­p á»Ÿ ChÆ°Æ¡ng 1. KhÃ¡i niá»‡m chÃ­nh cho Agent trong `smolagents` lÃ  `MultiStepAgent`, Ä‘Ã³ng vai trÃ² lÃ  khá»‘i xÃ¢y dá»±ng cá»‘t lÃµi. `CodeAgent` lÃ  má»™t dáº¡ng Ä‘áº·c biá»‡t cá»§a `MultiStepAgent`, nhÆ° ta sáº½ tháº¥y trong vÃ­ dá»¥ dÆ°á»›i Ä‘Ã¢y.

Má»™t `CodeAgent` thá»±c hiá»‡n hÃ nh Ä‘á»™ng thÃ´ng qua chu trÃ¬nh cÃ¡c bÆ°á»›c, vá»›i cÃ¡c biáº¿n vÃ  kiáº¿n thá»©c hiá»‡n cÃ³ Ä‘Æ°á»£c tÃ­ch há»£p vÃ o ngá»¯ cáº£nh cá»§a Agent, Ä‘Æ°á»£c lÆ°u trong nháº­t kÃ½ thá»±c thi:

1. Prompt há»‡ thá»‘ng Ä‘Æ°á»£c lÆ°u trong `SystemPromptStep`, vÃ  truy váº¥n ngÆ°á»i dÃ¹ng Ä‘Æ°á»£c ghi láº¡i trong `TaskStep`.

2. Sau Ä‘Ã³, vÃ²ng láº·p while sau Ä‘Æ°á»£c thá»±c thi:

    2.1 PhÆ°Æ¡ng thá»©c `agent.write_memory_to_messages()` ghi nháº­t kÃ½ cá»§a Agent vÃ o danh sÃ¡ch [tin nháº¯n chat](https://huggingface.co/docs/transformers/main/en/chat_templating) mÃ  LLM cÃ³ thá»ƒ Ä‘á»c Ä‘Æ°á»£c.
    
    2.2 CÃ¡c tin nháº¯n nÃ y Ä‘Æ°á»£c gá»­i tá»›i `Model`, nÆ¡i táº¡o ra pháº§n hoÃ n thÃ nh.
    
    2.3 Pháº§n hoÃ n thÃ nh Ä‘Æ°á»£c phÃ¢n tÃ­ch Ä‘á»ƒ trÃ­ch xuáº¥t hÃ nh Ä‘á»™ng, trong trÆ°á»ng há»£p cá»§a chÃºng ta nÃªn lÃ  má»™t Ä‘oáº¡n code vÃ¬ ta Ä‘ang lÃ m viá»‡c vá»›i `CodeAgent`.  
    
    2.4 HÃ nh Ä‘á»™ng Ä‘Æ°á»£c thá»±c thi.
    
    2.5 Káº¿t quáº£ Ä‘Æ°á»£c ghi vÃ o bá»™ nhá»› trong `ActionStep`.

Cuá»‘i má»—i bÆ°á»›c, náº¿u Agent chá»©a báº¥t ká»³ lá»‡nh gá»i hÃ m nÃ o (trong `agent.step_callback`), chÃºng sáº½ Ä‘Æ°á»£c thá»±c thi.

## CÃ¹ng xem vÃ­ dá»¥

<Tip>
Báº¡n cÃ³ thá»ƒ theo dÃµi code trong <a href="https://huggingface.co/agents-course/notebooks/blob/main/unit2/smolagents/code_agents.ipynb" target="_blank">notebook nÃ y</a> vÃ  cháº¡y báº±ng Google Colab.
</Tip>

Alfred Ä‘ang lÃªn káº¿ hoáº¡ch tá»• chá»©c tiá»‡c táº¡i biá»‡t thá»± gia Ä‘Ã¬nh Wayne vÃ  cáº§n báº¡n giÃºp Ä‘áº£m báº£o má»i thá»© diá»…n ra suÃ´n sáº». Äá»ƒ há»— trá»£ anh áº¥y, chÃºng ta sáº½ Ã¡p dá»¥ng nhá»¯ng gÃ¬ Ä‘Ã£ há»c vá» cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a `CodeAgent` Ä‘a bÆ°á»›c.

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit2/smolagents/alfred-party.jpg" alt="Alfred tá»• chá»©c tiá»‡c"/>

Náº¿u chÆ°a cÃ i Ä‘áº·t `smolagents`, báº¡n cÃ³ thá»ƒ cháº¡y lá»‡nh sau:

```bash
pip install smolagents -U
```

Äá»“ng thá»i Ä‘Äƒng nháº­p vÃ o Hugging Face Hub Ä‘á»ƒ truy cáº­p Serverless Inference API.

```python
from huggingface_hub import login

login()
```

### Lá»±a chá»n playlist cho bá»¯a tiá»‡c báº±ng `smolagents`

Ã‚m nháº¡c lÃ  pháº§n thiáº¿t yáº¿u cá»§a má»™t bá»¯a tiá»‡c thÃ nh cÃ´ng! Alfred cáº§n giÃºp Ä‘á»¡ Ä‘á»ƒ chá»n playlist. May máº¯n thay, `smolagents` Ä‘Ã£ cÃ³ sáºµn giáº£i phÃ¡p! ChÃºng ta cÃ³ thá»ƒ xÃ¢y dá»±ng má»™t Agent cÃ³ kháº£ nÄƒng tÃ¬m kiáº¿m web báº±ng DuckDuckGo. Äá»ƒ cáº¥p quyá»n truy cáº­p cÃ´ng cá»¥ nÃ y cho Agent, chÃºng ta thÃªm nÃ³ vÃ o danh sÃ¡ch cÃ´ng cá»¥ khi táº¡o Agent.

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit2/smolagents/alfred-playlist.jpg" alt="Alfred chá»n playlist"/>

Vá» mÃ´ hÃ¬nh, chÃºng ta sáº½ dÃ¹ng `HfApiModel` Ä‘á»ƒ truy cáº­p [Serverless Inference API](https://huggingface.co/docs/api-inference/index) cá»§a Hugging Face. MÃ´ hÃ¬nh máº·c Ä‘á»‹nh lÃ  `"Qwen/Qwen2.5-Coder-32B-Instruct"` - mÃ´ hÃ¬nh hiá»‡u nÄƒng cao vÃ  cÃ³ sáºµn cho inference nhanh, nhÆ°ng báº¡n cÃ³ thá»ƒ chá»n báº¥t ká»³ mÃ´ hÃ¬nh tÆ°Æ¡ng thÃ­ch nÃ o tá»« Hub.

Cháº¡y Agent khÃ¡ Ä‘Æ¡n giáº£n:

```python
from smolagents import CodeAgent, DuckDuckGoSearchTool, HfApiModel

agent = CodeAgent(tools=[DuckDuckGoSearchTool()], model=HfApiModel())

agent.run("Search for the best music recommendations for a party at the Wayne's mansion.")
```

Khi cháº¡y vÃ­ dá»¥ nÃ y, Ä‘áº§u ra sáº½ **hiá»ƒn thá»‹ lá»™ trÃ¬nh cÃ¡c bÆ°á»›c workflow Ä‘Æ°á»£c thá»±c thi**. NÃ³ cÅ©ng in code Python tÆ°Æ¡ng á»©ng vá»›i thÃ´ng bÃ¡o:

```python
 â”€ Executing parsed code: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 
  results = web_search(query="best music for a Batman party")                                                      
  print(results)                                                                                                   
 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 
```

Sau vÃ i bÆ°á»›c, báº¡n sáº½ tháº¥y playlist Ä‘Æ°á»£c táº¡o ra mÃ  Alfred cÃ³ thá»ƒ dÃ¹ng cho bá»¯a tiá»‡c! ğŸµ

### Sá»­ dá»¥ng cÃ´ng cá»¥ tÃ¹y chá»‰nh Ä‘á»ƒ chuáº©n bá»‹ thá»±c Ä‘Æ¡n

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit2/smolagents/alfred-menu.jpg" alt="Alfred chuáº©n bá»‹ thá»±c Ä‘Æ¡n"/>

Giá» Ä‘Ã£ cÃ³ playlist, chÃºng ta cáº§n sáº¯p xáº¿p thá»±c Ä‘Æ¡n cho khÃ¡ch. Má»™t láº§n ná»¯a, Alfred cÃ³ thá»ƒ táº­n dá»¥ng `smolagents` Ä‘á»ƒ lÃ m Ä‘iá»u nÃ y. á» Ä‘Ã¢y, chÃºng ta dÃ¹ng decorator `@tool` Ä‘á»ƒ Ä‘á»‹nh nghÄ©a hÃ m tÃ¹y chá»‰nh Ä‘Ã³ng vai trÃ² cÃ´ng cá»¥. ChÃºng ta sáº½ tÃ¬m hiá»ƒu chi tiáº¿t vá» táº¡o cÃ´ng cá»¥ sau, hiá»‡n táº¡i cá»© cháº¡y code trÆ°á»›c.

NhÆ° báº¡n tháº¥y trong vÃ­ dá»¥ dÆ°á»›i, chÃºng ta sáº½ táº¡o cÃ´ng cá»¥ báº±ng decorator `@tool` vÃ  thÃªm vÃ o danh sÃ¡ch `tools`.

```python
from smolagents import CodeAgent, tool, HfApiModel

# CÃ´ng cá»¥ Ä‘á» xuáº¥t thá»±c Ä‘Æ¡n theo dá»‹p
@tool
def suggest_menu(occasion: str) -> str:
    """
    Äá» xuáº¥t thá»±c Ä‘Æ¡n dá»±a trÃªn dá»‹p.
    Args:
        occasion (str): Loáº¡i dá»‹p cho bá»¯a tiá»‡c. GiÃ¡ trá»‹ cho phÃ©p:
                        - "casual": Thá»±c Ä‘Æ¡n tiá»‡c thÃ´ng thÆ°á»ng.
                        - "formal": Thá»±c Ä‘Æ¡n tiá»‡c trang trá»ng.
                        - "superhero": Thá»±c Ä‘Æ¡n tiá»‡c siÃªu anh hÃ¹ng.
                        - "custom": Thá»±c Ä‘Æ¡n tÃ¹y chá»‰nh.
    """
    if occasion == "casual":
        return "Pizza, Ä‘á»“ Äƒn nháº¹ vÃ  Ä‘á»“ uá»‘ng."
    elif occasion == "formal":
        return "Bá»¯a tá»‘i 3 mÃ³n vá»›i rÆ°á»£u vÃ  trÃ¡ng miá»‡ng."
    elif occasion == "superhero":
        return "Tiá»‡c tá»± chá»n vá»›i Ä‘á»“ Äƒn giÃ u nÄƒng lÆ°á»£ng vÃ  lÃ nh máº¡nh."
    else:
        return "Thá»±c Ä‘Æ¡n tÃ¹y chá»‰nh cho quáº£n gia."

# Alfred, quáº£n gia, chuáº©n bá»‹ thá»±c Ä‘Æ¡n cho bá»¯a tiá»‡c
agent = CodeAgent(tools=[suggest_menu], model=HfApiModel())

# Chuáº©n bá»‹ thá»±c Ä‘Æ¡n tiá»‡c trang trá»ng
agent.run("Prepare a formal menu for the party.")
```

Agent sáº½ cháº¡y qua vÃ i bÆ°á»›c cho Ä‘áº¿n khi tÃ¬m ra cÃ¢u tráº£ lá»i. Viá»‡c chá»‰ rÃµ giÃ¡ trá»‹ cho phÃ©p trong docstring giÃºp Ä‘á»‹nh hÆ°á»›ng Agent Ä‘áº¿n cÃ¡c giÃ¡ trá»‹ `occasion` há»£p lá»‡ vÃ  háº¡n cháº¿ áº£o giÃ¡c.

Thá»±c Ä‘Æ¡n Ä‘Ã£ sáºµn sÃ ng! ğŸ¥—

### Sá»­ dá»¥ng import Python trong Agent

ÄÃ£ cÃ³ playlist vÃ  thá»±c Ä‘Æ¡n, nhÆ°ng cáº§n kiá»ƒm tra má»™t chi tiáº¿t quan trá»ng: thá»i gian chuáº©n bá»‹!

Alfred cáº§n tÃ­nh toÃ¡n má»i thá»© sáº½ sáºµn sÃ ng vÃ o lÃºc nÃ o náº¿u báº¯t Ä‘áº§u ngay bÃ¢y giá», phÃ²ng trÆ°á»ng há»£p cáº§n sá»± trá»£ giÃºp tá»« cÃ¡c siÃªu anh hÃ¹ng khÃ¡c.

`smolagents` chuyÃªn vá» cÃ¡c Agent viáº¿t vÃ  thá»±c thi Ä‘oáº¡n code Python, cung cáº¥p mÃ´i trÆ°á»ng thá»±c thi an toÃ n.  
**Viá»‡c thá»±c thi code cÃ³ cÃ¡c biá»‡n phÃ¡p báº£o máº­t nghiÃªm ngáº·t** - cÃ¡c import ngoÃ i danh sÃ¡ch an toÃ n Ä‘á»‹nh trÆ°á»›c bá»‹ cháº·n máº·c Ä‘á»‹nh. Tuy nhiÃªn, báº¡n cÃ³ thá»ƒ á»§y quyá»n thÃªm import báº±ng cÃ¡ch truyá»n chÃºng dÆ°á»›i dáº¡ng chuá»—i trong `additional_authorized_imports`.
Äá»ƒ biáº¿t thÃªm chi tiáº¿t vá» thá»±c thi code an toÃ n, xem [hÆ°á»›ng dáº«n chÃ­nh thá»©c](https://huggingface.co/docs/smolagents/tutorials/secure_code_execution).

Khi táº¡o Agent, chÃºng ta sáº½ dÃ¹ng `additional_authorized_imports` Ä‘á»ƒ cho phÃ©p import module `datetime`.

```python
from smolagents import CodeAgent, HfApiModel
import numpy as np
import time
import datetime

agent = CodeAgent(tools=[], model=HfApiModel(), additional_authorized_imports=['datetime'])

agent.run(
    """
    Alfred cáº§n chuáº©n bá»‹ cho bá»¯a tiá»‡c. CÃ¡c cÃ´ng viá»‡c bao gá»“m:
    1. Chuáº©n bá»‹ Ä‘á»“ uá»‘ng - 30 phÃºt
    2. Trang trÃ­ biá»‡t thá»± - 60 phÃºt
    3. Chuáº©n bá»‹ thá»±c Ä‘Æ¡n - 45 phÃºt
    4. Chuáº©n bá»‹ Ã¢m nháº¡c vÃ  playlist - 45 phÃºt

    Náº¿u báº¯t Ä‘áº§u ngay bÃ¢y giá», máº¥y giá» má»i thá»© sáº½ sáºµn sÃ ng?
    """
)
```

Nhá»¯ng vÃ­ dá»¥ nÃ y má»›i chá»‰ lÃ  khá»Ÿi Ä‘áº§u cho nhá»¯ng gÃ¬ báº¡n cÃ³ thá»ƒ lÃ m vá»›i code agent, vÃ  chÃºng ta Ä‘Ã£ tháº¥y Ä‘Æ°á»£c tiá»‡n Ã­ch cá»§a chÃºng trong viá»‡c chuáº©n bá»‹ tiá»‡c.  
Báº¡n cÃ³ thá»ƒ tÃ¬m hiá»ƒu thÃªm vá» cÃ¡ch xÃ¢y dá»±ng code agent trong [tÃ i liá»‡u smolagents](https://huggingface.co/docs/smolagents).

TÃ³m láº¡i, `smolagents` chuyÃªn vá» cÃ¡c Agent viáº¿t vÃ  thá»±c thi Ä‘oáº¡n code Python, cung cáº¥p mÃ´i trÆ°á»ng thá»±c thi an toÃ n. NÃ³ há»— trá»£ cáº£ mÃ´ hÃ¬nh ngÃ´n ngá»¯ local vÃ  dá»±a trÃªn API, giÃºp thÃ­ch á»©ng vá»›i nhiá»u mÃ´i trÆ°á»ng phÃ¡t triá»ƒn khÃ¡c nhau.

### Chia sáº» Agent chuáº©n bá»‹ tiá»‡c tá»›i Hub

Sáº½ **tuyá»‡t vá»i tháº¿ nÃ o náº¿u chia sáº» Agent Alfred cá»§a chÃºng ta vá»›i cá»™ng Ä‘á»“ng**? Báº±ng cÃ¡ch nÃ y, má»i ngÆ°á»i cÃ³ thá»ƒ dá»… dÃ ng táº£i vÃ  dÃ¹ng Agent trá»±c tiáº¿p tá»« Hub, mang Ä‘áº¿n cÃ´ng cá»¥ lÃªn káº¿ hoáº¡ch tiá»‡c tá»‘i Æ°u cá»§a Gotham! HÃ£y biáº¿n Ä‘iá»u nÃ y thÃ nh hiá»‡n thá»±c! ğŸ‰

ThÆ° viá»‡n `smolagents` cho phÃ©p thá»±c hiá»‡n Ä‘iá»u nÃ y báº±ng cÃ¡ch chia sáº» toÃ n bá»™ Agent vá»›i cá»™ng Ä‘á»“ng vÃ  táº£i vá» Ä‘á»ƒ dÃ¹ng ngay. ÄÆ¡n giáº£n nhÆ° sau:

```python
# Äá»•i thÃ nh username vÃ  repo name cá»§a báº¡n
agent.push_to_hub('sergiopaniego/AlfredAgent')
```

Äá»ƒ táº£i láº¡i Agent, dÃ¹ng code sau:

```python
# Äá»•i thÃ nh username vÃ  repo name cá»§a báº¡n
alfred_agent = agent.from_hub('sergiopaniego/AlfredAgent', trust_remote_code=True)

alfred_agent.run("Give me the best playlist for a party at Wayne's mansion. The party idea is a 'villain masquerade' theme")  
```

Äiá»u thÃº vá»‹ lÃ  cÃ¡c Agent Ä‘Æ°á»£c chia sáº» cÃ³ sáºµn dÆ°á»›i dáº¡ng Hugging Face Spaces, cho phÃ©p báº¡n tÆ°Æ¡ng tÃ¡c thá»i gian thá»±c. Báº¡n cÃ³ thá»ƒ khÃ¡m phÃ¡ cÃ¡c Agent khÃ¡c [táº¡i Ä‘Ã¢y](https://huggingface.co/spaces/davidberenstein1957/smolagents-and-tools).

VÃ­ dá»¥, _AlfredAgent_ cÃ³ sáºµn [táº¡i Ä‘Ã¢y](https://huggingface.co/spaces/sergiopaniego/AlfredAgent). Báº¡n cÃ³ thá»ƒ dÃ¹ng thá»­ trá»±c tiáº¿p bÃªn dÆ°á»›i:

<iframe
	src="https://sergiopaniego-alfredagent.hf.space/"
	frameborder="0"
	width="850"
	height="450"
></iframe>

Báº¡n cÃ³ thá»ƒ tháº¯c máº¯c - lÃ m tháº¿ nÃ o Alfred xÃ¢y dá»±ng Ä‘Æ°á»£c Agent nhÆ° váº­y báº±ng `smolagents`? Báº±ng cÃ¡ch tÃ­ch há»£p nhiá»u cÃ´ng cá»¥, anh áº¥y cÃ³ thá»ƒ táº¡o ra Agent nhÆ° sau. Äá»«ng lo vá» cÃ¡c cÃ´ng cá»¥ hiá»‡n táº¡i, vÃ¬ chÃºng ta sáº½ cÃ³ pháº§n riÃªng trong chÆ°Æ¡ng nÃ y Ä‘á»ƒ tÃ¬m hiá»ƒu chi tiáº¿t:

```python
from smolagents import CodeAgent, DuckDuckGoSearchTool, FinalAnswerTool, HfApiModel, Tool, tool, VisitWebpageTool

@tool
def suggest_menu(occasion: str) -> str:
    """
    Äá» xuáº¥t thá»±c Ä‘Æ¡n dá»±a trÃªn dá»‹p.
    Args:
        occasion: Loáº¡i dá»‹p cho bá»¯a tiá»‡c.
    """
    if occasion == "casual":
        return "Pizza, Ä‘á»“ Äƒn nháº¹ vÃ  Ä‘á»“ uá»‘ng."
    elif occasion == "formal":
        return "Bá»¯a tá»‘i 3 mÃ³n vá»›i rÆ°á»£u vÃ  trÃ¡ng miá»‡ng."
    elif occasion == "superhero":
        return "Tiá»‡c tá»± chá»n vá»›i Ä‘á»“ Äƒn giÃ u nÄƒng lÆ°á»£ng vÃ  lÃ nh máº¡nh."
    else:
        return "Thá»±c Ä‘Æ¡n tÃ¹y chá»‰nh cho quáº£n gia."

@tool
def catering_service_tool(query: str) -> str:
    """
    CÃ´ng cá»¥ tráº£ vá» dá»‹ch vá»¥ catering Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡ cao nháº¥t táº¡i Gotham City.
    
    Args:
        query: Tá»« khÃ³a tÃ¬m kiáº¿m dá»‹ch vá»¥ catering.
    """
    # Danh sÃ¡ch dá»‹ch vá»¥ catering vÃ  Ä‘Ã¡nh giÃ¡
    services = {
        "Gotham Catering Co.": 4.9,
        "Wayne Manor Catering": 4.8,
        "Gotham City Events": 4.7,
    }
    
    # TÃ¬m dá»‹ch vá»¥ cÃ³ Ä‘Ã¡nh giÃ¡ cao nháº¥t (mÃ´ phá»ng tÃ¬m kiáº¿m)
    best_service = max(services, key=services.get)
    
    return best_service

class SuperheroPartyThemeTool(Tool):
    name = "superhero_party_theme_generator"
    description = """
    CÃ´ng cá»¥ Ä‘á» xuáº¥t Ã½ tÆ°á»Ÿng tiá»‡c theo chá»§ Ä‘á» siÃªu anh hÃ¹ng sÃ¡ng táº¡o dá»±a trÃªn thá»ƒ loáº¡i.
    Tráº£ vá» Ã½ tÆ°á»Ÿng chá»§ Ä‘á» tiá»‡c Ä‘á»™c Ä‘Ã¡o."""
    
    inputs = {
        "category": {
            "type": "string",
            "description": "Thá»ƒ loáº¡i tiá»‡c siÃªu anh hÃ¹ng (vd: 'classic heroes', 'villain masquerade', 'futuristic Gotham').",
        }
    }
    
    output_type = "string"

    def forward(self, category: str):
        themes = {
            "classic heroes": "Tiá»‡c Justice League: KhÃ¡ch máº·c trang phá»¥c siÃªu anh hÃ¹ng DC yÃªu thÃ­ch vá»›i cocktail chá»§ Ä‘á» nhÆ° 'The Kryptonite Punch'.",
            "villain masquerade": "Dáº¡ há»™i Gotham Rogues: Lá»… há»™i hÃ³a trang bÃ­ áº©n nÆ¡i khÃ¡ch máº·c trang nhÆ° pháº£n diá»‡n Batman.",
            "futuristic Gotham": "ÄÃªm Neo-Gotham: Tiá»‡c phong cÃ¡ch cyberpunk láº¥y cáº£m há»©ng tá»« Batman Beyond, vá»›i trang trÃ­ neon vÃ  gadget tÆ°Æ¡ng lai."
        }
        
        return themes.get(category.lower(), "KhÃ´ng tÃ¬m tháº¥y Ã½ tÆ°á»Ÿng chá»§ Ä‘á». Thá»­ 'classic heroes', 'villain masquerade' hoáº·c 'futuristic Gotham'.")


# Alfred, quáº£n gia, chuáº©n bá»‹ thá»±c Ä‘Æ¡n cho bá»¯a tiá»‡c
agent = CodeAgent(
    tools=[
        DuckDuckGoSearchTool(), 
        VisitWebpageTool(),
        suggest_menu,
        catering_service_tool,
        SuperheroPartyThemeTool()
    ], 
    model=HfApiModel(),
    max_steps=10,
    verbosity_level=2
)

agent.run("Give me the best playlist for a party at the Wayne's mansion. The party idea is a 'villain masquerade' theme")
```

NhÆ° báº¡n tháº¥y, chÃºng ta Ä‘Ã£ táº¡o `CodeAgent` vá»›i nhiá»u cÃ´ng cá»¥ má»Ÿ rá»™ng chá»©c nÄƒng, biáº¿n nÃ³ thÃ nh cÃ´ng cá»¥ lÃªn káº¿ hoáº¡ch tiá»‡c hoÃ n háº£o sáºµn sÃ ng chia sáº» vá»›i cá»™ng Ä‘á»“ng! ğŸ‰

Giá» Ä‘áº¿n lÆ°á»£t báº¡n: hÃ£y xÃ¢y dá»±ng Agent cá»§a riÃªng mÃ¬nh vÃ  chia sáº» vá»›i cá»™ng Ä‘á»“ng báº±ng kiáº¿n thá»©c vá»«a há»c! ğŸ•µï¸â€â™‚ï¸ğŸ’¡

<Tip>
Náº¿u muá»‘n chia sáº» dá»± Ã¡n Agent, hÃ£y táº¡o má»™t Space vÃ  tag <a href="https://huggingface.co/agents-course">agents-course</a> trÃªn Hugging Face Hub. ChÃºng mÃ¬nh ráº¥t muá»‘n xem nhá»¯ng gÃ¬ báº¡n táº¡o ra!
</Tip>

### Kiá»ƒm tra Agent chuáº©n bá»‹ tiá»‡c vá»›i OpenTelemetry vÃ  Langfuse ğŸ“¡

Khi Alfred tinh chá»‰nh Agent chuáº©n bá»‹ tiá»‡c, anh áº¥y cáº£m tháº¥y má»‡t má»i vá»›i viá»‡c gá»¡ lá»—i cÃ¡c láº§n cháº¡y. Vá»‘n dÄ© Agent khÃ³ Ä‘oÃ¡n vÃ  khÃ³ kiá»ƒm tra. NhÆ°ng vÃ¬ muá»‘n xÃ¢y dá»±ng Agent chuáº©n bá»‹ tiá»‡c tá»‘i Æ°u vÃ  triá»ƒn khai production, anh áº¥y cáº§n kháº£ nÄƒng theo dÃµi quÃ¡ trÃ¬nh cháº¡y Ä‘á»ƒ giÃ¡m sÃ¡t vÃ  phÃ¢n tÃ­ch sau nÃ y.

Má»™t láº§n ná»¯a, `smolagents` giáº£i cá»©u! NÃ³ Ã¡p dá»¥ng chuáº©n [OpenTelemetry](https://opentelemetry.io/) Ä‘á»ƒ theo dÃµi cÃ¡c láº§n cháº¡y Agent, cho phÃ©p ghi log vÃ  kiá»ƒm tra liá»n máº¡ch. Vá»›i sá»± trá»£ giÃºp cá»§a [Langfuse](https://langfuse.com/) vÃ  `SmolagentsInstrumentor`, Alfred cÃ³ thá»ƒ dá»… dÃ ng theo dÃµi vÃ  phÃ¢n tÃ­ch hÃ nh vi Agent.

CÃ i Ä‘áº·t ráº¥t Ä‘Æ¡n giáº£n!  

Äáº§u tiÃªn, cáº§n cÃ i cÃ¡c dependency cáº§n thiáº¿t:  

```bash
pip install opentelemetry-sdk opentelemetry-exporter-otlp openinference-instrumentation-smolagents
```

Tiáº¿p theo, Alfred Ä‘Ã£ táº¡o tÃ i khoáº£n Langfuse vÃ  cÃ³ sáºµn API key. Náº¿u chÆ°a cÃ³, báº¡n cÃ³ thá»ƒ Ä‘Äƒng kÃ½ Langfuse Cloud [táº¡i Ä‘Ã¢y](https://cloud.langfuse.com/) hoáº·c xem [lá»±a chá»n khÃ¡c](https://huggingface.co/docs/smolagents/tutorials/inspect_runs).  

Sau khi cÃ³ API key, cáº¥u hÃ¬nh chÃºng nhÆ° sau:

```python
import os
import base64

LANGFUSE_PUBLIC_KEY="pk-lf-..."
LANGFUSE_SECRET_KEY="sk-lf-..."
LANGFUSE_AUTH=base64.b64encode(f"{LANGFUSE_PUBLIC_KEY}:{LANGFUSE_SECRET_KEY}".encode()).decode()

os.environ["OTEL_EXPORTER_OTLP_ENDPOINT"] = "https://cloud.langfuse.com/api/public/otel" # Khu vá»±c dá»¯ liá»‡u EU
# os.environ["OTEL_EXPORTER_OTLP_ENDPOINT"] = "https://us.cloud.langfuse.com/api/public/otel" # Khu vá»±c dá»¯ liá»‡u US
os.environ["OTEL_EXPORTER_OTLP_HEADERS"] = f"Authorization=Basic {LANGFUSE_AUTH}"
```

Cuá»‘i cÃ¹ng, Alfred sáºµn sÃ ng khá»Ÿi táº¡o `SmolagentsInstrumentor` vÃ  báº¯t Ä‘áº§u theo dÃµi hiá»‡u suáº¥t Agent.  

```python
from opentelemetry.sdk.trace import TracerProvider

from openinference.instrumentation.smolagents import SmolagentsInstrumentor
from opentelemetry.exporter.otlp.proto.http.trace_exporter import OTLPSpanExporter
from opentelemetry.sdk.trace.export import SimpleSpanProcessor

trace_provider = TracerProvider()
trace_provider.add_span_processor(SimpleSpanProcessor(OTLPSpanExporter()))

SmolagentsInstrumentor().instrument(tracer_provider=trace_provider)
```

Alfred Ä‘Ã£ káº¿t ná»‘i thÃ nh cÃ´ng ğŸ”Œ! CÃ¡c láº§n cháº¡y tá»« `smolagents` Ä‘Æ°á»£c ghi log vÃ o Langfuse, cho anh áº¥y cÃ¡i nhÃ¬n toÃ n diá»‡n vá» hÃ nh vi Agent. Vá»›i setup nÃ y, anh áº¥y cÃ³ thá»ƒ xem láº¡i cÃ¡c láº§n cháº¡y trÆ°á»›c vÃ  cáº£i thiá»‡n Agent chuáº©n bá»‹ tiá»‡c.  

```python
from smolagents import CodeAgent, HfApiModel

agent = CodeAgent(tools=[], model=HfApiModel())
alfred_agent = agent.from_hub('sergiopaniego/AlfredAgent', trust_remote_code=True)
alfred_agent.run("Give me the best playlist for a party at Wayne's mansion. The party idea is a 'villain masquerade' theme")  
```

Alfred cÃ³ thá»ƒ truy cáº­p cÃ¡c log nÃ y [táº¡i Ä‘Ã¢y](https://cloud.langfuse.com/project/cm7bq0abj025rad078ak3luwi/traces/995fc019255528e4f48cf6770b0ce27b?timestamp=2025-02-19T10%3A28%3A36.929Z) Ä‘á»ƒ xem xÃ©t vÃ  phÃ¢n tÃ­ch.  

<Tip>
Thá»±c táº¿ Ä‘Ã£ xáº£y ra lá»—i nhá» trong quÃ¡ trÃ¬nh thá»±c thi. Báº¡n cÃ³ thá»ƒ phÃ¡t hiá»‡n ra nÃ³ trong log khÃ´ng? Thá»­ theo dÃµi cÃ¡ch Agent xá»­ lÃ½ vÃ  váº«n tráº£ vá» káº¿t quáº£ há»£p lá»‡. <a href="https://cloud.langfuse.com/project/cm7bq0abj025rad078ak3luwi/traces/995fc019255528e4f48cf6770b0ce27b?timestamp=2025-02-19T10%3A28%3A36.929Z&observation=80ca57ace4f69b52">ÄÃ¢y</a> lÃ  link trá»±c tiáº¿p Ä‘áº¿n lá»—i náº¿u báº¡n muá»‘n kiá»ƒm tra. DÄ© nhiÃªn lá»—i Ä‘Ã£ Ä‘Æ°á»£c sá»­a, chi tiáº¿t xem trong <a href="https://cloud.langfuse.com/project/cm7bq0abj025rad078ak3luwi/traces/995fc019255528e4f48cf6770b0ce27b?timestamp=2025-02-19T10%3A28%3A36.929Z&observation=80ca57ace4f69b52">issue</a> nÃ y.
</Tip>

Trong khi Ä‘Ã³, [playlist Ä‘Æ°á»£c Ä‘á» xuáº¥t](https://open.spotify.com/playlist/0gZMMHjuxMrrybQ7wTMTpw) táº¡o khÃ´ng khÃ­ hoÃ n háº£o cho viá»‡c chuáº©n bá»‹ tiá»‡c. Tháº­t tuyá»‡t pháº£i khÃ´ng? ğŸ¶  

---

Giá» Ä‘Ã£ táº¡o xong Code Agent Ä‘áº§u tiÃªn, hÃ£y **há»c cÃ¡ch táº¡o Tool Calling Agent** - loáº¡i Agent thá»© hai cÃ³ sáºµn trong `smolagents`.

## TÃ i nguyÃªn

- [Blog smolagents](https://huggingface.co/blog/smolagents) - Giá»›i thiá»‡u vá» smolagents vÃ  tÆ°Æ¡ng tÃ¡c code
- [smolagents: XÃ¢y dá»±ng Agent tá»‘t](https://huggingface.co/docs/smolagents/tutorials/building_good_agents) - Best practices cho Agent Ä‘Ã¡ng tin cáº­y
- [XÃ¢y dá»±ng Agent hiá»‡u quáº£ - Anthropic](https://www.anthropic.com/research/building-effective-agents) - NguyÃªn táº¯c thiáº¿t káº¿ Agent
- [Chia sáº» láº§n cháº¡y vá»›i OpenTelemetry](https://huggingface.co/docs/smolagents/tutorials/inspect_runs) - Chi tiáº¿t cÃ¡ch cÃ i OpenTelemetry Ä‘á»ƒ theo dÃµi Agent.