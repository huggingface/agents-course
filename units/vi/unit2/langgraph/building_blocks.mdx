# C√°c th√†nh ph·∫ßn c∆° b·∫£n c·ªßa LangGraph

ƒê·ªÉ x√¢y d·ª±ng ·ª©ng d·ª•ng v·ªõi LangGraph, ta c·∫ßn hi·ªÉu c√°c th√†nh ph·∫ßn c∆° b·∫£n c·ªßa n√≥. H√£y c√πng kh√°m ph√° nh·ªØng y·∫øu t·ªë n·ªÅn t·∫£ng t·∫°o n√™n m·ªôt ·ª©ng d·ª•ng LangGraph.

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit2/LangGraph/Building_blocks.png" alt="Building Blocks" width="70%"/>

M·ªôt ·ª©ng d·ª•ng trong LangGraph b·∫Øt ƒë·∫ßu t·ª´ **entrypoint** (ƒëi·ªÉm v√†o), v√† t√πy v√†o qu√° tr√¨nh th·ª±c thi, lu·ªìng c√≥ th·ªÉ ƒëi ƒë·∫øn function n√†y ho·∫∑c function kh√°c cho ƒë·∫øn khi ƒë·∫°t ƒë·∫øn END.

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit2/LangGraph/application.png" alt="Application"/>

## 1. State (Tr·∫°ng th√°i)

**State** l√† kh√°i ni·ªám trung t√¢m trong LangGraph, ƒë·∫°i di·ªán cho m·ªçi th√¥ng tin lu√¢n chuy·ªÉn qua ·ª©ng d·ª•ng c·ªßa b·∫°n.

```python
from typing_extensions import TypedDict

class State(TypedDict):
    graph_state: str
```

State ƒë∆∞·ª£c **User defined** (ƒë·ªãnh nghƒ©a b·ªüi ng∆∞·ªùi d√πng), do ƒë√≥ c√°c tr∆∞·ªùng d·ªØ li·ªáu c·∫ßn ƒë∆∞·ª£c thi·∫øt k·∫ø c·∫©n th·∫≠n ƒë·ªÉ ch·ª©a m·ªçi th√¥ng tin c·∫ßn thi·∫øt cho qu√° tr√¨nh ra quy·∫øt ƒë·ªãnh!

> üí° **M·∫πo:** H√£y c√¢n nh·∫Øc k·ªπ v·ªÅ nh·ªØng th√¥ng tin ·ª©ng d·ª•ng c·∫ßn theo d√µi gi·ªØa c√°c b∆∞·ªõc.

## 2. Nodes (N√∫t)

**Nodes** l√† c√°c function Python. M·ªói node:
- Nh·∫≠n state l√†m ƒë·∫ßu v√†o
- Th·ª±c hi·ªán c√°c thao t√°c
- Tr·∫£ v·ªÅ c√°c c·∫≠p nh·∫≠t cho state

```python
def node_1(state):
    print("---Node 1---")
    return {"graph_state": state['graph_state'] +" I am"}

def node_2(state):
    print("---Node 2---")
    return {"graph_state": state['graph_state'] +" happy!"}

def node_3(state):
    print("---Node 3---")
    return {"graph_state": state['graph_state'] +" sad!"}
```

V√≠ d·ª•, c√°c Node c√≥ th·ªÉ ch·ª©a:
- **LLM calls**: T·∫°o vƒÉn b·∫£n ho·∫∑c ƒë∆∞a ra quy·∫øt ƒë·ªãnh
- **Tool calls**: T∆∞∆°ng t√°c v·ªõi h·ªá th·ªëng b√™n ngo√†i
- **Conditional logic**: X√°c ƒë·ªãnh c√°c b∆∞·ªõc ti·∫øp theo
- **Human intervention**: Nh·∫≠n input t·ª´ ng∆∞·ªùi d√πng

> üí° **Th√¥ng tin:** M·ªôt s·ªë node c·∫ßn thi·∫øt cho to√†n b·ªô workflow nh∆∞ START v√† END ƒë√£ c√≥ s·∫µn trong LangGraph.

## 3. Edges (C·∫°nh)

**Edges** k·∫øt n·ªëi c√°c node v√† x√°c ƒë·ªãnh c√°c ƒë∆∞·ªùng ƒëi c√≥ th·ªÉ trong ƒë·ªì th·ªã:

```python
import random
from typing import Literal

def decide_mood(state) -> Literal["node_2", "node_3"]:
    
    # Th√¥ng th∆∞·ªùng, ta s·∫Ω s·ª≠ d·ª•ng state ƒë·ªÉ quy·∫øt ƒë·ªãnh node ti·∫øp theo
    user_input = state['graph_state'] 
    
    # ·ªû ƒë√¢y, ta chia t·ª∑ l·ªá 50/50 gi·ªØa node 2 v√† 3
    if random.random() < 0.5:

        # 50% tr∆∞·ªùng h·ª£p tr·∫£ v·ªÅ Node 2
        return "node_2"
    
    # 50% tr∆∞·ªùng h·ª£p tr·∫£ v·ªÅ Node 3
    return "node_3"
```

Edges c√≥ th·ªÉ l√†:
- **Direct**: Lu√¥n ƒëi t·ª´ node A ƒë·∫øn node B
- **Conditional**: Ch·ªçn node ti·∫øp theo d·ª±a tr√™n state hi·ªán t·∫°i

## 4. StateGraph (ƒê·ªì th·ªã tr·∫°ng th√°i)

**StateGraph** l√† container ch·ª©a to√†n b·ªô workflow c·ªßa Agent:

```python
from IPython.display import Image, display
from langgraph.graph import StateGraph, START, END

# X√¢y d·ª±ng ƒë·ªì th·ªã
builder = StateGraph(State)
builder.add_node("node_1", node_1)
builder.add_node("node_2", node_2)
builder.add_node("node_3", node_3)

# Logic
builder.add_edge(START, "node_1")
builder.add_conditional_edges("node_1", decide_mood)
builder.add_edge("node_2", END)
builder.add_edge("node_3", END)

# T·ªïng h·ª£p
graph = builder.compile()
```

C√≥ th·ªÉ visualize ƒë·ªì th·ªã n√†y!
```python
# Hi·ªÉn th·ªã
display(Image(graph.get_graph().draw_mermaid_png()))
```
<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit2/LangGraph/basic_graph.jpeg" alt="Graph Visualization"/>

Nh∆∞ng quan tr·ªçng nh·∫•t l√† c√°ch invoke:
```python
graph.invoke({"graph_state" : "Hi, this is Lance."})
```
output :
```
---Node 1---
---Node 3---
{'graph_state': 'Hi, this is Lance. I am sad!'}
```

## B∆∞·ªõc ti·∫øp theo l√† g√¨?

Trong ph·∫ßn ti·∫øp theo, ch√∫ng ta s·∫Ω √°p d·ª•ng c√°c kh√°i ni·ªám n√†y v√†o th·ª±c t·∫ø b·∫±ng c√°ch x√¢y d·ª±ng ƒë·ªì th·ªã ƒë·∫ßu ti√™n. ƒê·ªì th·ªã n√†y cho ph√©p Alfred ti·∫øp nh·∫≠n email, ph√¢n lo·∫°i ch√∫ng v√† so·∫°n c√¢u tr·∫£ l·ªùi s∆° b·ªô n·∫øu ch√∫ng l√† email th·∫≠t.