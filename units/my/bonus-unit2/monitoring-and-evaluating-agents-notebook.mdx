## á€¡á€•á€­á€¯ á€¡á€á€”á€ºá€¸ á‚: Agent á€™á€»á€¬á€¸á á€…á€±á€¬á€„á€·á€ºá€€á€¼á€Šá€·á€ºá€”á€­á€¯á€„á€ºá€…á€½á€™á€ºá€¸á€”á€¾á€„á€·á€º á€¡á€€á€²á€–á€¼á€á€ºá€á€¼á€„á€ºá€¸ (Observability and Evaluation of Agents)

<CourseFloatingBanner chapter={2}
  classNames="absolute z-10 right-0 top-0"
  notebooks={[
    {label: "Google Colab", value: "https://colab.research.google.com/#fileId=https%3A//huggingface.co/agents-course/notebooks/blob/main/bonus-unit2/monitoring-and-evaluating-agents.ipynb"},
]} />

> [!TIP]
> á€’á€®á€¡á€á€”á€ºá€¸á€™á€¾á€¬á€•á€«á€á€²á€· Code á€á€½á€±á€€á€­á€¯ Google Colab á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€•á€¼á€®á€¸ [á€’á€® Notebook](https://colab.research.google.com/#fileId=https%3A//huggingface.co/agents-course/notebooks/blob/main/bonus-unit2/monitoring-and-evaluating-agents.ipynb) á€™á€¾á€¬ á€œá€­á€¯á€€á€ºá€œá€¶á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

á€’á€® Notebook á€™á€¾á€¬á€á€±á€¬á€· á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€·á€›á€²á€· AI Agent á€›á€²á€· **á€¡á€á€½á€„á€ºá€¸á€•á€­á€¯á€„á€ºá€¸ á€¡á€†á€„á€·á€ºá€†á€„á€·á€º á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€™á€¾á€¯á€™á€»á€¬á€¸ (Traces) á€€á€­á€¯ á€˜á€šá€ºá€œá€­á€¯ á€…á€±á€¬á€„á€·á€ºá€€á€¼á€Šá€·á€ºá€™á€œá€²** á€†á€­á€¯á€á€¬á€”á€²á€· Open-source á€…á€±á€¬á€„á€·á€ºá€€á€¼á€Šá€·á€ºá€›á€±á€¸ Tool á€á€½á€±á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€•á€¼á€®á€¸ **áá€„á€ºá€¸á€›á€²á€· á€…á€½á€™á€ºá€¸á€†á€±á€¬á€„á€ºá€›á€Šá€ºá€€á€­á€¯ á€˜á€šá€ºá€œá€­á€¯ á€¡á€€á€²á€–á€¼á€á€ºá€™á€œá€²** á€†á€­á€¯á€á€¬á€€á€­á€¯ á€œá€±á€·á€œá€¬á€á€½á€¬á€¸á€•á€«á€™á€šá€ºá‹

Agent á€á€…á€ºá€á€¯á€›á€²á€· á€¡á€•á€¼á€¯á€¡á€™á€°á€€á€­á€¯ á€…á€±á€¬á€„á€·á€ºá€€á€¼á€Šá€·á€ºá€”á€­á€¯á€„á€ºá€á€¼á€„á€ºá€¸á€”á€²á€· á€¡á€€á€²á€–á€¼á€á€ºá€”á€­á€¯á€„á€ºá€á€¼á€„á€ºá€¸á€Ÿá€¬ á€¡á€±á€¬á€€á€ºá€•á€«á€¡á€á€»á€€á€ºá€™á€»á€¬á€¸á€¡á€á€½á€€á€º á€™á€›á€¾á€­á€™á€–á€¼á€…á€º á€œá€­á€¯á€¡á€•á€ºá€•á€«á€á€šá€ºá‹

*   Tasks á€™á€»á€¬á€¸ á€™á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€á€²á€·á€¡á€á€« á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€¡á€€á€±á€¬á€„á€ºá€¸á€†á€¯á€¶á€¸á€™á€Ÿá€¯á€á€ºá€á€²á€· á€›á€œá€’á€ºá€á€½á€± á€‘á€½á€€á€ºá€œá€¬á€á€²á€·á€¡á€á€« **á€•á€¼á€¿á€”á€¬á€›á€¾á€¬á€–á€½á€±á€á€¼á€„á€ºá€¸ (Debugging)** á€¡á€á€½á€€á€ºá‹
*   á€€á€¯á€”á€ºá€€á€»á€…á€›á€­á€á€º (Costs) á€”á€²á€· á€…á€½á€™á€ºá€¸á€†á€±á€¬á€„á€ºá€›á€Šá€º (Performance) á€€á€­á€¯ Real-time á€™á€¾á€¬ á€…á€±á€¬á€„á€·á€ºá€€á€¼á€Šá€·á€ºá€á€¼á€„á€ºá€¸á‹
*   á€…á€‰á€ºá€†á€€á€ºá€™á€•á€¼á€á€º á€á€¯á€¶á€·á€•á€¼á€”á€ºá€á€»á€€á€ºá€™á€»á€¬á€¸ (Feedback) á€™á€¾á€á€…á€ºá€†á€„á€·á€º á€šá€¯á€¶á€€á€¼á€Šá€ºá€…á€­á€á€ºá€á€»á€›á€™á€¾á€¯ (Reliability) á€”á€²á€· á€œá€¯á€¶á€á€¼á€¯á€¶á€›á€±á€¸á€€á€­á€¯ á€™á€¼á€¾á€„á€·á€ºá€á€„á€ºá€á€¼á€„á€ºá€¸á‹

## á€¡á€†á€„á€·á€º á€: á€œá€­á€¯á€¡á€•á€ºá€á€±á€¬ Library á€™á€»á€¬á€¸á€€á€­á€¯ Install á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸ ğŸ—ï¸

Agent á€™á€»á€¬á€¸á€€á€­á€¯ Run á€›á€”á€ºáŠ á€…á€±á€¬á€„á€·á€ºá€€á€¼á€Šá€·á€ºá€›á€”á€ºá€”á€¾á€„á€·á€º á€¡á€€á€²á€–á€¼á€á€ºá€›á€”á€ºá€¡á€á€½á€€á€º á€¡á€±á€¬á€€á€ºá€•á€« Library á€¡á€á€»á€­á€¯á€· á€œá€­á€¯á€¡á€•á€ºá€•á€«á€á€šá€ºá‹

```python
%pip install langfuse 'smolagents[telemetry]' openinference-instrumentation-smolagents datasets 'smolagents[gradio]' gradio --upgrade
```

## á€¡á€†á€„á€·á€º á: á€á€„á€ºá Agent á€€á€­á€¯ á€…á€”á€…á€ºá€á€€á€» á€á€•á€ºá€†á€„á€ºá€á€¼á€„á€ºá€¸ (Instrument Your Agent)

á€’á€® Notebook á€™á€¾á€¬ á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€· [Langfuse](https://langfuse.com/) á€€á€­á€¯ á€…á€±á€¬á€„á€·á€ºá€€á€¼á€Šá€·á€ºá€›á€±á€¸ Tool á€¡á€–á€¼á€…á€º á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€½á€¬á€¸á€™á€¾á€¬ á€–á€¼á€…á€ºá€•á€±á€™á€šá€·á€ºáŠ **á€¡á€á€¼á€¬á€¸ OpenTelemetry-compatible Service** á€™á€»á€¬á€¸á€€á€­á€¯á€œá€Šá€ºá€¸ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹ á€¡á€±á€¬á€€á€ºá€•á€« Code á€€ Langfuse (á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€™á€Šá€ºá€á€Šá€·á€º OTel Endpoint á€™á€†á€­á€¯) á€¡á€á€½á€€á€º Environment Variable á€™á€»á€¬á€¸á€€á€­á€¯ á€á€á€ºá€™á€¾á€á€ºá€•á€¯á€¶á€”á€¾á€„á€·á€º á€á€„á€ºá `smolagent` á€€á€­á€¯ á€…á€”á€…á€ºá€á€€á€» á€á€•á€ºá€†á€„á€ºá€•á€¯á€¶á€€á€­á€¯ á€•á€¼á€á€‘á€¬á€¸á€•á€«á€á€šá€ºá‹

**á€™á€¾á€á€ºá€á€»á€€á€º:** á€á€„á€ºá€á€Šá€º LlamaIndex á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º LangGraph á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€”á€±á€•á€«á€€áŠ áá€„á€ºá€¸á€á€­á€¯á€·á€€á€­á€¯ á€…á€”á€…á€ºá€á€€á€» á€á€•á€ºá€†á€„á€ºá€›á€”á€ºá€¡á€á€½á€€á€º [á€’á€®á€”á€±á€›á€¬](https://langfuse.com/docs/integrations/llama-index/workflows) á€”á€¾á€„á€·á€º [á€’á€®á€”á€±á€›á€¬](https://langfuse.com/docs/integrations/langchain/example-python-langgraph) á€á€½á€„á€º Document á€™á€»á€¬á€¸á€€á€­á€¯ á€›á€¾á€¬á€–á€½á€±á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

á€•á€‘á€™á€†á€¯á€¶á€¸á€¡á€”á€±á€”á€²á€· Langfuse á€›á€²á€· Credentials á€™á€»á€¬á€¸á€€á€­á€¯ Environment Variable á€™á€»á€¬á€¸á€¡á€–á€¼á€…á€º á€á€á€ºá€™á€¾á€á€ºá€€á€¼á€•á€«á€…á€­á€¯á€·á‹ [Langfuse Cloud](https://cloud.langfuse.com) á€á€½á€„á€º Sign Up á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º [Langfuse á€€á€­á€¯ á€€á€­á€¯á€šá€ºá€á€­á€¯á€„á€º Host á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸](https://langfuse.com/self-hosting) á€–á€¼á€„á€·á€º á€á€„á€ºá Langfuse API Key á€™á€»á€¬á€¸á€€á€­á€¯ á€›á€šá€°á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

```python
import os
# Get keys for your project from the project settings page: https://cloud.langfuse.com
os.environ["LANGFUSE_PUBLIC_KEY"] = "pk-lf-..." 
os.environ["LANGFUSE_SECRET_KEY"] = "sk-lf-..." 
os.environ["LANGFUSE_HOST"] = "https://cloud.langfuse.com" # ğŸ‡ªğŸ‡º EU region
# os.environ["LANGFUSE_HOST"] = "https://us.cloud.langfuse.com" # ğŸ‡ºğŸ‡¸ US region
```
Inference Calls á€™á€»á€¬á€¸á€¡á€á€½á€€á€º á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€·á€›á€²á€· Hugging Face Token á€€á€­á€¯á€œá€Šá€ºá€¸ Configure á€œá€¯á€•á€ºá€–á€­á€¯á€· á€œá€­á€¯á€•á€«á€á€šá€ºá‹

```python
# Set your Hugging Face and other tokens/secrets as environment variable
os.environ["HF_TOKEN"] = "hf_..." 
```

Environment Variable á€™á€»á€¬á€¸á€€á€­á€¯ á€á€á€ºá€™á€¾á€á€ºá€•á€¼á€®á€¸á€”á€±á€¬á€€á€ºáŠ Langfuse Client á€€á€­á€¯ á€…á€á€„á€ºá€”á€­á€¯á€„á€ºá€•á€«á€•á€¼á€®á‹ `get_client()` á€á€Šá€º Environment Variable á€™á€»á€¬á€¸á€á€½á€„á€º á€•á€±á€¸á€‘á€¬á€¸á€á€±á€¬ Credentials á€™á€»á€¬á€¸á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á Langfuse Client á€€á€­á€¯ á€…á€á€„á€ºá€•á€±á€¸á€•á€«á€á€šá€ºá‹

```python
from langfuse import get_client
 
langfuse = get_client()
 
# Connection á€€á€­á€¯ á€…á€…á€ºá€†á€±á€¸á€á€¼á€„á€ºá€¸
if langfuse.auth_check():
    print("Langfuse client á€á€Šá€º á€¡á€á€Šá€ºá€•á€¼á€¯á€•á€¼á€®á€¸ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€›á€”á€º á€¡á€á€„á€·á€ºá€–á€¼á€…á€ºá€•á€«á€•á€¼á€®!")
else:
    print("á€¡á€á€Šá€ºá€•á€¼á€¯á€á€¼á€„á€ºá€¸ á€™á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á‹ á€á€„á€ºá Credentials á€”á€¾á€„á€·á€º Host á€€á€­á€¯ á€…á€…á€ºá€†á€±á€¸á€•á€«á‹")
```

á€‘á€­á€¯á€·á€”á€±á€¬á€€á€ºáŠ á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€·á€›á€²á€· `smolagent` á€€á€­á€¯ á€…á€”á€…á€ºá€á€€á€» á€á€•á€ºá€†á€„á€ºá€•á€¼á€®á€¸ Traces á€™á€»á€¬á€¸á€€á€­á€¯ Langfuse á€á€­á€¯á€· á€•á€±á€¸á€•á€­á€¯á€·á€›á€”á€ºá€¡á€á€½á€€á€º `SmolagentsInstrumentor()` á€€á€­á€¯ á€á€á€ºá€™á€¾á€á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

```python
from openinference.instrumentation.smolagents import SmolagentsInstrumentor
 
SmolagentsInstrumentor().instrument()
```

## á€¡á€†á€„á€·á€º á‚: á€á€„á€ºá á€á€•á€ºá€†á€„á€ºá€™á€¾á€¯á€€á€­á€¯ á€…á€™á€ºá€¸á€á€•á€ºá€á€¼á€„á€ºá€¸ (Test Your Instrumentation)

á€’á€®á€”á€±á€›á€¬á€™á€¾á€¬ `smolagents` á€™á€¾ á€›á€­á€¯á€¸á€›á€¾á€„á€ºá€¸á€á€²á€· `1+1` á€€á€­á€¯ á€á€½á€€á€ºá€á€»á€€á€ºá€•á€±á€¸á€™á€šá€·á€º `CodeAgent` á€á€…á€ºá€á€¯á€€á€­á€¯ á€–á€”á€ºá€á€®á€¸á€‘á€¬á€¸á€•á€«á€á€šá€ºá‹ á€á€•á€ºá€†á€„á€ºá€™á€¾á€¯ á€™á€¾á€”á€ºá€€á€”á€ºá€…á€½á€¬ á€¡á€œá€¯á€•á€ºá€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸á€›á€¾á€­á€™á€›á€¾á€­ á€…á€…á€ºá€†á€±á€¸á€›á€”á€º áá€„á€ºá€¸á€€á€­á€¯ Run á€€á€¼á€Šá€·á€ºá€•á€«á€™á€šá€ºá‹ á€¡á€›á€¬á€¡á€¬á€¸á€œá€¯á€¶á€¸ á€™á€¾á€”á€ºá€€á€”á€ºá€…á€½á€¬ á€á€á€ºá€™á€¾á€á€ºá€‘á€¬á€¸á€•á€«á€€áŠ á€á€„á€ºá Observability Dashboard á€á€½á€„á€º Logs/Spans á€™á€»á€¬á€¸á€€á€­á€¯ á€™á€¼á€„á€ºá€á€½á€±á€·á€›á€•á€«á€™á€šá€ºá‹

```python
from smolagents import InferenceClientModel, CodeAgent

# á€á€•á€ºá€†á€„á€ºá€™á€¾á€¯á€€á€­á€¯ á€…á€™á€ºá€¸á€á€•á€ºá€›á€”á€º á€›á€­á€¯á€¸á€›á€¾á€„á€ºá€¸á€á€±á€¬ Agent á€á€…á€ºá€á€¯ á€–á€”á€ºá€á€®á€¸á€á€¼á€„á€ºá€¸
agent = CodeAgent(
    tools=[],
    model=InferenceClientModel()
)

agent.run("1+1=")
```

Spans á€”á€¾á€„á€·á€º Logs á€™á€»á€¬á€¸ á€™á€¾á€á€ºá€á€™á€ºá€¸á€á€„á€ºá€‘á€¬á€¸á€á€¼á€„á€ºá€¸ á€›á€¾á€­á€™á€›á€¾á€­ á€…á€…á€ºá€†á€±á€¸á€›á€”á€º á€á€„á€ºá [Langfuse Traces Dashboard](https://cloud.langfuse.com) (á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€á€„á€ºá€›á€½á€±á€¸á€á€»á€šá€ºá€‘á€¬á€¸á€á€±á€¬ Observability Tool) á€€á€­á€¯ á€…á€…á€ºá€†á€±á€¸á€•á€«á‹

Langfuse á€™á€¾ á€¥á€•á€™á€¬ Screenshot:

![Example trace in Langfuse](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/first-example-trace.png)

_[Trace á€á€­á€¯á€· á€œá€„á€·á€ºá€á€º](https://cloud.langfuse.com/project/cloramnkj0002jz088vzn1ja4/traces/1b94d6888258e0998329cdb72a371155?timestamp=2025-03-10T11%3A59%3A41.743Z)_

## á€¡á€†á€„á€·á€º áƒ: á€•á€­á€¯á€™á€­á€¯á€›á€¾á€¯á€•á€ºá€‘á€½á€±á€¸á€á€±á€¬ Agent á€€á€­á€¯ á€…á€±á€¬á€„á€·á€ºá€€á€¼á€Šá€·á€ºá€á€¼á€„á€ºá€¸á€”á€¾á€„á€·á€º á€¡á€€á€²á€–á€¼á€á€ºá€á€¼á€„á€ºá€¸

á€á€„á€ºá á€á€•á€ºá€†á€„á€ºá€™á€¾á€¯ á€¡á€œá€¯á€•á€ºá€œá€¯á€•á€ºá€€á€¼á€±á€¬á€„á€ºá€¸ á€¡á€á€Šá€ºá€•á€¼á€¯á€•á€¼á€®á€¸á€•á€¼á€®á€†á€­á€¯á€á€±á€¬á€·áŠ á€•á€­á€¯á€™á€­á€¯á€›á€¾á€¯á€•á€ºá€‘á€½á€±á€¸á€á€±á€¬ Query á€á€…á€ºá€á€¯á€€á€­á€¯ á€…á€™á€ºá€¸á€€á€¼á€Šá€·á€ºá€€á€¼á€•á€«á€…á€­á€¯á€·á‹ á€’á€«á€™á€¾ Advanced Metrics á€™á€»á€¬á€¸ (Token á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€™á€¾á€¯áŠ LatencyáŠ á€€á€¯á€”á€ºá€€á€»á€…á€›á€­á€á€º á€…á€á€Šá€º) á€€á€­á€¯ á€˜á€šá€ºá€œá€­á€¯ á€á€¼á€±á€›á€¬á€á€¶á€á€œá€²á€†á€­á€¯á€á€¬á€€á€­á€¯ á€™á€¼á€„á€ºá€á€½á€±á€·á€”á€­á€¯á€„á€ºá€•á€«á€™á€šá€ºá‹

```python
from smolagents import (CodeAgent, DuckDuckGoSearchTool, InferenceClientModel)

search_tool = DuckDuckGoSearchTool()
agent = CodeAgent(tools=[search_tool], model=InferenceClientModel())

agent.run("How many Rubik's Cubes could you fit inside the Notre Dame Cathedral?")
```

### Trace á€–á€½á€²á€·á€…á€Šá€ºá€¸á€•á€¯á€¶ (Trace Structure)

Observability Tool á€¡á€™á€»á€¬á€¸á€…á€¯á€á€Šá€º **Trace** á€á€…á€ºá€á€¯á€€á€­á€¯ á€™á€¾á€á€ºá€á€™á€ºá€¸á€á€„á€ºá€•á€«á€á€šá€ºá‹ áá€„á€ºá€¸ Trace á€‘á€²á€á€½á€„á€º á€á€„á€ºá Agent á€›á€²á€· Logic á€¡á€†á€„á€·á€ºá€á€…á€ºá€á€¯á€…á€®á€€á€­á€¯ á€€á€­á€¯á€šá€ºá€…á€¬á€¸á€•á€¼á€¯á€á€±á€¬ **Spans** á€™á€»á€¬á€¸ á€•á€«á€á€„á€ºá€•á€«á€á€šá€ºá‹ á€¤á€”á€±á€›á€¬á€á€½á€„á€º Trace á€á€Šá€º Agent á á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ Run á€€á€­á€¯ á€€á€­á€¯á€šá€ºá€…á€¬á€¸á€•á€¼á€¯á€•á€¼á€®á€¸áŠ á€¡á€±á€¬á€€á€ºá€•á€«á€á€­á€¯á€·á€¡á€á€½á€€á€º Sub-spans á€™á€»á€¬á€¸ á€•á€«á€á€„á€ºá€•á€«á€á€šá€ºá‹

*   Tool Calls á€™á€»á€¬á€¸ (DuckDuckGoSearchTool)
*   LLM Calls á€™á€»á€¬á€¸ (InferenceClientModel)

á€¤ Spans á€™á€»á€¬á€¸á€€á€­á€¯ á€…á€…á€ºá€†á€±á€¸á€á€¼á€„á€ºá€¸á€–á€¼á€„á€·á€º á€¡á€á€»á€­á€”á€ºá€™á€Šá€ºá€™á€»á€¾á€€á€¯á€”á€ºá€á€²á€·á€á€Šá€ºáŠ Token á€™á€Šá€ºá€™á€»á€¾ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€²á€·á€á€Šá€º á€…á€á€Šá€ºá€á€­á€¯á€·á€€á€­á€¯ á€á€­á€€á€»á€…á€½á€¬ á€™á€¼á€„á€ºá€á€½á€±á€·á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

![Trace tree in Langfuse](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/trace-tree.png)

_[Trace á€á€­á€¯á€· á€œá€„á€·á€ºá€á€º](https://cloud.langfuse.com/project/cloramnkj0002jz088vzn1ja4/traces/1ac33b89ffd5e75d4265b62900c348ed?timestamp=2025-03-07T13%3A45%3A09.149Z&display=preview)_

## Online á€¡á€€á€²á€–á€¼á€á€ºá€á€¼á€„á€ºá€¸ (Online Evaluation)

á€šá€á€„á€ºá€¡á€•á€­á€¯á€„á€ºá€¸á€™á€¾á€¬ Online á€”á€¾á€„á€·á€º Offline á€¡á€€á€²á€–á€¼á€á€ºá€á€¼á€„á€ºá€¸á€á€­á€¯á€·á€›á€²á€· á€€á€½á€¬á€á€¼á€¬á€¸á€á€»á€€á€ºá€€á€­á€¯ á€œá€±á€·á€œá€¬á€á€²á€·á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹ á€¡á€á€¯á€á€±á€¬á€· Production á€™á€¾á€¬ á€á€„á€ºá Agent á€€á€­á€¯ á€˜á€šá€ºá€œá€­á€¯ á€…á€±á€¬á€„á€·á€ºá€€á€¼á€Šá€·á€ºá€™á€œá€²áŠ Live á€™á€¾á€¬ á€˜á€šá€ºá€œá€­á€¯ á€¡á€€á€²á€–á€¼á€á€ºá€™á€œá€²á€†á€­á€¯á€á€¬á€€á€­á€¯ á€€á€¼á€Šá€·á€ºá€€á€¼á€•á€«á€…á€­á€¯á€·á‹

### Production á€á€½á€„á€º á€á€¼á€±á€›á€¬á€á€¶á€›á€™á€Šá€·á€º á€¡á€“á€­á€€ Metrics á€™á€»á€¬á€¸

1.  **á€€á€¯á€”á€ºá€€á€»á€…á€›á€­á€á€ºá€™á€»á€¬á€¸ (Costs)** â€” `smolagents` á€á€•á€ºá€†á€„á€ºá€™á€¾á€¯á€á€Šá€º Token á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€™á€¾á€¯á€€á€­á€¯ á€–á€™á€ºá€¸á€šá€°á€•á€«á€á€šá€ºá‹ áá€„á€ºá€¸á€€á€­á€¯ Token á€á€…á€ºá€á€¯á€á€»á€„á€ºá€¸á€…á€®á á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸ á€á€á€ºá€™á€¾á€á€ºá€á€¼á€„á€ºá€¸á€–á€¼á€„á€·á€º á€á€”á€·á€ºá€™á€¾á€”á€ºá€¸á€á€¼á€± á€€á€¯á€”á€ºá€€á€»á€…á€›á€­á€á€ºá€¡á€–á€¼á€…á€º á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹
2.  **Latency** â€” á€¡á€†á€„á€·á€ºá€á€…á€ºá€á€¯á€…á€® á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ Run á€á€…á€ºá€á€¯á€œá€¯á€¶á€¸ á€•á€¼á€®á€¸á€™á€¼á€±á€¬á€€á€ºá€›á€”á€º á€€á€¼á€¬á€™á€¼á€„á€·á€ºá€á€±á€¬ á€¡á€á€»á€­á€”á€ºá€€á€­á€¯ á€…á€±á€¬á€„á€·á€ºá€€á€¼á€Šá€·á€ºá€á€¼á€„á€ºá€¸á‹
3.  **á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€° á€á€¯á€¶á€·á€•á€¼á€”á€ºá€á€»á€€á€º (User Feedback)** â€” á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á€™á€»á€¬á€¸á€á€Šá€º Agent á€€á€­á€¯ á€•á€­á€¯á€™á€­á€¯á€€á€±á€¬á€„á€ºá€¸á€™á€½á€”á€ºá€¡á€±á€¬á€„á€º á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€•á€¼á€„á€ºá€†á€„á€ºá€›á€”á€ºá€¡á€á€½á€€á€º á€á€­á€¯á€€á€ºá€›á€­á€¯á€€á€º á€á€¯á€¶á€·á€•á€¼á€”á€ºá€á€»á€€á€º (Thumbs up/down) á€•á€±á€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹
4.  **LLM-as-a-Judge** â€” á€á€„á€ºá Agent á€›á€²á€· á€›á€œá€’á€ºá€€á€­á€¯ (á€¥á€•á€™á€¬ - á€¡á€†á€­á€•á€ºá€¡á€á€±á€¬á€€á€ºá€–á€¼á€…á€ºá€…á€±á€™á€¾á€¯ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€™á€¾á€”á€ºá€€á€”á€ºá€™á€¾á€¯á€›á€¾á€­á€™á€›á€¾á€­) Real-time á€”á€®á€¸á€•á€«á€¸ á€¡á€€á€²á€–á€¼á€á€ºá€›á€”á€ºá€¡á€á€½á€€á€º á€á€®á€¸á€á€¼á€¬á€¸ LLM á€á€…á€ºá€á€¯á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€¼á€„á€ºá€¸á‹

á€¡á€±á€¬á€€á€ºá€™á€¾á€¬ á€’á€® Metrics á€á€½á€±á€›á€²á€· á€¥á€•á€™á€¬á€™á€»á€¬á€¸á€€á€­á€¯ á€•á€¼á€á€‘á€¬á€¸á€•á€«á€á€šá€ºá‹

#### á. á€€á€¯á€”á€ºá€€á€»á€…á€›á€­á€á€ºá€™á€»á€¬á€¸ (Costs)

á€¡á€±á€¬á€€á€ºá€•á€« Screenshot á€á€Šá€º `Qwen2.5-Coder-32B-Instruct` Calls á€™á€»á€¬á€¸á€¡á€á€½á€€á€º á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€™á€¾á€¯á€€á€­á€¯ á€•á€¼á€á€‘á€¬á€¸á€•á€«á€á€šá€ºá‹ á€’á€«á€€ á€€á€¯á€”á€ºá€€á€»á€…á€›á€­á€á€ºá€™á€»á€¬á€¸á€á€²á€· á€¡á€†á€„á€·á€ºá€á€½á€±á€€á€­á€¯ á€™á€¼á€„á€ºá€á€½á€±á€·á€”á€­á€¯á€„á€ºá€•á€¼á€®á€¸ á€á€„á€ºá Agent á€€á€­á€¯ á€•á€­á€¯á€™á€­á€¯á€€á€±á€¬á€„á€ºá€¸á€™á€½á€”á€ºá€¡á€±á€¬á€„á€º á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€–á€­á€¯á€·á€¡á€á€½á€€á€º á€¡á€á€¯á€¶á€¸á€á€„á€ºá€•á€«á€á€šá€ºá‹

![Costs](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/smolagents-costs.png)

_[Trace á€á€­á€¯á€· á€œá€„á€·á€ºá€á€º](https://cloud.langfuse.com/project/cloramnkj0002jz088vzn1ja4/traces/1ac33b89ffd5e75d4265b62900c348ed?timestamp=2025-03-07T13%3A45%3A09.149Z&display=preview)_

#### á‚. Latency

á€¡á€†á€„á€·á€ºá€á€…á€ºá€á€¯á€…á€® á€•á€¼á€®á€¸á€™á€¼á€±á€¬á€€á€ºá€›á€”á€º á€¡á€á€»á€­á€”á€ºá€™á€Šá€ºá€™á€»á€¾á€€á€¼á€¬á€á€Šá€ºá€€á€­á€¯á€œá€Šá€ºá€¸ á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€· á€™á€¼á€„á€ºá€á€½á€±á€·á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹ á€¡á€±á€¬á€€á€ºá€•á€« á€¥á€•á€™á€¬á€á€½á€„á€º á€…á€€á€¬á€¸á€•á€¼á€±á€¬á€†á€­á€¯á€™á€¾á€¯á€á€…á€ºá€á€¯á€œá€¯á€¶á€¸ áƒá‚ á€…á€€á€¹á€€á€”á€·á€º á€€á€¼á€¬á€™á€¼á€„á€·á€ºá€á€²á€·á€•á€¼á€®á€¸áŠ áá€„á€ºá€¸á€€á€­á€¯ á€¡á€†á€„á€·á€ºá€¡á€œá€­á€¯á€€á€º á€á€½á€²á€á€¼á€™á€ºá€¸á€€á€¼á€Šá€·á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹ á€’á€«á€€ á€¡á€á€»á€­á€”á€ºá€€á€¯á€”á€ºá€†á€¯á€¶á€¸á€á€²á€· á€¡á€•á€­á€¯á€„á€ºá€¸á€á€½á€±á€€á€­á€¯ á€›á€¾á€¬á€–á€½á€±á€•á€¼á€®á€¸ Agent á€€á€­á€¯ á€•á€­á€¯á€™á€­á€¯á€€á€±á€¬á€„á€ºá€¸á€™á€½á€”á€ºá€¡á€±á€¬á€„á€º á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€–á€­á€¯á€· á€€á€°á€Šá€®á€•á€±á€¸á€•á€«á€á€šá€ºá‹

![Latency](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/smolagents-latency.png)

_[Trace á€á€­á€¯á€· á€œá€„á€·á€ºá€á€º](https://cloud.langfuse.com/project/cloramnkj0002jz088vzn1ja4/traces/1ac33b89ffd5e75d4265b62900c348ed?timestamp=2025-03-07T13%3A45%3A09.149Z&display=preview)_

#### áƒ. á€”á€±á€¬á€€á€ºá€‘á€•á€º Attributes á€™á€»á€¬á€¸ (Additional Attributes)

á€á€„á€ºá Spans á€™á€»á€¬á€¸á€á€­á€¯á€· á€”á€±á€¬á€€á€ºá€‘á€•á€º Attributes á€™á€»á€¬á€¸á€€á€­á€¯á€œá€Šá€ºá€¸ á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹ áá€„á€ºá€¸á€á€­á€¯á€·á€á€½á€„á€º `user_id`áŠ `tags`áŠ `session_id` á€”á€¾á€„á€·á€º Custom Metadata á€™á€»á€¬á€¸ á€•á€«á€á€„á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹ Traces á€™á€»á€¬á€¸á€€á€­á€¯ á€¤á€¡á€á€±á€¸á€…á€­á€á€ºá€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸á€–á€¼á€„á€·á€º á€€á€¼á€½á€šá€ºá€á€…á€±á€á€¼á€„á€ºá€¸á€Ÿá€¬ á€™á€á€°á€Šá€®á€á€²á€· á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á€™á€»á€¬á€¸ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º Sessions á€™á€»á€¬á€¸á€¡á€œá€­á€¯á€€á€º á€á€„á€ºá Application á€›á€²á€· á€¡á€•á€¼á€¯á€¡á€™á€°á€€á€­á€¯ á€á€½á€²á€á€¼á€™á€ºá€¸á€…á€­á€á€ºá€–á€¼á€¬á€á€¼á€„á€ºá€¸áŠ Debug á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸á€”á€¾á€„á€·á€º á€…á€±á€¬á€„á€·á€ºá€€á€¼á€Šá€·á€ºá€á€¼á€„á€ºá€¸á€á€­á€¯á€·á€¡á€á€½á€€á€º á€¡á€›á€±á€¸á€€á€¼á€®á€¸á€•á€«á€á€šá€ºá‹

```python
from smolagents import (CodeAgent, DuckDuckGoSearchTool, InferenceClientModel)

search_tool = DuckDuckGoSearchTool()
agent = CodeAgent(
    tools=[search_tool],
    model=InferenceClientModel()
)

with langfuse.start_as_current_span(
    name="Smolagent-Trace",
    ) as span:
    
    # á€á€„á€ºá Application Logic á€€á€­á€¯ Run á€•á€«
    response = agent.run("What is the capital of Germany?")
 
    # Span á€á€­á€¯á€· á€”á€±á€¬á€€á€ºá€‘á€•á€º Attributes á€™á€»á€¬á€¸ á€•á€±á€¸á€•á€­á€¯á€·á€á€¼á€„á€ºá€¸
    span.update_trace(
        input="What is the capital of Germany?",
        output=response,
        user_id="smolagent-user-123",
        session_id="smolagent-session-123456789",
        tags=["city-question", "testing-agents"],
        metadata={"email": "user@langfuse.com"},
        )
 
# Short-lived Application á€™á€»á€¬á€¸á€á€½á€„á€º Events á€™á€»á€¬á€¸á€€á€­á€¯ Flush á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸
langfuse.flush()
```

![Enhancing agent runs with additional metrics](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/smolagents-attributes.png)

#### á„. á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€° á€á€¯á€¶á€·á€•á€¼á€”á€ºá€á€»á€€á€º (User Feedback)

á€á€„á€ºá Agent á€€á€­á€¯ User Interface á€á€½á€„á€º á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€‘á€¬á€¸á€•á€«á€€áŠ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á á€á€­á€¯á€€á€ºá€›á€­á€¯á€€á€º á€á€¯á€¶á€·á€•á€¼á€”á€ºá€á€»á€€á€º (á€¥á€•á€™á€¬ - Chat UI á€›á€¾á€­ Thumbs-up/down) á€€á€­á€¯ á€™á€¾á€á€ºá€á€™á€ºá€¸á€á€„á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹ á€¡á€±á€¬á€€á€ºá€á€½á€„á€º á€›á€­á€¯á€¸á€›á€¾á€„á€ºá€¸á€á€±á€¬ Feedback á€šá€”á€¹á€á€›á€¬á€¸á€•á€«á€›á€¾á€­á€á€Šá€·á€º Chat á€€á€­á€¯ á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€›á€”á€º [Gradio](https://gradio.app/) á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€‘á€¬á€¸á€á€±á€¬ á€¥á€•á€™á€¬á€á€…á€ºá€á€¯ á€–á€¼á€…á€ºá€•á€«á€á€šá€ºá‹

á€¡á€±á€¬á€€á€ºá€•á€« Code Snippet á€á€½á€„á€ºáŠ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á€€ Chat Message á€•á€­á€¯á€·á€œá€­á€¯á€€á€ºá€á€²á€·á€¡á€á€« Langfuse á€™á€¾á€¬ Trace á€€á€­á€¯ á€–á€™á€ºá€¸á€šá€°á€•á€«á€á€šá€ºá‹ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á€€ á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸á€¡á€–á€¼á€±á€€á€­á€¯ á€€á€¼á€­á€¯á€€á€ºá€á€Šá€º/á€™á€€á€¼á€­á€¯á€€á€ºá€á€Šá€ºá€€á€­á€¯ á€–á€±á€¬á€ºá€•á€¼á€•á€«á€€áŠ á€‘á€­á€¯ Trace á€á€­á€¯á€· Score á€á€…á€ºá€á€¯á€€á€­á€¯ á€•á€°á€¸á€á€½á€²á€•á€±á€¸á€•á€«á€á€šá€ºá‹

```python
import gradio as gr
from smolagents import (CodeAgent, InferenceClientModel)
from langfuse import get_client

langfuse = get_client()

model = InferenceClientModel()
agent = CodeAgent(tools=[], model=model, add_base_tools=True)

trace_id = None

def respond(prompt, history):
    with langfuse.start_as_current_span(
        name="Smolagent-Trace"):
        
        # á€á€„á€ºá Application Logic á€€á€­á€¯ Run á€•á€«
        output = agent.run(prompt)

        global trace_id
        trace_id = langfuse.get_current_trace_id()

    history.append({"role": "assistant", "content": str(output)})
    return history

def handle_like(data: gr.LikeData):
    # á€¥á€•á€™á€¬á€•á€¼á€›á€”á€ºá€¡á€á€½á€€á€ºáŠ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á Feedback á€€á€­á€¯ 1 (á€€á€¼á€­á€¯á€€á€ºá€á€Šá€º) á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º 0 (á€™á€€á€¼á€­á€¯á€€á€º) á€¡á€–á€¼á€…á€º á€á€á€ºá€™á€¾á€á€ºá€á€Šá€ºá‹
    if data.liked:
        langfuse.create_score(
            value=1,
            name="user-feedback",
            trace_id=trace_id
        )
    else:
        langfuse.create_score(
            value=0,
            name="user-feedback",
            trace_id=trace_id
        )

with gr.Blocks() as demo:
    chatbot = gr.Chatbot(label="Chat", type="messages")
    prompt_box = gr.Textbox(placeholder="Type your message...", label="Your message")

    # á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á€€ Prompt á€á€½á€„á€º 'Enter' á€”á€¾á€­á€•á€ºá€á€±á€¬á€¡á€á€« 'respond' á€€á€­á€¯ Run á€•á€«
    prompt_box.submit(
        fn=respond,
        inputs=[prompt_box, chatbot],
        outputs=chatbot
    )

    # á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á€€ Message á€•á€±á€«á€ºá€›á€¾á€­ 'like' á€á€œá€¯á€á€ºá€€á€­á€¯ á€”á€¾á€­á€•á€ºá€á€±á€¬á€¡á€á€« 'handle_like' á€€á€­á€¯ Run á€•á€«
    chatbot.like(handle_like, None, None)

demo.launch()
```

á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á á€á€¯á€¶á€·á€•á€¼á€”á€ºá€á€»á€€á€ºá€€á€­á€¯ á€á€„á€ºá Observability Tool á€á€½á€„á€º á€–á€™á€ºá€¸á€šá€°á€‘á€¬á€¸á€•á€«á€á€šá€ºá‹

![User feedback is being captured in Langfuse](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/user-feedback-gradio.png)

#### á…. LLM-as-a-Judge

LLM-as-a-Judge á€á€Šá€º á€á€„á€ºá Agent á€›á€²á€· á€›á€œá€’á€ºá€€á€­á€¯ á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º á€¡á€€á€²á€–á€¼á€á€ºá€›á€”á€º á€”á€±á€¬á€€á€ºá€‘á€•á€º á€”á€Šá€ºá€¸á€œá€™á€ºá€¸á€á€…á€ºá€á€¯ á€–á€¼á€…á€ºá€•á€«á€á€šá€ºá‹ á€á€„á€ºá Agent á€›á€²á€· á€›á€œá€’á€ºá€á€Šá€º á€™á€¾á€”á€ºá€€á€”á€ºá€™á€¾á€¯áŠ á€¡á€†á€­á€•á€ºá€¡á€á€±á€¬á€€á€ºá€–á€¼á€…á€ºá€…á€±á€™á€¾á€¯áŠ á€•á€¯á€¶á€…á€¶ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€á€„á€ºá€…á€­á€á€ºá€á€„á€ºá€…á€¬á€¸á€á€±á€¬ á€¡á€á€¼á€¬á€¸ á€…á€¶á€”á€¾á€¯á€”á€ºá€¸á€™á€»á€¬á€¸á€”á€¾á€„á€·á€º á€€á€­á€¯á€€á€ºá€Šá€®á€™á€¾á€¯á€›á€¾á€­á€™á€›á€¾á€­ á€á€­á€¯á€„á€ºá€¸á€á€¬á€›á€”á€ºá€¡á€á€½á€€á€º á€á€®á€¸á€á€¼á€¬á€¸ LLM Call á€á€…á€ºá€á€¯á€€á€­á€¯ á€á€á€ºá€™á€¾á€á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

**Workflow**:
1. á€á€„á€ºá€á€Šá€º **Evaluation Template** á€á€…á€ºá€á€¯á€€á€­á€¯ á€á€á€ºá€™á€¾á€á€ºá€•á€«á€á€šá€ºá‹ (á€¥á€•á€™á€¬ - "á€…á€¬á€á€¬á€¸á€á€Šá€º á€¡á€†á€­á€•á€ºá€¡á€á€±á€¬á€€á€ºá€–á€¼á€…á€ºá€…á€±á€á€¼á€„á€ºá€¸ á€›á€¾á€­á€™á€›á€¾á€­ á€…á€…á€ºá€†á€±á€¸á€•á€«")á‹
2. á€á€„á€ºá Agent á€€ á€›á€œá€’á€º á€‘á€¯á€á€ºá€•á€±á€¸á€á€­á€¯á€„á€ºá€¸áŠ á€‘á€­á€¯á€›á€œá€’á€ºá€€á€­á€¯ Template á€”á€¾á€„á€·á€ºá€¡á€á€° á€á€„á€ºá "Judge" LLM á€á€­á€¯á€· á€•á€±á€¸á€•á€­á€¯á€·á€•á€«á€á€šá€ºá‹
3. Judge LLM á€€ á€¡á€†á€„á€·á€ºá€á€á€ºá€™á€¾á€á€ºá€á€»á€€á€º á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º Label á€á€…á€ºá€á€¯á€–á€¼á€„á€·á€º á€á€¯á€¶á€·á€•á€¼á€”á€ºá€•á€¼á€®á€¸áŠ áá€„á€ºá€¸á€€á€­á€¯ á€á€„á€ºá Observability Tool á€á€½á€„á€º Log á€œá€¯á€•á€ºá€•á€«á€á€šá€ºá‹

Langfuse á€™á€¾ á€¥á€•á€™á€¬:

![LLM-as-a-Judge Evaluation Template](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/evaluator-template.png)
![LLM-as-a-Judge Evaluator](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/evaluator.png)

```python
# á€¥á€•á€™á€¬: Agent á€›á€²á€· á€›á€œá€’á€ºá€á€Šá€º á€¡á€†á€­á€•á€ºá€¡á€á€±á€¬á€€á€ºá€–á€¼á€…á€ºá€…á€±á€á€¼á€„á€ºá€¸ á€›á€¾á€­á€™á€›á€¾á€­ á€…á€…á€ºá€†á€±á€¸á€á€¼á€„á€ºá€¸á‹
from smolagents import (CodeAgent, DuckDuckGoSearchTool, InferenceClientModel)

search_tool = DuckDuckGoSearchTool()
agent = CodeAgent(tools=[search_tool], model=InferenceClientModel())

agent.run("Can eating carrots improve your vision?")
```

á€’á€®á€¥á€•á€™á€¬á€›á€²á€· á€¡á€–á€¼á€±á€€á€­á€¯ "á€¡á€†á€­á€•á€ºá€¡á€á€±á€¬á€€á€ºá€™á€–á€¼á€…á€ºá€…á€±á€•á€«" á€Ÿá€¯ á€¡á€€á€²á€–á€¼á€á€ºá€‘á€¬á€¸á€á€Šá€ºá€€á€­á€¯ á€™á€¼á€„á€ºá€á€½á€±á€·á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

![LLM-as-a-Judge Evaluation Score](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/llm-as-a-judge-score.png)

#### á†. Observability Metrics á€á€¼á€¯á€¶á€„á€¯á€¶á€á€¯á€¶á€¸á€á€•á€ºá€á€»á€€á€º

á€¤ Metrics á€™á€»á€¬á€¸á€¡á€¬á€¸á€œá€¯á€¶á€¸á€€á€­á€¯ Dashboard á€™á€»á€¬á€¸á€á€½á€„á€º á€á€…á€ºá€…á€¯á€á€…á€ºá€…á€Šá€ºá€¸á€á€Šá€ºá€¸ á€™á€¼á€„á€ºá€á€½á€±á€·á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹ á€’á€«á€€ á€á€„á€ºá Agent á€á€Šá€º Sessions á€™á€»á€¬á€¸á€…á€½á€¬á€á€½á€„á€º á€™á€Šá€ºá€á€­á€¯á€· á€…á€½á€™á€ºá€¸á€†á€±á€¬á€„á€ºá€á€Šá€ºá€€á€­á€¯ á€œá€»á€„á€ºá€™á€¼á€”á€ºá€…á€½á€¬ á€™á€¼á€„á€ºá€á€½á€±á€·á€”á€­á€¯á€„á€ºá€…á€±á€•á€¼á€®á€¸áŠ á€¡á€á€»á€­á€”á€ºá€”á€¾á€„á€·á€ºá€¡á€™á€»á€¾ á€¡á€›á€Šá€ºá€¡á€á€½á€±á€¸ Metrics á€™á€»á€¬á€¸á€€á€­á€¯ á€á€¼á€±á€›á€¬á€á€¶á€›á€”á€º á€€á€°á€Šá€®á€•á€±á€¸á€•á€«á€á€šá€ºá‹

![Observability metrics overview](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/langfuse-dashboard.png)

## Offline á€¡á€€á€²á€–á€¼á€á€ºá€á€¼á€„á€ºá€¸ (Offline Evaluation)

Online Evaluation á€á€Šá€º Live Feedback á€¡á€á€½á€€á€º á€¡á€›á€±á€¸á€€á€¼á€®á€¸á€á€±á€¬á€ºá€œá€Šá€ºá€¸áŠ á€á€„á€ºá€á€Šá€º Development á€™á€œá€¯á€•á€ºá€™á€® á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€”á€±á€…á€‰á€ºá€¡á€á€½á€„á€ºá€¸ á€…á€”á€…á€ºá€á€€á€» á€…á€…á€ºá€†á€±á€¸á€™á€¾á€¯á€™á€»á€¬á€¸ á€•á€¼á€¯á€œá€¯á€•á€ºá€›á€”á€º **Offline Evaluation** á€œá€Šá€ºá€¸ á€œá€­á€¯á€¡á€•á€ºá€•á€«á€á€šá€ºá‹ á€’á€«á€€ Production á€á€­á€¯á€· á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€™á€¾á€¯á€™á€»á€¬á€¸ á€™á€•á€¼á€¯á€œá€¯á€•á€ºá€™á€® á€¡á€›á€Šá€ºá€¡á€á€½á€±á€¸á€”á€¾á€„á€·á€º á€šá€¯á€¶á€€á€¼á€Šá€ºá€…á€­á€á€ºá€á€»á€›á€™á€¾á€¯á€€á€­á€¯ á€‘á€­á€”á€ºá€¸á€á€­á€™á€ºá€¸á€›á€”á€º á€€á€°á€Šá€®á€•á€±á€¸á€•á€«á€á€šá€ºá‹

### Dataset á€¡á€€á€²á€–á€¼á€á€ºá€á€¼á€„á€ºá€¸

Offline Evaluation á€á€½á€„á€º á€á€„á€ºá€á€Šá€º á€¡á€™á€»á€¬á€¸á€¡á€¬á€¸á€–á€¼á€„á€·á€º á€¡á€±á€¬á€€á€ºá€•á€«á€á€­á€¯á€·á€€á€­á€¯ á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€•á€«á€á€šá€ºá‹
1. Benchmark Dataset (Prompt á€”á€¾á€„á€·á€º á€™á€»á€¾á€±á€¬á€ºá€™á€¾á€”á€ºá€¸á€‘á€¬á€¸á€á€±á€¬ á€›á€œá€’á€ºá€¡á€á€½á€²á€™á€»á€¬á€¸ á€•á€«á€á€„á€ºá€á€Šá€º) á€€á€­á€¯ á€›á€šá€°á€á€¼á€„á€ºá€¸á‹
2. á€‘á€­á€¯ Dataset á€•á€±á€«á€ºá€á€½á€„á€º á€á€„á€ºá Agent á€€á€­á€¯ Run á€á€¼á€„á€ºá€¸á‹
3. á€›á€œá€’á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€™á€»á€¾á€±á€¬á€ºá€™á€¾á€”á€ºá€¸á€‘á€¬á€¸á€á€±á€¬ á€¡á€–á€¼á€±á€™á€»á€¬á€¸á€”á€¾á€„á€·á€º á€”á€¾á€­á€¯á€„á€ºá€¸á€šá€¾á€‰á€ºá€á€¼á€„á€ºá€¸ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€”á€±á€¬á€€á€ºá€‘á€•á€º Scoring á€šá€”á€¹á€á€›á€¬á€¸á€á€…á€ºá€á€¯á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€¼á€„á€ºá€¸á‹

á€¡á€±á€¬á€€á€ºá€á€½á€„á€º á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€·á€á€Šá€º á€á€„á€ºá€¹á€á€»á€¬á€™á€±á€¸á€á€½á€”á€ºá€¸á€™á€»á€¬á€¸á€”á€¾á€„á€·á€º á€¡á€–á€¼á€±á€™á€»á€¬á€¸ á€•á€«á€á€„á€ºá€á€±á€¬ [GSM8K Dataset](https://huggingface.co/datasets/openai/gsm8k) á€–á€¼á€„á€·á€º á€¤á€”á€Šá€ºá€¸á€œá€™á€ºá€¸á€€á€­á€¯ á€á€›á€¯á€•á€ºá€•á€¼á€•á€«á€™á€šá€ºá‹

```python
import pandas as pd
from datasets import load_dataset

# Hugging Face á€™á€¾ GSM8K á€€á€­á€¯ á€›á€šá€°á€á€¼á€„á€ºá€¸
dataset = load_dataset("openai/gsm8k", 'main', split='train')
df = pd.DataFrame(dataset)
print("GSM8K Dataset á á€•á€‘á€™á€†á€¯á€¶á€¸ á€…á€¬á€€á€¼á€±á€¬á€„á€ºá€¸á€¡á€á€»á€­á€¯á€·:")
print(df.head())
```

á€‘á€­á€¯á€·á€”á€±á€¬á€€á€ºáŠ Runs á€™á€»á€¬á€¸á€€á€­á€¯ á€á€¼á€±á€›á€¬á€á€¶á€›á€”á€º Langfuse á€á€½á€„á€º Dataset Entity á€á€…á€ºá€á€¯á€€á€­á€¯ á€–á€”á€ºá€á€®á€¸á€•á€«á€á€šá€ºá‹ á€‘á€­á€¯á€·á€”á€±á€¬á€€á€º Dataset á€™á€¾ Item á€á€…á€ºá€á€¯á€…á€®á€€á€­á€¯ á€…á€”á€…á€ºá€‘á€²á€á€­á€¯á€· á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€•á€«á€á€šá€ºá‹ (Langfuse á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€™á€•á€¼á€¯á€•á€«á€€áŠ áá€„á€ºá€¸á€á€­á€¯á€·á€€á€­á€¯ á€á€„á€ºá á€€á€­á€¯á€šá€ºá€•á€­á€¯á€„á€º Database á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º Local File á€á€½á€„á€º á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€º)á‹

```python
from langfuse import get_client
langfuse = get_client()

langfuse_dataset_name = "gsm8k_dataset_huggingface"

# Langfuse á€á€½á€„á€º Dataset á€á€…á€ºá€á€¯ á€–á€”á€ºá€á€®á€¸á€á€¼á€„á€ºá€¸
langfuse.create_dataset(
    name=langfuse_dataset_name,
    description="Huggingface á€™á€¾ Upload á€œá€¯á€•á€ºá€‘á€¬á€¸á€á€±á€¬ GSM8K benchmark dataset",
    metadata={
        "date": "2025-03-10", 
        "type": "benchmark"
    }
)
```

```python
for idx, row in df.iterrows():
    langfuse.create_dataset_item(
        dataset_name=langfuse_dataset_name,
        input={"text": row["question"]},
        expected_output={"text": row["answer"]},
        metadata={"source_index": idx}
    )
    if idx >= 9: # á€¥á€•á€™á€¬á€•á€¼á€›á€”á€ºá€¡á€á€½á€€á€º á€•á€‘á€™á€†á€¯á€¶á€¸ Item áá€ á€á€¯á€€á€­á€¯á€á€¬ Upload á€œá€¯á€•á€ºá€•á€«á€™á€Šá€ºá‹
        break
```

![Dataset items in Langfuse](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/example-dataset.png)

#### Dataset á€•á€±á€«á€ºá€á€½á€„á€º Agent á€€á€­á€¯ Run á€á€¼á€„á€ºá€¸

á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€·á€á€Šá€º á€¡á€±á€¬á€€á€ºá€•á€«á€á€­á€¯á€·á€€á€­á€¯ á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€™á€Šá€·á€º Helper Function `run_smolagent()` á€€á€­á€¯ á€á€á€ºá€™á€¾á€á€ºá€•á€«á€™á€šá€ºá‹
1. Langfuse Span á€á€…á€ºá€á€¯á€€á€­á€¯ á€…á€á€„á€ºá€á€¼á€„á€ºá€¸á‹
2. Prompt á€•á€±á€«á€ºá€á€½á€„á€º Agent á€€á€­á€¯ Run á€á€¼á€„á€ºá€¸á‹
3. Trace ID á€€á€­á€¯ Langfuse á€á€½á€„á€º á€™á€¾á€á€ºá€á€™á€ºá€¸á€á€„á€ºá€á€¼á€„á€ºá€¸á‹

á€‘á€­á€¯á€·á€”á€±á€¬á€€á€ºáŠ Dataset Item á€á€…á€ºá€á€¯á€…á€®á€€á€­á€¯ Loop á€œá€¯á€•á€ºá€•á€¼á€®á€¸ Agent á€€á€­á€¯ Run á€á€¼á€„á€ºá€¸áŠ Trace á€€á€­á€¯ Dataset Item á€”á€¾á€„á€·á€º á€á€»á€­á€á€ºá€†á€€á€ºá€á€¼á€„á€ºá€¸á€á€­á€¯á€·á€€á€­á€¯ á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€•á€«á€á€šá€ºá‹ á€œá€­á€¯á€¡á€•á€ºá€•á€«á€€ Quick Evaluation Score á€€á€­á€¯á€œá€Šá€ºá€¸ á€•á€°á€¸á€á€½á€²á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

```python
from opentelemetry.trace import format_trace_id
from smolagents import (CodeAgent, InferenceClientModel, LiteLLMModel)
from langfuse import get_client
 
langfuse = get_client()


# á€¥á€•á€™á€¬: openai, anthropic, gemini á€…á€á€Šá€·á€º á€™á€±á€¬á€ºá€’á€šá€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€›á€”á€º InferenceClientModel á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º LiteLLMModel á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€¼á€„á€ºá€¸:
model = InferenceClientModel()

agent = CodeAgent(
    tools=[],
    model=model,
    add_base_tools=True
)

dataset_name = "gsm8k_dataset_huggingface"
current_run_name = "smolagent-notebook-run-01" # á€¤ á€á€®á€¸á€á€¼á€¬á€¸ Evaluation Run á€€á€­á€¯ á€á€½á€²á€á€¼á€¬á€¸á€á€á€ºá€™á€¾á€á€ºá€á€¼á€„á€ºá€¸
 
# 'run_smolagent' á€á€Šá€º á€á€„á€ºá á€…á€”á€…á€ºá€á€€á€» á€á€•á€ºá€†á€„á€ºá€‘á€¬á€¸á€á€±á€¬ Application Function á€–á€¼á€…á€ºá€á€Šá€ºá€Ÿá€¯ á€šá€°á€†á€•á€«
def run_smolagent(question):
    with langfuse.start_as_current_generation(name="qna-llm-call") as generation:
        # LLM Call á€€á€­á€¯ á€¡á€á€¯á€šá€°á€á€¼á€„á€ºá€¸
        result = agent.run(question)
 
        # Trace á€€á€­á€¯ Input á€”á€¾á€„á€·á€º Output á€–á€¼á€„á€·á€º Update á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸
        generation.update_trace(
            input= question,
            output=result,
        )
 
        return result
 
dataset = langfuse.get_dataset(name=dataset_name) # á€á€„á€ºá á€€á€¼á€­á€¯á€á€„á€ºá€–á€¼á€Šá€·á€ºá€á€½á€„á€ºá€¸á€‘á€¬á€¸á€á€±á€¬ Dataset á€€á€­á€¯ á€›á€šá€°á€á€¼á€„á€ºá€¸
 
for item in dataset.items:
 
    # item.run() context manager á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€¼á€„á€ºá€¸
    with item.run(
        run_name=current_run_name,
        run_metadata={"model_provider": "Hugging Face", "temperature_setting": 0.7},
        run_description="Evaluation run for GSM8K dataset"
    ) as root_span: # root_span á€á€Šá€º á€¤ Item á€”á€¾á€„á€·á€º Run á€¡á€á€½á€€á€º Trace á€¡á€á€…á€ºá Root Span á€–á€¼á€…á€ºá€á€Šá€ºá‹
        # á€¤ Block á€¡á€á€½á€„á€ºá€¸á€›á€¾á€­ á€”á€±á€¬á€€á€ºá€†á€€á€ºá€á€½á€² Langfuse á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€á€»á€€á€ºá€™á€»á€¬á€¸á€¡á€¬á€¸á€œá€¯á€¶á€¸á€á€Šá€º á€¤ Trace á á€¡á€…á€­á€á€ºá€¡á€•á€­á€¯á€„á€ºá€¸á€™á€»á€¬á€¸ á€–á€¼á€…á€ºá€á€Šá€ºá‹
 
        # á€á€„á€ºá Application Logic á€€á€­á€¯ á€á€±á€«á€ºá€†á€­á€¯á€á€¼á€„á€ºá€¸
        generated_answer = run_smolagent(question=item.input["text"])
 
        print(item.input)
```

á€¤á€œá€¯á€•á€ºá€„á€”á€ºá€¸á€…á€‰á€ºá€€á€­á€¯ á€™á€á€°á€Šá€®á€á€±á€¬ á€¡á€±á€¬á€€á€ºá€•á€«á€¡á€á€»á€€á€ºá€™á€»á€¬á€¸á€–á€¼á€„á€·á€º á€‘á€•á€ºá€á€«á€á€œá€²á€œá€² á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹
*   Models á€™á€»á€¬á€¸ (OpenAI GPT, Local LLM, á€…á€á€Šá€º)
*   Tools á€™á€»á€¬á€¸ (Search á€•á€«á€á€„á€ºá€á€¼á€„á€ºá€¸ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€™á€•á€«á€á€„á€ºá€á€¼á€„á€ºá€¸)
*   Prompts á€™á€»á€¬á€¸ (á€™á€á€°á€Šá€®á€á€±á€¬ System Messages á€™á€»á€¬á€¸)

á€‘á€­á€¯á€·á€”á€±á€¬á€€á€º áá€„á€ºá€¸á€á€­á€¯á€·á€€á€­á€¯ á€á€„á€ºá Observability Tool á€á€½á€„á€º á€˜á€±á€¸á€á€»á€„á€ºá€¸á€šá€¾á€‰á€ºá á€”á€¾á€­á€¯á€„á€ºá€¸á€šá€¾á€‰á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

![Dataset run overview](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/dataset_runs.png)
![Dataset run comparison](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/dataset-run-comparison.png)

## á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸ á€¡á€á€½á€±á€¸á€¡á€™á€¼á€„á€ºá€™á€»á€¬á€¸ (Final Thoughts)

á€’á€® Notebook á€™á€¾á€¬ á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€· á€¡á€±á€¬á€€á€ºá€•á€«á€á€­á€¯á€·á€€á€­á€¯ á€œá€±á€·á€œá€¬á€á€²á€·á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹
1. **Observability á€€á€­á€¯ á€á€á€ºá€™á€¾á€á€ºá€•á€¯á€¶** (`smolagents` + OpenTelemetry Exporters á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€¼á€„á€ºá€¸)
2. á€›á€­á€¯á€¸á€›á€¾á€„á€ºá€¸á€á€±á€¬ Agent á€€á€­á€¯ Run á€á€¼á€„á€ºá€¸á€–á€¼á€„á€·á€º **á€á€•á€ºá€†á€„á€ºá€™á€¾á€¯ á€™á€¾á€”á€ºá€€á€”á€ºá€á€¼á€„á€ºá€¸á€›á€¾á€­á€™á€›á€¾á€­ á€…á€…á€ºá€†á€±á€¸á€•á€¯á€¶**
3. Observability Tool á€™á€»á€¬á€¸á€™á€¾á€á€…á€ºá€†á€„á€·á€º **á€¡á€á€±á€¸á€…á€­á€á€º Metrics á€™á€»á€¬á€¸ (á€€á€¯á€”á€ºá€€á€»á€…á€›á€­á€á€ºáŠ Latency á€…á€á€Šá€º) á€€á€­á€¯ á€–á€™á€ºá€¸á€šá€°á€•á€¯á€¶**
4. Gradio Interface á€™á€¾á€á€…á€ºá€†á€„á€·á€º **á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€° á€á€¯á€¶á€·á€•á€¼á€”á€ºá€á€»á€€á€ºá€€á€­á€¯ á€…á€¯á€†á€±á€¬á€„á€ºá€¸á€•á€¯á€¶**
5. á€›á€œá€’á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º á€¡á€€á€²á€–á€¼á€á€ºá€›á€”á€º **LLM-as-a-Judge á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€•á€¯á€¶**
6. Benchmark Dataset á€–á€¼á€„á€·á€º **Offline Evaluation á€•á€¼á€¯á€œá€¯á€•á€ºá€•á€¯á€¶**

ğŸ¤— á€•á€»á€±á€¬á€ºá€›á€½á€¾á€„á€ºá€…á€½á€¬ Code á€›á€±á€¸á€á€¬á€¸á€”á€­á€¯á€„á€ºá€•á€«á€…á€±!