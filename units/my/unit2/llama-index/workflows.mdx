# LlamaIndex á€á€½á€„á€º Agent á€œá€¯á€•á€ºá€„á€”á€ºá€¸á€¡á€†á€„á€·á€ºá€†á€„á€·á€º (Workflows) á€™á€»á€¬á€¸á€€á€­á€¯ á€–á€”á€ºá€á€®á€¸á€á€¼á€„á€ºá€¸

LlamaIndex á€›á€¾á€­ **á€œá€¯á€•á€ºá€„á€”á€ºá€¸á€¡á€†á€„á€·á€ºá€†á€„á€·á€º (Workflow)** á€†á€­á€¯á€á€¬á€Ÿá€¬ á€á€„á€·á€ºá€›á€²á€· Code á€á€½á€±á€€á€­á€¯ á€…á€”á€…á€ºá€á€€á€»á€”á€²á€· á€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€”á€­á€¯á€„á€ºá€á€²á€· á€¡á€†á€„á€·á€ºá€™á€»á€¬á€¸á€¡á€–á€¼á€…á€º á€…á€¯á€…á€Šá€ºá€¸á€•á€±á€¸á€á€²á€· á€”á€Šá€ºá€¸á€œá€™á€ºá€¸á€á€…á€ºá€á€¯ á€–á€¼á€…á€ºá€•á€«á€á€šá€ºá‹

á€’á€®á€œá€­á€¯ Workflow á€á€…á€ºá€á€¯á€€á€­á€¯ **`Events`** á€™á€»á€¬á€¸á€€á€”á€± á€…á€á€„á€ºá€œá€¾á€¯á€•á€ºá€›á€¾á€¬á€¸á€•á€±á€¸á€á€²á€· **`Steps`** á€á€½á€±á€€á€­á€¯ á€á€á€ºá€™á€¾á€á€ºá€á€¼á€„á€ºá€¸á€–á€¼á€„á€·á€º á€–á€”á€ºá€á€®á€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹ á€’á€® `Steps` á€á€½á€±á€€á€œá€Šá€ºá€¸ á€”á€±á€¬á€€á€ºá€‘á€•á€º `Events` á€á€½á€±á€€á€­á€¯ á€‘á€¯á€á€ºá€œá€½á€¾á€á€ºá€•á€¼á€®á€¸ á€”á€±á€¬á€€á€ºá€‘á€•á€º `Steps` á€á€½á€±á€€á€­á€¯ á€†á€€á€ºá€œá€€á€º á€œá€¾á€¯á€•á€ºá€›á€¾á€¬á€¸á€…á€±á€•á€«á€á€šá€ºá‹

RAG (Retrieval-Augmented Generation) á€œá€¯á€•á€ºá€„á€”á€ºá€¸á€á€…á€ºá€á€¯á€¡á€á€½á€€á€º LlamaIndex Workflow á€•á€¯á€¶á€€á€¼á€™á€ºá€¸á€€á€­á€¯ Alfred á€€ á€•á€¼á€á€‘á€¬á€¸á€á€¬á€€á€­á€¯ á€€á€¼á€Šá€·á€ºá€œá€­á€¯á€€á€ºá€›á€¡á€±á€¬á€„á€ºá‹

![Workflow Schematic](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit2/llama-index/workflows.png)

**Workflows á€á€½á€±á€€ á€¡á€“á€­á€€ á€¡á€€á€»á€­á€¯á€¸á€€á€»á€±á€¸á€‡á€°á€¸á€™á€»á€¬á€¸á€…á€½á€¬á€€á€­á€¯ á€•á€±á€¸á€•á€«á€á€šá€º:**

*   Code á€™á€»á€¬á€¸á€€á€­á€¯ á€á€®á€¸á€á€¼á€¬á€¸ á€¡á€†á€„á€·á€ºá€™á€»á€¬á€¸á€¡á€–á€¼á€…á€º á€›á€¾á€„á€ºá€¸á€œá€„á€ºá€¸á€…á€½á€¬ á€…á€¯á€…á€Šá€ºá€¸á€•á€±á€¸á€á€¼á€„á€ºá€¸á‹
*   á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€½á€šá€ºá€•á€¼á€„á€ºá€œá€½á€šá€ºá€›á€¾á€­á€á€±á€¬ á€‘á€­á€”á€ºá€¸á€á€»á€¯á€•á€ºá€™á€¾á€¯ á€…á€®á€¸á€†á€„á€ºá€¸á€™á€¾á€¯á€¡á€á€½á€€á€º Event-driven Architecture (á€–á€¼á€…á€ºá€›á€•á€ºá€€á€­á€¯ á€¡á€á€¼á€±á€á€¶á€á€±á€¬ á€—á€­á€á€¯á€€á€¬)á‹
*   á€¡á€†á€„á€·á€ºá€™á€»á€¬á€¸á€¡á€€á€¼á€¬á€¸ Type-safe (á€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸ á€œá€¯á€¶á€á€¼á€¯á€¶á€á€±á€¬) á€†á€€á€ºá€á€½á€šá€ºá€™á€¾á€¯á‹
*   Built-in State Management (á€¡á€á€¼á€±á€¡á€”á€± á€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€™á€¾á€¯)á‹
*   á€›á€­á€¯á€¸á€›á€¾á€„á€ºá€¸á€á€±á€¬ Agent á€¡á€•á€¼á€”á€ºá€¡á€œá€¾á€”á€ºá€†á€€á€ºá€á€½á€šá€ºá€™á€¾á€¯á€™á€»á€¬á€¸á€á€¬á€™á€€ á€›á€¾á€¯á€•á€ºá€‘á€½á€±á€¸á€á€±á€¬ Agent á€¡á€•á€¼á€”á€ºá€¡á€œá€¾á€”á€ºá€†á€€á€ºá€á€½á€šá€ºá€™á€¾á€¯á€™á€»á€¬á€¸á€€á€­á€¯á€•á€« á€•á€¶á€·á€•á€­á€¯á€¸á€•á€±á€¸á€á€¼á€„á€ºá€¸á‹

á€á€„á€ºá€á€­á€¯á€· á€á€”á€·á€ºá€™á€¾á€”á€ºá€¸á€™á€­á€á€²á€·á€¡á€á€­á€¯á€„á€ºá€¸á€•á€«á€•á€²áŠ **Workflows á€á€½á€±á€Ÿá€¬ Agent á€á€½á€±á€›á€²á€· á€€á€­á€¯á€šá€ºá€•á€­á€¯á€„á€º á€†á€¯á€¶á€¸á€–á€¼á€á€ºá€á€»á€€á€ºá€á€»á€”á€­á€¯á€„á€ºá€…á€½á€™á€ºá€¸ (Autonomy) á€”á€²á€· á€œá€¯á€•á€ºá€„á€”á€ºá€¸á€¡á€†á€„á€·á€ºá€†á€„á€·á€ºá€á€…á€ºá€á€¯á€œá€¯á€¶á€¸á€€á€­á€¯ á€‘á€­á€”á€ºá€¸á€á€»á€¯á€•á€ºá€”á€­á€¯á€„á€ºá€™á€¾á€¯ (Control) á€¡á€€á€¼á€¬á€¸á€™á€¾á€¬ á€€á€±á€¬á€„á€ºá€¸á€™á€½á€”á€ºá€á€²á€· á€Ÿá€”á€ºá€á€»á€€á€ºá€Šá€®á€™á€¾á€¯á€€á€­á€¯ á€•á€±á€¸á€…á€½á€™á€ºá€¸á€•á€«á€á€šá€º**á‹

á€’á€«á€†á€­á€¯á€›á€„á€º á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€· á€€á€­á€¯á€šá€ºá€á€­á€¯á€„á€º Workflow á€á€…á€ºá€á€¯á€€á€­á€¯ á€˜á€šá€ºá€œá€­á€¯ á€–á€”á€ºá€á€®á€¸á€›á€™á€œá€²á€†á€­á€¯á€á€¬ á€œá€±á€·á€œá€¬á€€á€¼á€Šá€·á€ºá€›á€¡á€±á€¬á€„á€º!

## Workflows á€™á€»á€¬á€¸ á€–á€”á€ºá€á€®á€¸á€á€¼á€„á€ºá€¸

> [!TIP]
> á€á€„á€ºá€á€­á€¯á€·á€¡á€”á€±á€”á€²á€· [á€’á€® Notebook](https://huggingface.co/agents-course/notebooks/blob/main/unit2/llama-index/workflows.ipynb) á€‘á€²á€€ Code á€á€½á€±á€€á€­á€¯ Google Colab á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€•á€¼á€®á€¸ á€œá€­á€¯á€€á€ºá€œá€¶á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

### á€¡á€á€¼á€±á€á€¶ Workflow á€–á€”á€ºá€á€®á€¸á€á€¼á€„á€ºá€¸

<details>
<summary>Workflow Package á€€á€­á€¯ Install á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸</summary>
[LlamaHub á€¡á€•á€­á€¯á€„á€ºá€¸](./llama-hub) á€™á€¾á€¬ á€™á€­á€á€ºá€†á€€á€ºá€•á€±á€¸á€á€²á€·á€á€²á€·á€¡á€á€­á€¯á€„á€ºá€¸áŠ Workflow Package á€€á€­á€¯ á€¡á€±á€¬á€€á€ºá€•á€« Command á€–á€¼á€„á€·á€º Install á€œá€¯á€•á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

```python
pip install llama-index-utils-workflow
```
</details>

á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€·á€Ÿá€¬ `Workflow` á€™á€¾ á€¡á€™á€½á€±á€†á€€á€ºá€á€¶á€á€²á€· Class á€á€…á€ºá€á€¯á€€á€­á€¯ á€á€á€ºá€™á€¾á€á€ºá€•á€¼á€®á€¸áŠ Functions á€á€½á€±á€€á€­á€¯ `@step` á€–á€¼á€„á€·á€º á€¡á€œá€¾á€†á€„á€º (Decorate) á€á€¼á€„á€ºá€¸á€–á€¼á€„á€·á€º á€¡á€†á€„á€·á€ºá€á€…á€ºá€á€¯á€á€Šá€ºá€¸á€•á€«á€á€„á€ºá€á€²á€· Workflow á€á€…á€ºá€á€¯á€€á€­á€¯ á€–á€”á€ºá€á€®á€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

Workflow á€›á€²á€· á€…á€á€„á€ºá€á€¼á€„á€ºá€¸á€”á€²á€· á€•á€¼á€®á€¸á€†á€¯á€¶á€¸á€á€¼á€„á€ºá€¸á€€á€­á€¯ á€–á€±á€¬á€ºá€•á€¼á€–á€­á€¯á€·á€¡á€á€½á€€á€º á€¡á€‘á€°á€¸ Event á€™á€»á€¬á€¸á€–á€¼á€…á€ºá€á€²á€· `StartEvent` á€”á€²á€· `StopEvent` á€á€½á€±á€€á€­á€¯á€œá€Šá€ºá€¸ á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€–á€­á€¯á€· á€œá€­á€¯á€¡á€•á€ºá€•á€«á€á€šá€ºá‹

```python
from llama_index.core.workflow import StartEvent, StopEvent, Workflow, step

class MyWorkflow(Workflow):
    @step
    async def my_step(self, ev: StartEvent) -> StopEvent:
        # do something here
        return StopEvent(result="Hello, world!")


w = MyWorkflow(timeout=10, verbose=False)
result = await w.run()
```

á€á€„á€ºá€á€­á€¯á€· á€™á€¼á€„á€ºá€á€²á€·á€¡á€á€­á€¯á€„á€ºá€¸á€•á€«á€•á€²áŠ `w.run()` á€€á€­á€¯ á€á€±á€«á€ºá€†á€­á€¯á€á€¼á€„á€ºá€¸á€–á€¼á€„á€·á€º Workflow á€€á€­á€¯ á€…á€á€„á€º á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

### á€¡á€†á€„á€·á€ºá€™á€»á€¬á€¸á€…á€½á€¬á€€á€­á€¯ á€á€»á€­á€á€ºá€†á€€á€ºá€á€¼á€„á€ºá€¸ (Connecting Multiple Steps)

á€¡á€†á€„á€·á€ºá€™á€»á€¬á€¸á€…á€½á€¬á€€á€­á€¯ á€á€»á€­á€á€ºá€†á€€á€ºá€–á€­á€¯á€·á€¡á€á€½á€€á€ºáŠ **á€¡á€†á€„á€·á€ºá€™á€»á€¬á€¸á€¡á€€á€¼á€¬á€¸ á€’á€±á€á€¬á€™á€»á€¬á€¸ á€á€šá€ºá€†á€±á€¬á€„á€ºá€•á€±á€¸á€™á€šá€·á€º Custom Events á€á€½á€±á€€á€­á€¯ á€–á€”á€ºá€á€®á€¸á€›á€•á€«á€™á€šá€º**á‹

á€’á€®á€œá€­á€¯á€œá€¯á€•á€ºá€–á€­á€¯á€·á€¡á€á€½á€€á€ºáŠ á€•á€‘á€™á€¡á€†á€„á€·á€ºá€›á€²á€· Output á€€á€­á€¯ á€’á€¯á€á€­á€šá€¡á€†á€„á€·á€ºá€†á€® á€œá€½á€¾á€²á€•á€¼á€±á€¬á€„á€ºá€¸á€•á€±á€¸á€™á€šá€·á€º `Event` á€á€…á€ºá€á€¯á€€á€­á€¯ á€¡á€†á€„á€·á€ºá€™á€»á€¬á€¸á€¡á€€á€¼á€¬á€¸ á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€›á€•á€«á€™á€šá€ºá‹

```python
from llama_index.core.workflow import Event

class ProcessingEvent(Event):
    intermediate_result: str

class MultiStepWorkflow(Workflow):
    @step
    async def step_one(self, ev: StartEvent) -> ProcessingEvent:
        # Process initial data
        return ProcessingEvent(intermediate_result="Step 1 complete")

    @step
    async def step_two(self, ev: ProcessingEvent) -> StopEvent:
        # Use the intermediate result
        final_result = f"Finished processing: {ev.intermediate_result}"
        return StopEvent(result=final_result)

w = MultiStepWorkflow(timeout=10, verbose=False)
result = await w.run()
result
```

á€’á€®á€”á€±á€›á€¬á€™á€¾á€¬ **Type Hinting** á€Ÿá€¬ á€¡á€›á€±á€¸á€€á€¼á€®á€¸á€•á€«á€á€šá€ºá‹ á€˜á€¬á€€á€¼á€±á€¬á€„á€·á€ºá€œá€²á€†á€­á€¯á€á€±á€¬á€· Workflow á€€á€­á€¯ á€™á€¾á€”á€ºá€€á€”á€ºá€…á€½á€¬ á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€”á€­á€¯á€„á€ºá€–á€­á€¯á€·á€¡á€á€½á€€á€º á€¡á€†á€„á€·á€ºá€á€…á€ºá€á€¯á€€ á€‘á€¯á€á€ºá€•á€±á€¸á€á€²á€· Event á€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸á€€á€­á€¯ á€”á€±á€¬á€€á€ºá€¡á€†á€„á€·á€ºá€€ á€œá€€á€ºá€á€¶á€›á€›á€¾á€­á€€á€¼á€±á€¬á€„á€ºá€¸ á€á€±á€á€»á€¬á€…á€±á€œá€­á€¯á€·á€•á€«á€•á€²á‹ á€’á€«á€†á€­á€¯á€›á€„á€º á€”á€Šá€ºá€¸á€”á€Šá€ºá€¸ á€•á€­á€¯á€›á€¾á€¯á€•á€ºá€‘á€½á€±á€¸á€á€²á€· á€¡á€›á€¬á€á€½á€±á€€á€­á€¯ á€€á€¼á€Šá€·á€ºá€œá€­á€¯á€€á€ºá€›á€¡á€±á€¬á€„á€º!

### Loops á€”á€¾á€„á€·á€º Branches (á€€á€½á€„á€ºá€¸á€™á€»á€¬á€¸á€”á€¾á€„á€·á€º á€¡á€€á€­á€¯á€„á€ºá€¸á€¡á€á€€á€ºá€™á€»á€¬á€¸)

Type Hinting á€Ÿá€¬ Workflows á€á€½á€±á€›á€²á€· á€¡á€…á€½á€™á€ºá€¸á€‘á€€á€ºá€†á€¯á€¶á€¸ á€¡á€…á€­á€á€ºá€¡á€•á€­á€¯á€„á€ºá€¸á€–á€¼á€…á€ºá€•á€«á€á€šá€ºá‹ á€˜á€¬á€€á€¼á€±á€¬á€„á€·á€ºá€œá€²á€†á€­á€¯á€á€±á€¬á€· áá€„á€ºá€¸á€€ á€•á€­á€¯á€™á€­á€¯á€›á€¾á€¯á€•á€ºá€‘á€½á€±á€¸á€á€²á€· Workflows á€á€½á€±á€¡á€á€½á€€á€º Branches (á€¡á€€á€­á€¯á€„á€ºá€¸á€¡á€á€€á€ºá€™á€»á€¬á€¸)áŠ Loops (á€€á€½á€„á€ºá€¸á€™á€»á€¬á€¸) á€”á€²á€· Joins (á€•á€±á€«á€„á€ºá€¸á€…á€Šá€ºá€¸á€™á€¾á€¯á€™á€»á€¬á€¸) á€€á€­á€¯ á€–á€”á€ºá€á€®á€¸á€”á€­á€¯á€„á€ºá€…á€±á€œá€­á€¯á€·á€•á€«á€•á€²á‹

**Loop á€á€…á€ºá€á€¯ á€–á€”á€ºá€á€®á€¸á€á€¼á€„á€ºá€¸** á€¥á€•á€™á€¬á€€á€­á€¯ Union Operator (`|`) á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€•á€¼á€®á€¸ á€•á€¼á€á€•á€«á€™á€šá€ºá‹ á€¡á€±á€¬á€€á€ºá€•á€« á€¥á€•á€™á€¬á€™á€¾á€¬ `LoopEvent` á€€á€­á€¯ Step á€¡á€á€½á€€á€º Input á€¡á€–á€¼á€…á€º á€šá€°á€”á€­á€¯á€„á€ºá€á€œá€­á€¯ Output á€¡á€–á€¼á€…á€ºá€œá€Šá€ºá€¸ á€•á€¼á€”á€ºá€‘á€¯á€á€ºá€•á€±á€¸á€”á€­á€¯á€„á€ºá€á€¬á€€á€­á€¯ á€á€½á€±á€·á€›á€•á€«á€™á€šá€ºá‹

```python
from llama_index.core.workflow import Event
import random


class ProcessingEvent(Event):
    intermediate_result: str


class LoopEvent(Event):
    loop_output: str


class MultiStepWorkflow(Workflow):
    @step
    async def step_one(self, ev: StartEvent | LoopEvent) -> ProcessingEvent | LoopEvent:
        if random.randint(0, 1) == 0:
            print("Bad thing happened")
            return LoopEvent(loop_output="Back to step one.")
        else:
            print("Good thing happened")
            return ProcessingEvent(intermediate_result="First step complete.")

    @step
    async def step_two(self, ev: ProcessingEvent) -> StopEvent:
        # Use the intermediate result
        final_result = f"Finished processing: {ev.intermediate_result}"
        return StopEvent(result=final_result)


w = MultiStepWorkflow(verbose=False)
result = await w.run()
result
```

### Workflows á€™á€»á€¬á€¸á€€á€­á€¯ á€•á€¯á€¶á€†á€½á€²á€á€¼á€„á€ºá€¸ (Drawing Workflows)

á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€· Workflows á€á€½á€±á€€á€­á€¯ á€•á€¯á€¶á€†á€½á€²á€œá€­á€¯á€·á€œá€Šá€ºá€¸ á€›á€•á€«á€á€šá€ºá‹ Workflow á€€á€­á€¯ HTML á€–á€­á€¯á€„á€ºá€á€…á€ºá€á€¯á€¡á€–á€¼á€…á€º á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€–á€­á€¯á€·á€¡á€á€½á€€á€º `draw_all_possible_flows` Function á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

```python
from llama_index.utils.workflow import draw_all_possible_flows

w = ... # as defined in the previous section
draw_all_possible_flows(w, "flow.html")
```

![workflow drawing](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit2/llama-index/workflow-draw.png)

Course á€™á€¾á€¬ á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€· á€œá€±á€·á€œá€¬á€™á€šá€·á€º á€”á€±á€¬á€€á€ºá€‘á€•á€º á€¡á€™á€­á€¯á€€á€ºá€…á€¬á€¸ á€”á€Šá€ºá€¸á€œá€™á€ºá€¸á€á€…á€ºá€á€¯á€€á€á€±á€¬á€· Workflow á€™á€¾á€¬ **State (á€¡á€á€¼á€±á€¡á€”á€±)** á€€á€­á€¯ á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€”á€­á€¯á€„á€ºá€á€¼á€„á€ºá€¸á€•á€² á€–á€¼á€…á€ºá€•á€«á€á€šá€ºá‹

### State Management (á€¡á€á€¼á€±á€¡á€”á€± á€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€™á€¾á€¯)

**State Management** á€Ÿá€¬ Workflow á€›á€²á€· á€¡á€á€¼á€±á€¡á€”á€±á€€á€­á€¯ á€™á€¾á€á€ºá€á€™á€ºá€¸á€á€„á€ºá€‘á€¬á€¸á€–á€­á€¯á€·á€¡á€á€½á€€á€º á€¡á€á€¯á€¶á€¸á€á€„á€ºá€•á€«á€á€šá€ºá‹ á€’á€«á€™á€¾ á€¡á€†á€„á€·á€ºá€á€­á€¯á€„á€ºá€¸á€€ á€¡á€á€°á€á€° á€¡á€á€¼á€±á€¡á€”á€± (State) á€€á€­á€¯ á€á€„á€ºá€›á€±á€¬á€€á€ºá€€á€¼á€Šá€·á€ºá€›á€¾á€¯á€”á€­á€¯á€„á€ºá€™á€¾á€¬ á€–á€¼á€…á€ºá€•á€«á€á€šá€ºá‹

á€’á€«á€€á€­á€¯ á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€–á€­á€¯á€·á€¡á€á€½á€€á€º Step Function á€‘á€²á€€ Parameter á€á€…á€ºá€á€¯á€›á€²á€· á€¡á€•á€±á€«á€ºá€™á€¾á€¬ `Context` Type Hint á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

```python
from llama_index.core.workflow import Context, StartEvent, StopEvent


@step
async def query(self, ctx: Context, ev: StartEvent) -> StopEvent:
    # store query in the context
    await ctx.store.set("query", "What is the capital of France?")

    # do something with context and event
    val = ...

    # retrieve query from the context
    query = await ctx.store.get("query")

    return StopEvent(result=val)
```

á€€á€±á€¬á€„á€ºá€¸á€•á€«á€•á€¼á€®! á€¡á€á€¯á€†á€­á€¯á€›á€„á€º LlamaIndex á€™á€¾á€¬ á€¡á€á€¼á€±á€á€¶ Workflows á€á€½á€±á€€á€­á€¯ á€˜á€šá€ºá€œá€­á€¯ á€–á€”á€ºá€á€®á€¸á€›á€™á€œá€²á€†á€­á€¯á€á€¬ á€á€„á€ºá€á€­á€á€½á€¬á€¸á€•á€«á€•á€¼á€®!

> [!TIP]
> Workflows á€á€½á€±á€™á€¾á€¬ á€•á€­á€¯á€™á€­á€¯á€›á€¾á€¯á€•á€ºá€‘á€½á€±á€¸á€á€²á€· á€¡á€á€±á€¸á€…á€­á€á€ºá€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€á€½á€± á€›á€¾á€­á€•á€«á€á€±á€¸á€á€šá€ºá‹ [LlamaIndex Documentation](https://docs.llamaindex.ai/en/stable/understanding/workflows/) á€™á€¾á€¬ á€•á€­á€¯á€™á€­á€¯á€œá€±á€·á€œá€¬á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

á€’á€«á€•á€±á€™á€šá€·á€º Workflows á€á€½á€± á€–á€”á€ºá€á€®á€¸á€–á€­á€¯á€· á€”á€±á€¬á€€á€ºá€‘á€•á€º á€”á€Šá€ºá€¸á€œá€™á€ºá€¸á€á€…á€ºá€á€¯ á€›á€¾á€­á€•á€«á€á€±á€¸á€á€šá€ºá‹ á€’á€«á€€á€á€±á€¬á€· `AgentWorkflow` Class á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€¼á€„á€ºá€¸á€•á€² á€–á€¼á€…á€ºá€•á€«á€á€šá€ºá‹ Multi-Agent Workflow á€á€…á€ºá€á€¯á€€á€­á€¯ á€–á€”á€ºá€á€®á€¸á€–á€­á€¯á€·á€¡á€á€½á€€á€º á€’á€® Class á€€á€­á€¯ á€˜á€šá€ºá€œá€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€›á€™á€œá€²á€†á€­á€¯á€á€¬ á€€á€¼á€Šá€·á€ºá€œá€­á€¯á€€á€ºá€›á€¡á€±á€¬á€„á€ºá‹

## Multi-Agent Workflows á€–á€¼á€„á€·á€º á€œá€¯á€•á€ºá€„á€”á€ºá€¸á€¡á€†á€„á€·á€ºá€†á€„á€·á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€á€¼á€„á€ºá€¸

á€€á€­á€¯á€šá€ºá€á€­á€¯á€„á€º Workflow á€–á€”á€ºá€á€®á€¸á€™á€šá€·á€ºá€¡á€…á€¬á€¸áŠ á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€·á€Ÿá€¬ **`AgentWorkflow` Class á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€•á€¼á€®á€¸ Multi-Agent Workflow á€á€…á€ºá€á€¯á€€á€­á€¯ á€–á€”á€ºá€á€®á€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€º**á‹

`AgentWorkflow` á€Ÿá€¬ Workflow Agents á€á€½á€±á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€•á€¼á€®á€¸ Agent á€á€…á€ºá€á€¯ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€á€…á€ºá€á€¯á€‘á€€á€ºá€•á€­á€¯á€á€±á€¬ á€…á€”á€…á€ºá€á€…á€ºá€á€¯á€€á€­á€¯ á€–á€”á€ºá€á€®á€¸á€”á€­á€¯á€„á€ºá€…á€±á€•á€«á€á€šá€ºá‹ á€’á€® Agent á€á€½á€±á€Ÿá€¬ á€á€°á€á€­á€¯á€·á€›á€²á€· á€á€®á€¸á€á€¼á€¬á€¸ á€€á€»á€½á€™á€ºá€¸á€€á€»á€„á€ºá€™á€¾á€¯á€™á€»á€¬á€¸ (Specialized Capabilities) á€€á€­á€¯ á€¡á€á€¼á€±á€á€¶á€•á€¼á€®á€¸ á€¡á€á€»á€„á€ºá€¸á€á€»á€„á€ºá€¸ á€•á€°á€¸á€•á€±á€«á€„á€ºá€¸á€†á€±á€¬á€„á€ºá€›á€½á€€á€ºá€”á€­á€¯á€„á€ºá€•á€¼á€®á€¸ Tasks á€á€½á€±á€€á€­á€¯ á€œá€½á€¾á€²á€•á€¼á€±á€¬á€„á€ºá€¸á€•á€±á€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

á€’á€«á€€ á€™á€á€°á€Šá€®á€á€²á€· Agent á€á€½á€±á€€ Task á€á€…á€ºá€á€¯á€›á€²á€· á€™á€á€°á€Šá€®á€á€²á€· á€€á€á€¹á€á€á€½á€±á€€á€­á€¯ á€€á€­á€¯á€„á€ºá€á€½á€šá€ºá€–á€¼á€±á€›á€¾á€„á€ºá€¸á€”á€­á€¯á€„á€ºá€á€²á€· á€›á€¾á€¯á€•á€ºá€‘á€½á€±á€¸á€á€²á€· Agent á€…á€”á€…á€ºá€á€½á€±á€€á€­á€¯ á€á€Šá€ºá€†á€±á€¬á€€á€ºá€”á€­á€¯á€„á€ºá€…á€±á€•á€«á€á€šá€ºá‹

`llama_index.core.agent` á€€á€”á€± Class á€á€½á€±á€€á€­á€¯ Import á€œá€¯á€•á€ºá€™á€šá€·á€ºá€¡á€…á€¬á€¸áŠ `llama_index.core.agent.workflow` á€€á€”á€± Agent Class á€á€½á€±á€€á€­á€¯ Import á€œá€¯á€•á€ºá€•á€«á€™á€šá€ºá‹

Agent á€á€…á€ºá€á€¯á€€á€­á€¯ `AgentWorkflow` Constructor á€™á€¾á€¬ **Root Agent** á€¡á€–á€¼á€…á€º á€á€á€ºá€™á€¾á€á€ºá€›á€•á€«á€™á€šá€ºá‹ User Message á€á€…á€ºá€á€¯ á€á€„á€ºá€œá€¬á€á€²á€·á€¡á€á€«áŠ áá€„á€ºá€¸á€€á€­á€¯ Root Agent á€†á€®á€á€­á€¯á€· á€¦á€¸á€…á€½á€¬ á€•á€±á€¸á€•á€­á€¯á€·á€•á€«á€á€šá€ºá‹

á€‘á€­á€¯á€·á€”á€±á€¬á€€á€º Agent á€á€…á€ºá€á€¯á€…á€®á€€ á€¡á€±á€¬á€€á€ºá€•á€«á€á€­á€¯á€·á€€á€­á€¯ á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€º-

*   á€á€°á€á€­á€¯á€·á€›á€²á€· Tools á€á€½á€±á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€•á€¼á€®á€¸ Request á€€á€­á€¯ á€á€­á€¯á€€á€ºá€›á€­á€¯á€€á€º á€€á€­á€¯á€„á€ºá€á€½á€šá€ºá€–á€¼á€±á€›á€¾á€„á€ºá€¸á€á€¼á€„á€ºá€¸á‹
*   Task á€¡á€á€½á€€á€º á€•á€­á€¯á€™á€­á€¯á€á€„á€·á€ºá€œá€»á€±á€¬á€ºá€á€²á€· á€¡á€á€¼á€¬á€¸ Agent á€á€…á€ºá€á€¯á€†á€®á€á€­á€¯á€· á€œá€½á€¾á€²á€•á€¼á€±á€¬á€„á€ºá€¸á€•á€±á€¸á€á€¼á€„á€ºá€¸ (Handoff)á‹
*   á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á€‘á€¶á€á€­á€¯á€· á€á€¯á€¶á€·á€•á€¼á€”á€ºá€™á€¾á€¯ á€•á€¼á€”á€ºá€•á€±á€¸á€á€¼á€„á€ºá€¸á‹

Multi-Agent Workflow á€á€…á€ºá€á€¯á€€á€­á€¯ á€˜á€šá€ºá€œá€­á€¯ á€–á€”á€ºá€á€®á€¸á€›á€™á€œá€²á€†á€­á€¯á€á€¬ á€€á€¼á€Šá€·á€ºá€œá€­á€¯á€€á€ºá€›á€¡á€±á€¬á€„á€ºá‹

```python
from llama_index.core.agent.workflow import AgentWorkflow, ReActAgent
from llama_index.llms.huggingface_api import HuggingFaceInferenceAPI

# Define some tools
def add(a: int, b: int) -> int:
    """Add two numbers."""
    return a + b

def multiply(a: int, b: int) -> int:
    """Multiply two numbers."""
    return a * b

llm = HuggingFaceInferenceAPI(model_name="Qwen/Qwen2.5-Coder-32B-Instruct")

# we can pass functions directly without FunctionTool -- the fn/docstring are parsed for the name/description
multiply_agent = ReActAgent(
    name="multiply_agent",
    description="Is able to multiply two integers",
    system_prompt="A helpful assistant that can use a tool to multiply numbers.",
    tools=[multiply],
    llm=llm,
)

addition_agent = ReActAgent(
    name="add_agent",
    description="Is able to add two integers",
    system_prompt="A helpful assistant that can use a tool to add numbers.",
    tools=[add],
    llm=llm,
)

# Create the workflow
workflow = AgentWorkflow(
    agents=[multiply_agent, addition_agent],
    root_agent="multiply_agent",
)

# Run the system
response = await workflow.run(user_msg="Can you add 5 and 3?")
```

**á€™á€¾á€á€ºá€á€»á€€á€º:** á€’á€®á€¥á€•á€™á€¬á€™á€¾á€¬ `multiply_agent` á€€á€­á€¯ Root Agent á€¡á€–á€¼á€…á€º á€á€á€ºá€™á€¾á€á€ºá€‘á€¬á€¸á€•á€«á€á€šá€ºá‹ á€’á€«á€•á€±á€™á€šá€·á€º User á€€ "Can you add 5 and 3?" á€œá€­á€¯á€· á€™á€±á€¸á€á€²á€·á€¡á€á€«áŠ `multiply_agent` á€€ á€á€°á€·á€›á€²á€· Tool (multiply) á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€™á€•á€¼á€¯á€”á€­á€¯á€„á€ºá€˜á€°á€¸á€†á€­á€¯á€á€¬ á€á€­á€á€²á€·á€¡á€á€½á€€á€ºáŠ Task á€€á€­á€¯ `addition_agent` á€†á€®á€á€­á€¯á€· á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º á€œá€½á€¾á€²á€•á€¼á€±á€¬á€„á€ºá€¸á€•á€±á€¸á€•á€«á€œá€­á€™á€·á€ºá€™á€šá€ºá‹

Agent Tools á€™á€»á€¬á€¸á€á€Šá€º á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€· á€¡á€…á€±á€¬á€•á€­á€¯á€„á€ºá€¸á€€ á€•á€¼á€±á€¬á€á€²á€·á€á€²á€· Workflow State á€€á€­á€¯á€œá€Šá€ºá€¸ á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹ Workflow á€€á€­á€¯ á€™á€…á€á€„á€ºá€™á€®áŠ Agent á€¡á€¬á€¸á€œá€¯á€¶á€¸ á€á€„á€ºá€›á€±á€¬á€€á€ºá€€á€¼á€Šá€·á€ºá€›á€¾á€¯á€”á€­á€¯á€„á€ºá€™á€šá€·á€º Initial State Dictionary á€á€…á€ºá€á€¯á€€á€­á€¯ á€•á€±á€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€ºá‹

State á€€á€­á€¯ Workflow Context á€›á€²á€· `state` Key á€™á€¾á€¬ á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€‘á€¬á€¸á€•á€«á€á€šá€ºá‹ áá€„á€ºá€¸á€€á€­á€¯ `state_prompt` á€‘á€²á€á€­á€¯á€· á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€•á€±á€¸á€•á€¼á€®á€¸ User Message á€¡á€á€…á€ºá€á€­á€¯á€„á€ºá€¸á€€á€­á€¯ á€–á€¼á€Šá€·á€ºá€…á€½á€€á€ºá€•á€±á€¸á€•á€«á€á€šá€ºá‹

á€šá€á€„á€º á€¥á€•á€™á€¬á€€á€­á€¯ á€•á€¼á€„á€ºá€†á€„á€ºá€•á€¼á€®á€¸ Function á€á€±á€«á€ºá€†á€­á€¯á€™á€¾á€¯ á€¡á€›á€±á€¡á€á€½á€€á€ºá€€á€­á€¯ á€›á€±á€á€½á€€á€ºá€›á€”á€º Counter á€á€…á€ºá€á€¯ á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€€á€¼á€Šá€·á€ºá€›á€¡á€±á€¬á€„á€ºá‹

```python
from llama_index.core.workflow import Context

# Define some tools
async def add(ctx: Context, a: int, b: int) -> int:
    """Add two numbers."""
    # update our count
    cur_state = await ctx.store.get("state")
    cur_state["num_fn_calls"] += 1
    await ctx.store.set("state", cur_state)

    return a + b

async def multiply(ctx: Context, a: int, b: int) -> int:
    """Multiply two numbers."""
    # update our count
    cur_state = await ctx.store.get("state")
    cur_state["num_fn_calls"] += 1
    await ctx.store.set("state", cur_state)

    return a * b

...

workflow = AgentWorkflow(
    agents=[multiply_agent, addition_agent],
    root_agent="multiply_agent",
    initial_state={"num_fn_calls": 0},
    state_prompt="Current state: {state}. User message: {msg}",
)

# run the workflow with context
ctx = Context(workflow)
response = await workflow.run(user_msg="Can you add 5 and 3?", ctx=ctx)

# pull out and inspect the state
state = await ctx.store.get("state")
print(state["num_fn_calls"])
```

á€‚á€¯á€á€ºá€šá€°á€•á€«á€á€šá€º! á€¡á€á€¯á€†á€­á€¯á€›á€„á€º LlamaIndex á€™á€¾á€¬ Agent á€á€½á€±á€›á€²á€· á€¡á€á€¼á€±á€á€¶á€á€½á€±á€€á€­á€¯ á€á€„á€ºá€€á€»á€½á€™á€ºá€¸á€€á€»á€„á€ºá€á€½á€¬á€¸á€•á€«á€•á€¼á€®! ğŸ‰

á€á€„á€·á€ºá€›á€²á€· á€¡á€á€­á€•á€Šá€¬á€á€½á€±á€€á€­á€¯ á€á€­á€¯á€„á€ºá€™á€¬á€…á€±á€–á€­á€¯á€·á€¡á€á€½á€€á€º á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸ Quiz á€á€…á€ºá€á€¯á€”á€²á€· á€†á€€á€ºá€œá€€á€ºá€á€½á€¬á€¸á€€á€¼á€›á€¡á€±á€¬á€„á€º! ğŸš€