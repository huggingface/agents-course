# Actions:  Enabling the Agent to Engage with Its Environment

<tip>
 このセクションでは、エージェントが環境と相互作用するための具体的な方法ステップについて探索します。

 アクションがどのように表現されるか(JSONやコードを使用)、ストップ&パース手法の重要性、そして様々な種類のエージェントを紹介します。
</tip>

アクションとは**AIエージェントが環境と相互作用するための**具体的なステップです。

ウェブを閲覧して情報を得ようが、物理的なデバイスを操作しようが、それぞれのアクションはエージェントによって意図的に実行される操作です。

例えば、カスタマーサービスを支援するエージェントは顧客データを検索したり、サポート記事を提供したり、問題を人間の担当者に転送するかもしれません。

## エージェントアクションの種類

エージェントには複数の種類があり、それぞれ異なるアクションをとります:

| エージェントの種類        | 説明                                                                                      |
|------------------------|--------------------------------------------------------------------------------------------------|
| JSON エージェント        | 実行されるアクションはJSON形式で指定されます。                                                                |
| Code エージェント        | エージェントは外部から解釈されるコードブロックを書きます。                                    |
| 関数呼び出しエージェント | これはJSONエージェントのサブカテゴリで、アクションごとに新しいメッセージを生成するようにファインチューニングされます。 |

アクション自体は多くの目的を果たすことができます:

| アクションの種類            | 説明                                                                              |
|--------------------------|------------------------------------------------------------------------------------------|
| 情報収集    | ウェブ検索、データベースのクエリ化、またはドキュメントの取得。                   |
| ツールの使い方               | APIの呼び出し、計算の実行、コードの実行。                              |
| 環境との相互作用  | デジタルインターフェースの操作や物理デバイスの制御。
| コミュニケーション            | チャットや他のエージェントとの共同作業を通じてユーザーと関わる。                         |

LLMはテキストのみを取り扱い実行したいアクションやツールに与えるパラメータを記述するためにテキストを使います。エージェントが適切に動作するためには、LLMは完全なアクションを定義するためにすべてのトークンを出力した後、新しいトークンの生成を停止しなければなりません。これにより、LLMからエージェントに制御が戻り、意図された形式がJSONであれ、コードであれ、関数呼び出しであれ、結果が解析可能であることが保証されます。

## ストップ&パース手法 (Stop and Parse Approach)

アクションを実装するための重要な手法が**ストップ&パース**です。この手法がエージェントの出力が構造化され予測可能であることを保証します:

1. **構造化された形式での生成**:

エージェントは意図されたアクションを明確な所定の形式(JSONまたはコード)で出力します。

2. **さらなる生成の停止**

アクションを定義するテキストが出力されると、**LLMは追加のトークン生成を停止します**。これにより、余分な出力や誤った出力を防ぐことができます。

3. **出力の解析**

外部のパーサーが形式されたアクションを読み込み、どのツールを呼び出すが決定し、必要なパラメータを抽出します。

例えば、天気を調べるエージェントは以下を出力するでしょう:

```json
Thought: I need to check the current weather for New York.
Action :
{
  "action": "get_weather",
  "action_input": {"location": "New York"}
}
```

フレームワークは呼び出す関数名と適用する引数を簡単に解析できます。

この明確で機械が読める形式は、誤りを最小化し外部ツールが正確にエージェントのコマンドを実行することを可能にします。

注: 関数呼び出しエージェントは、指定された関数が正しい引数で呼び出されるようにアクションを構造化することで同様に動作します。

## コードエージェント

他のアプローチは*コードエージェント*を使用することです。
The idea is: **instead of outputting a simple JSON object**, a Code Agent generates an **executable code block—typically in a high-level language like Python**. 
このアイデアは: **シンプルなJSON形式を出力する代わりに**、コードエージェントが**実行可能なコードブロック(通常はPythonのような高級言語による)**を生成します。

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/code-vs-json-actions.png" alt="Code Agents" />

この方法にはいくつかの利点があります:

- **表現力:** コードはループ、条件分岐、ネスト関数などの複雑なロジックを自然に表現することができ、JSONよりも柔軟が高いです。
- **モジュール性と再利用性:** 生成されたコードは異なるアクションやタスクをまたいで再利用できる関数やモジュールを含むことができます。
- **デバッグ機能の強化:** プログラムの構文がきちんと定義されていれば、コードのエラーを発見しやすく、修正しやすくなります。
- **直接統合:** コードエージェントは外部ライブラリやAPIと直接統合することができ、データ処理やリアルタイム意思決定などのより複雑な処理を可能にします。

LLMによって生成されたコードを実行すると、プロンプト・インジェクションから有害なコードの実行に至るまで、セキュリティリスクが生じる可能性があることに留意しなければなりません。
そのため、デフォルトのセーフガードを統合した`smolagents`のようなAIエージェントフレームワークを使うことが推奨されています。
リスクとその軽減方法について詳しく知りたい場合は、[こちらの専用セクションをご覧ください](https://huggingface.co/docs/smolagents/tutorials/secure_code_execution)。

例えば、現在の天気の取得をタスクとするコードエージェントは、次のようなPythonスニペットを生成するかもしれません:

```python
# Code Agent Example: Retrieve Weather Information
def get_weather(city):
    import requests
    api_url = f"https://api.weather.com/v1/location/{city}?apiKey=YOUR_API_KEY"
    response = requests.get(api_url)
    if response.status_code == 200:
        data = response.json()
        return data.get("weather", "No weather information available")
    else:
        return "Error: Unable to fetch weather data."

# Execute the function and prepare the final answer
result = get_weather("New York")
final_answer = f"The current weather in New York is: {result}"
print(final_answer)
```

この例では、コードエージェントは:

- 天気のデータを**API呼出しによって**取得する、
- レスポンスを処理する、
- 最終的な回答を出力するためにprint()関数を使用する。

This method **also follows the stop and parse approach** by clearly delimiting the code block and signaling when execution is complete (here, by printing the final_answer).
この方法も、コードブロックを明確に区切り実行が完了したことを知らせる(ここでは、final_answerを表示する)ことで、**ストップ&パース手法**に従っています。

---

アクションは、JSON、コード、または関数呼び出しなどを通じて、明確で構造化されたタスクを実行することで、エージェントの内部推論と実世界の相互作用の橋渡しをすることを学びました。

この意図的な実行は、各アクションが正確で、停止と解析のアプローチを通じて外部処理の準備が整っていることを保証します。

次のセクションでは、エージェントがどのように環境からのフィードバックを取得し、統合するかを見るために、Observations(観察)を探求します。

その後、私達は**ついに最初のエージェントを作成する準備が整います!**





